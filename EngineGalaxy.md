# <font color='red'>ИЗМЕНЕНО</font> #

Движок галактики был удален, так как в нём нет необходимости. Всё управление планетами производится движком планет.

На самом деле, после продолжительных раздумий, я пришёл к выводу, что поля обломков - это просто другой тип планеты. На эту идею меня подтолкнула страница `Империя`. У этой страницы есть $GET параметр - `planettype`. Для показа планет planettype=1, для показа лун - planettype=3. Очевидно, что planettype=2 используется для чего-то ещё. Ничего, кроме ПО это быть не может.

Теперь картина принимает стройный вид (у удалённых планет хозяином ПО является space, чистка ПО и прочее).

# Introduction #

<img src='http://ogamespec.com/imgstore/whc4d774d5164129.jpg'>

Движок предназначен для быстрого отображения планет системы, а также для управления полями обломков и подбора координат стартовой планеты для нового игрока.<br>
<br>
Программный модуль находится в файле <code>game/galaxy.php</code>

Основные объекты галактики:<br>
<ul><li>Планеты. Сами планеты находятся в таблице <code>planets</code>. В таблице <code>galaxy</code> содержится только пометка что позиция занята планетой. Планеты принадлежат либо определенному игроку, либо тех. аккаунту <code>space</code> (уничтоженные планеты)<br>
</li><li>Луны<br>
</li><li>Поля обломков. ПО принадлежат либо реальному игроку, либо тех. аккаунту <code>space</code>, если планета на этих координатах была уничтожена. Если в ПО менее 400 ед. ресурсов любого вида, то оно становится невидимым. Даже если в ПО находится 0 металла и 0 кристалла, его всё равно можно переработать. ПО исчезает в понедельник в 1:10 по серверу, если на/от него не летит ни одного флота и если там 0 ресурсов.</li></ul>

<b>Откуда такие предположения в работе Галактики?</b><br>
Были замечены следующие факты в оригинальной игре:<br>
<ul><li>Иногда при колонизации новой планеты или регистрации в старой вселенной, у планеты появляется поле обломков. Это происходит из-за того, что на месте удаленной планеты было ненулевое ПО и оно не удалилось. В Галактике не показываются ненулевые ПО, у которых нет планет (Примечание: в редизайне показываются)<br>
</li><li>При попытке атаки уничтоженной планеты в качестве дефа выступает игрок <code>space</code>. Это значит, что после удаления хозяином планеты становится тех. аккаунт <code>space</code>.<br>
</li><li>Иногда можно было переработать пустое место в галактике. Это связано с пунктом 1. Хозяином этого пустого ПО был игрок <code>space</code>.</li></ul>

По этим фактам стало понятно, что данные о ПО не хранятся в таблице <code>planets</code>, так как если бы удалялась планета, то удалялось бы и ПО.<br>
<br>
<h1>Алгоритм образования Главной планеты</h1>

<h1>Database</h1>

Структура таблицы <code>galaxy</code>:<br>
<br>
<table><thead><th> <b>столбец</b> </th><th> <b>SQL тип</b> </th><th> <b>описание</b> </th></thead><tbody>
<tr><td>g </td><td>INT</td><td>Номер галактики</td></tr>
<tr><td>s </td><td>INT</td><td>Номер системы</td></tr>
<tr><td>p </td><td>INT</td><td>Номер позиции</td></tr>
<tr><td>planet_id</td><td>INT</td><td>Позиция занята планетой, если planet_id != 0</td></tr>
<tr><td>moon_id</td><td>INT</td><td>Позиция занята луной, если moon_id != 0</td></tr>
<tr><td>debris</td><td>INT</td><td>1: на позиции есть поле обломков</td></tr>
<tr><td>dm</td><td>DOUBLE</td><td>Количество металла в ПО (может быть 0)</td></tr>
<tr><td>dk</td><td>DOUBLE</td><td>Количество кристалла в ПО (может быть 0)</td></tr>