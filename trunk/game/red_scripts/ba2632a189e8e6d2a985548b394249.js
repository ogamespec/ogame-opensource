function reloadEventbox(k){var l;if(typeof(k)=="string"){l=$.parseJSON(k)}else{l=k}var g=false;var f=typeof l.eventText;var j=parseInt(l.friendly)+parseInt(l.neutral)+parseInt(l.hostile);if(j>0){g=true}if(g){$("#eventFriendly").html(l.friendly);$("#eventNeutral").html(l.neutral);$("#eventHostile").html(l.hostile);$("#eventContent").html(l.eventText);$("#eventClass").attr("class",l.eventText)}if(f=="string"||f=="undefined"){$("#eventboxLoading").hide();if(g){$("#eventboxBlank").hide();$("#eventboxFilled").show();new simpleCountdown(getElementByIdWithCache("tempcounter"),l.eventTime,function(){setTimeout(getAjaxEventbox,3000)})}else{$("#eventboxBlank").show();$("#eventboxFilled").hide()}}}function reloadResources(d,f){var e;if(typeof(d)=="string"){e=$.parseJSON(d)}else{e=d}reloadResourceTicker(e);$("#resources_metal").html(e.metal.resources["actualFormat"]);$("#resources_metal").attr("class",e.metal["class"]);changeTooltip($("#metal_box"),e.metal.tooltip);$("#resources_crystal").html(e.crystal.resources["actualFormat"]);$("#resources_crystal").attr("class",e.crystal["class"]);changeTooltip($("#crystal_box"),e.crystal.tooltip);$("#resources_deuterium").html(e.deuterium.resources["actualFormat"]);$("#resources_deuterium").attr("class",e.deuterium["class"]);changeTooltip($("#deuterium_box"),e.deuterium.tooltip);$("#resources_energy").html(e.energy.resources["actualFormat"]);$("#resources_energy").attr("class",e.energy["class"]);changeTooltip($("#energy_box"),e.energy.tooltip);$("#resources_darkmatter").html(e.darkmatter.resources["actualFormat"]);$("#resources_darkmatter").attr("class",e.darkmatter["class"]);changeTooltip($("#darkmatter_box a"),e.darkmatter.tooltip);honorScore=e.honorScore;darkMatter=e.darkmatter.resources["actual"];if(typeof(f)=="function"){f(e)}}function reloadResourceTicker(b){if(typeof(b)=="string"){b=$.parseJSON(b)}resourceTickerMetal={available:b.metal.resources["actual"],limit:b.metal.resources["max"],production:b.metal.resources["production"],valueElem:"resources_metal"};resourceTickerCrystal={available:b.crystal.resources["actual"],limit:b.crystal.resources["max"],production:b.crystal.resources["production"],valueElem:"resources_crystal"};resourceTickerDeuterium={available:b.deuterium.resources["actual"],limit:b.deuterium.resources["max"],production:b.deuterium.resources["production"],valueElem:"resources_deuterium"};if(!vacation){if(typeof(metalTicker)!="undefined"){timerHandler.removeCallback(metalTicker.intervalObj)}if(typeof(crystalTicker)!="undefined"){timerHandler.removeCallback(crystalTicker.intervalObj)}if(typeof(deuteriumTicker)!="undefined"){timerHandler.removeCallback(deuteriumTicker.intervalObj)}metalTicker=new resourceTicker(resourceTickerMetal);crystalTicker=new resourceTicker(resourceTickerCrystal);deuteriumTicker=new resourceTicker(resourceTickerDeuterium)}}function reloadRightmenu(b){$.get(b,{},displayRightmenu)}function displayRightmenu(b){$("#rechts").html(b);initPlanetSorting()}function ajaxFormSubmit(l,f,k){var j=$("#"+l+"").serialize();var g=null;if(k!=null&&typeof k=="function"){g=k}$.ajax({type:"POST",url:f,data:j,success:g})}function initConnectionErrorFunction(){if(isMobile){document.addEventListener("deviceready",function(){$(document).ajaxError(function(j,g,e,f){HostApp.ShowNoConnectionScreen()})},false)}}function initAllianceInfo(){initConnectionErrorFunction();if(!isMobile){$("a.bbcodeLink:not(.overlay)").click(function(){var b=$(this).attr("href");window.open("redir.php?url="+encodeURI(b),"_newtab");return false});initTooltips();initOverlays()}}function manageTabs(f){var d="#"+f;var e=$(d).attr("rel");if($(d).hasClass("opened")){$(d).addClass("closed");$(d).removeClass("opened");$("#"+e).hide()}else{$(d).removeClass("closed");$(d).addClass("opened");$("#"+e).show()}}function ajaxLoad(b){$("#eins").html('<div id="ajaxLoad">'+LocalizationStrings.loading+"</div>");$.post(b,{ajax:1},function(a){$("#eins").html(a)})}function initAlliance(){$("a.toggleHeader").click(function(){$("#planet").toggleClass("shortHeader");$(".c-left").toggleClass("shortCorner");$(".c-right").toggleClass("shortCorner");changeCookie(cookieName)});$(".navi").click(function(){var b=$(this).attr("rel");$("#tab-ally li").removeClass("aktiv");$(this).parent().addClass("aktiv");hideTipsOnTabChange();ajaxLoad(b)})}function initAllianceBroadcast(){$("#allianceBroadCast").submit(function(){var b=$(this);$.post(b.attr("action"),b.serialize()+"&ajax=1",function(a){$("#eins").html(a)});return false})}function initAllianceManagement(){$(".contentz").tabs({select:hideTipsOnTabChange});$(".allyTagChange").tabs({select:hideTipsOnTabChange});$(".quitAlly").tabs({select:hideTipsOnTabChange});$(".dissolve").bind("click",dissolve);$(".deleteRank").bind("click",deleteRank);$(".transferLeadership").bind("click",transferLeadership);$(".takeoverLeadership").bind("click",takeoverLeadership)}function initInviteCodes(){$("#buddyinvite .code").click(function(){$("code",this).selectText()})}function incrementBuddyCount(){var c=parseInt($("#buddyCount").text())+1;var d=parseInt($("#newRequestCount").text())-1;updateRequestCount(d);updateBuddyCount(c)}function updateRequestCount(b){$("#newRequestCount").html(b)}function updateBuddyCount(b){$("#buddyCount").html(b)}function buddyListReady(){addZebra();$(".deleteBuddy").bind("click",deleteBuddy)}function requestsReady(){addZebra();$(".cancelRequest").bind("click",cancelRequest);$(".acceptRequest").bind("click",acceptRequest);$(".rejectRequest").bind("click",rejectRequest)}function addZebra(){$(".zebra tr").mouseover(function(){$(this).addClass("over")}).mouseout(function(){$(this).removeClass("over")});$(".zebra tr:even").addClass("alt")}function initBuddies(){$("#buddies .nav").unbind("click").bind("click",function(c){c.preventDefault();var d=$(this);hideTipsOnTabChange();$.get($(this).attr("href"),{},function(a){d.parents(".messagebox").find("#ajaxContent").html(a)});d.parents("ul").find("li").removeClass("aktiv");d.parent().addClass("aktiv")})}function initBuddyRequestForm(){$(".overlayDiv .buddyRequest form").unbind("submit").bind("submit",function(){var b=$(this);$.post(b.attr("action"),b.serialize(),function(d){var a=b.parents(".overlayDiv");a.html(d)});return false});$(".buddyRequest").each(function(){var c=$(this);var d=c.parents(".ui-dialog").find(".ui-dialog-title");if(!d.find("span.buddyName").length){d.append($(document.createElement("span")).addClass("buddyName").text(" ("+c.attr("rel")+")"))}})}function initChangelog(){$("#changelog dd").hide();$("#changelog dt").mouseover(function(){$(this).css("cursor","pointer")});$("#changelog dt").click(function(){if($(this).hasClass("open")){$(this).next("dd").hide();$(this).removeClass("open")}else{$(this).next("dd").show().find("dd:first").show();$(this).next("dd").find("dt:first").addClass("open");$(this).addClass("open")}});$("#changelog dt:first").click()}function createExpireTime(c){var d=new Date();c=c*1000;d.setTime(c);return d}function deleteSetCookie(f,e){if($.cookie(f)==true){$.cookie(f,null)}else{var d=createExpireTime(e);$.cookie(f,"1",{expires:d})}}function changeCookie(f,e){var d=createExpireTime(e);if($.cookie(f)==1){mode=0}else{mode=1}if(e==null){$.cookie(f,mode)}else{$.cookie(f,mode,{expires:d})}}function set_cookie(f,e){expireStatement="";if(e!=""){var d=new Date();e=e*1000;d.setTime(e);expireStatement=" expires="+d.toGMTString()+""}if(document.cookie){done=false;cookie_object=document.cookie.replace(/ /g,"");cookie_explode=cookie_object.split(";");for(i=0;i<cookie_explode.length;i++){data_explode=cookie_explode[i].split("=");if(data_explode[0]==f){if(data_explode[1]==0){document.cookie=""+f+"=1;"+expireStatement+""}else{document.cookie=""+f+"=0;"+expireStatement+""}done=true;break}}if(!done){document.cookie=""+f+"=0;"+expireStatement+""}}else{document.cookie=""+f+"=0;"+expireStatement+""}}function check_cookie(c,d){if(document.cookie){done=false;cookie_object=document.cookie.replace(/ /g,"");cookie_explode=cookie_object.split(";");for(i=0;i<cookie_explode.length;i++){data_explode=cookie_explode[i].split("=");if(data_explode[0]==c){if(data_explode[1]==0){cookie_isNotSet(d)}else{cookie_isSet(d)}done=true;break}}if(!done){cookie_isNotSet(d)}}else{cookie_isNotSet(d)}}function countdown(l,g,f){if(g==null||g==""){g=2}var j=this;j.countValue=parseInt(f)||-1;j.timestamp=0;j.maxDigits=parseInt(g);j.delimiter=" ";j.approx="";j.showunits=true;j.zerofill=false;var k=new Date();j.startTime=k.getTime();j.startLeftoverTime=parseInt(l);this.getCurrentTimestring=function(){return j.formatTime(j.getLeftoverTime())};this.getLeftoverTime=function(){var a=new Date();return Math.round((j.startLeftoverTime+((a.getTime()-j.startTime)*j.countValue)/1000))};this.formatTime=function(a){return formatTimeWrapper(a,j.maxDigits,j.showunits,j.delimiter,j.zerofill,j.approx)}}function formatTimeWrapper(w,E,y,F,C,k){var D=new Array;D.week=604800;D.day=86400;D.hour=3600;D.minute=60;D.second=1;var B=new Array;B.week=y?LocalizationStrings.timeunits["short"].week:"";B.day=y?LocalizationStrings.timeunits["short"].day:"";B.hour=y?LocalizationStrings.timeunits["short"].hour:"";B.minute=y?LocalizationStrings.timeunits["short"].minute:"";B.second=y?LocalizationStrings.timeunits["short"].second:"";var u="";for(var A in D){var x=Math.floor(w/D[A]);if(E>0&&(x>0||C&&u!="")){w=w-x*D[A];if(u!=""){u+=F;if(x<10&&x>0&&C){x="0"+x}if(x==0){x="00"}}u+=x+B[A];E--}}if(w>0){u=k+u}return u}function bauCountdown(k,l,f,g){if(typeof(k)=="object"){var j=this;j.totalTime=f;j.startHeight=k.offsetHeight;j.htmlObj=k;j.timeHtmlObj=getChildNodeWithClassName(k,"time");this.updateCountdown=function(){j.countdown.getCurrentTimestring();timestamp=j.countdown.getLeftoverTime();timestring=j.countdown.getCurrentTimestring();j.timeHtmlObj.innerHTML=timestring;var a=Math.max(0,timestamp)/j.totalTime;if(a>0){height=Math.round(j.startHeight*(1-(a)));j.htmlObj.style.height=height+"px";j.htmlObj.style.marginBottom="-"+height+"px"}else{j.timeHtmlObj.innerHTML=LocalizationStrings.status.ready;height=j.startHeight;j.htmlObj.style.height=height+"px";j.htmlObj.style.marginBottom="-"+height+"px";if(timestamp<=-1&&timestamp>-10&&!isOverlayOpen()){reload_page(g)}}};if(j.timeHtmlObj){j.countdown=new countdown(l);timerHandler.appendCallback(j.updateCountdown);j.updateCountdown()}else{window.status="kein timeHtmlObj"}}}function schiffbauCountdown(q,j,l,u,w,k){if(typeof(q)=="object"){var p=this;p.totalTime=w;p.oneShipTime=w;p.shipCount=j;p.currentShips=l;p.startHeight=q.offsetHeight;p.htmlObj=q;p.timeHtmlObj=getChildNodeWithClassName(q,"time");p.countHtmlObj=getChildNodeWithClassName(q.parentNode,"count");p.shipsHtmlObj=getChildNodeWithClassName(q.parentNode,"level");this.updateCountdown=function(){p.countdown.getCurrentTimestring();timestamp=p.countdown.getLeftoverTime();timestring=p.countdown.getCurrentTimestring();p.replaceInnerHTML(p.timeHtmlObj,timestring);var a=Math.max(0,timestamp)/p.totalTime;if(a>0){height=Math.round(p.startHeight*(1-(a)));p.htmlObj.style.height=height+"px";p.htmlObj.style.marginBottom="-"+height+"px"}else{if(p.shipCount>0){p.shipCount--;p.currentShips++}if(p.shipCount>=0){p.replaceInnerHTML(p.countHtmlObj,p.shipCount);if(typeof document.getElementById("shipcount")!="undefined"){document.getElementById("shipcount").innerHTML=p.shipCount}}p.replaceInnerHTML(p.shipsHtmlObj,gfNumberGetHumanReadable(p.currentShips));if(p.shipCount>0){p.countdown=new countdown(w);p.replaceInnerHTML(p.timeHtmlObj,"-")}else{timerHandler.removeCallback(p.timer);p.replaceInnerHTML(p.timeHtmlObj,LocalizationStrings.status.ready)}}};this.replaceInnerHTML=function(b,a){var c=document.createTextNode(a);if(b.firstChild){b.firstChild.deleteData(0,20);b.firstChild.appendData(c.nodeValue)}};if(p.timeHtmlObj&&p.countHtmlObj&&p.shipsHtmlObj){totalTime=Math.floor(j*w);p.countdown=new countdown(u);p.timer=timerHandler.appendCallback(p.updateCountdown);p.updateCountdown()}else{window.status="kein: timeHtmlObj oder countHtmlObj oder shipsHtmlObj"}}}function baulisteCountdown(k,f,g,l){if(typeof(k)=="object"){var j=this;j.timeHtmlObj=k;j.updateCountdown=function(){var a=j.countdown.getLeftoverTime();if(a>0){$(j.timeHtmlObj).html(j.countdown.getCurrentTimestring())}else{$(j.timeHtmlObj).html(LocalizationStrings.status.ready);if(typeof(l)=="function"){l()}if(a<=-1&&a>-10){if(g!=null&&a>-10&&!isOverlayOpen()){reload_page(g)}timerHandler.removeCallback(j.timer)}}};if(j.timeHtmlObj){j.countdown=new countdown(f,3);j.timer=timerHandler.appendCallback(j.updateCountdown);j.updateCountdown()}}}function eventboxCountdown(d,e){if(typeof(d)=="object"){var f=this;f.timeHtmlObj=d;this.updateCountdown=function(){f.countdown.getCurrentTimestring();timestamp=f.countdown.getLeftoverTime();timestring=f.countdown.getCurrentTimestring();if(timestamp>0){$(f.timeHtmlObj).html(timestring)}else{timerHandler.removeCallback(f.timer);$(f.timeHtmlObj).html(LocalizationStrings.status.ready);setTimeout("checkEventList()",2500)}};if(f.timeHtmlObj){f.countdown=new countdown(e,3);f.timer=timerHandler.appendCallback(f.updateCountdown);f.updateCountdown()}}}function simpleCountdown(k,g,l,f){if(typeof(k)=="object"){var j=this;j.timeHtmlObj=$(k)[0];this.updateCountdown=function(){var a=j.countdownObject.getLeftoverTime();var b=j.countdownObject.getCurrentTimestring();if(a>0){j.timeHtmlObj.innerHTML=b;if(typeof f=="string"&&$.isFunction(window[f])){window[f]()}else{if($.isFunction(f)){f()}}}else{timerHandler.removeCallback(j.timer);j.timeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(typeof l=="string"&&$.isFunction(window[l])){window[l]()}else{if($.isFunction(l)){l()}}}};if(typeof(j.timer)!="undefined"){timerHandler.removeCallback(j.timer)}if(j.timeHtmlObj){j.countdownObject=new countdown(g,3);j.timer=timerHandler.appendCallback(j.updateCountdown);j.updateCountdown()}}}function countdownWithTickFunction(p,w,j,q,u,k){if(typeof(p)=="object"){var l=this;l.timeHtmlObj=p;if(typeof($(p).attr("data-countdown"))!="undefined"){timerHandler.removeCallback($(p).attr("data-countdown"))}this.updateCountdown=function(){timestamp=l.countdown.getLeftoverTime();timestring=l.countdown.getCurrentTimestring();if(timestamp>0){l.timeHtmlObj.innerHTML=timestring;if(typeof u=="string"&&$.isFunction(window[u])){window[u](timestamp,j)}else{if($.isFunction(u)){u(timestamp,j)}}}else{timerHandler.removeCallback(l.timer);l.timeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(typeof q=="string"&&$.isFunction(window[q])){window[q]()}else{if($.isFunction(q)){q()}}}};if(l.timeHtmlObj){l.countdown=new countdown(w,k);l.timer=timerHandler.appendCallback(l.updateCountdown);l.updateCountdown();$(p).attr("data-countdown",l.timer)}return l}}function reloadCountdown(j,e,f){if(typeof(j)=="object"){var g=this;g.timeHtmlObj=j;this.updateCountdown=function(){g.countdown.getCurrentTimestring();timestamp=g.countdown.getLeftoverTime();timestring=g.countdown.getCurrentTimestring();if(timestamp>0){g.timeHtmlObj.innerHTML=timestring}else{g.timeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(timestamp<=-2&&timestamp>-10&&!isOverlayOpen()){reload_page(f)}}};if(g.timeHtmlObj){g.countdown=new countdown(e,3);timerHandler.appendCallback(g.updateCountdown);g.updateCountdown()}}}function movementImageCountdown(p,w,q,k,j,u){if(typeof(p)=="object"){var l=this;l.timeHtmlObj=p;this.updateCountdown=function(){l.countdown.getCurrentTimestring();timestamp=l.countdown.getLeftoverTime();timestring=l.countdown.getCurrentTimestring();if(timestamp>0){percent=100-Math.floor(timestamp/(q/100));if(!k){pixel=Math.abs((u/100)*percent)}else{pixel=(u*2)-Math.abs(((u*2)/100)*percent)}if(j){l.timeHtmlObj.style.marginRight=pixel+"px"}else{l.timeHtmlObj.style.marginLeft=pixel+"px"}}};if(l.timeHtmlObj){l.countdown=new countdown(w,3);timerHandler.appendCallback(l.updateCountdown);l.updateCountdown()}}}function shipCountdown(y,u,l,x,B,p,q,w){if((typeof(y)=="object")&&(typeof(u)=="object")&&(typeof(l)=="object")){var A=this;A.totalTimeHtmlObj=y;A.unitTimeHtmlObj=u;A.sumCountHtmlObj=l;this.updateCountdown=function(){A.unitCountdown.getCurrentTimestring();unitTimestamp=A.unitCountdown.getLeftoverTime();unitTimestring=A.unitCountdown.getCurrentTimestring();A.totalCountdown.getCurrentTimestring();totalTimestamp=A.totalCountdown.getLeftoverTime();totalTimestring=A.totalCountdown.getCurrentTimestring();if(unitTimestamp>0){A.unitTimeHtmlObj.innerHTML=unitTimestring}else{q--;A.unitTimeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(q>0){A.unitCountdown=new countdown(x);A.sumCountHtmlObj.innerHTML=q}else{A.sumCountHtmlObj.innerHTML=0}}if(q>0){A.totalTimeHtmlObj.innerHTML=totalTimestring}else{A.totalTimeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(!isOverlayOpen()){reload_page(w)}}};if((A.totalTimeHtmlObj)&&(A.unitTimeHtmlObj)&&(A.sumCountHtmlObj)){A.totalCountdown=new countdown(p);A.unitCountdown=new countdown(B);timerHandler.appendCallback(A.updateCountdown);A.updateCountdown()}}}function reload_page(b){openParentLocation(b)}function initItemActivation(c){inventoryObj.initalizeSlider(inventoryObj.items_inventory,"js_activeItemSlider",395,172," ",true," ",true,true);if(typeof(c)=="undefined"||c.length==0||c==1){var d=$(".item_img_box .detail_button").filter(":first");if(d.length===0){$("#noItems").show();$("#itemDetailBox").hide();return}else{$.bbq.pushState({item:d.attr("ref")})}}else{$.bbq.pushState({item:c});$(window).trigger("hashchange")}$("#activeBuffDetails .js_is_active").each(function(){$durationEl=$(this).parent().siblings(".js_duration");$pusherEl=$(this).parent().siblings(".pusher");startCooldown($durationEl,$pusherEl,75)});$(document).undelegate("#activeBuffDetails .detail_button","click.updateItemDetails").delegate("#activeBuffDetails .detail_button","click.updateItemDetails",function(){if($(this).hasClass("active")){return}$("#activeBuffDetails .detail_button").removeClass("active");$(this).addClass("active");$.bbq.pushState({item:$(this).attr("ref")})}).undelegate("#activeBuffDetails .build-it","click.activateItem").delegate("#activeBuffDetails .build-it","click.activateItem",function(){activateItem($(this).attr("ref"))}).undelegate("#activeBuffDetails .buyAndActivate.dm.build-it_disabled","click.activateItem").delegate("#activeBuffDetails .buyAndActivate.dm.build-it_disabled","click.activateItem",function(){if(vacation){return}errorBoxDecision(LocalizationStrings.error,translation.buyDMDecision,LocalizationStrings.yes,LocalizationStrings.no,function(){window.location.href=$("#darkmatter_box a").attr("href")})}).undelegate("#activeBuffDetails .close_detail","click.changeHash").delegate("#activeBuffDetails .close_detail","click.changeHash",function(){$.bbq.pushState({item:""})})}function initBuffBar(){$(window).unbind("hashchange.openBuffBar").bind("hashchange.openBuffBar",function(k){var l=$.deparam.fragment(k.fragment);if(typeof(l.item)!="undefined"){var f=$("#buffBar .activate_item");$("#buffBar a").removeClass("active");var j=l.item;if(j!=""){if($("#activeBuffDetails:visible").length){if(typeof(inventoryObj.items_inventory[j])=="undefined"){var g=$("#activeBuffDetails .detail_button").filter(":first");$.bbq.pushState({item:g.attr("ref")});return}$("#buffBar a[ref='"+l.item+"']").addClass("active");f.addClass("active");$("#noItems").hide();$("#itemDetailBox").show();updateItemDetails(j)}else{$("#buffBar a[ref='"+l.item+"']").addClass("active");f.addClass("active");gfSlider.slideIn(getElementByIdWithCache("detail"),j)}}else{if($("#activeBuffDetails .detail_button").filter(":first").length===0){$("#noItems").show();$("#itemDetailBox").hide()}$("#activeBuffDetails .close_details").click();f.removeClass("active")}}});$(document).undelegate("#buffBar a","click.openDetails").delegate("#buffBar a","click.openDetails",function(){if($(this).hasClass("active")){$.bbq.pushState({item:""})}else{$.bbq.pushState({item:$(this).attr("ref")})}});$("#buffBar .activate_item_div").unbind("click.openDetails").bind("click.openDetails",function(){$("#buffBar .activate_item").click()});$("#buffBar .active_items li:not(.activate_item)").each(function(){$durationEl=$(this).find(".js_duration");$pusherEl=$(this).find(".pusher");startCooldown($durationEl,$pusherEl,32)});$(window).trigger("hashchange")}function getItem(b){if(typeof(inventoryObj.items_inventory[b])!="undefined"){return inventoryObj.items_inventory[b]}return null}function updateItemDetails(e){var j=getItem(e);$("#activeBuffDetails .detail_button").removeClass("active");$('#activeBuffDetails .detail_button[ref="'+e+'"]').addClass("active");$("#activeBuffDetails .js_itemName").html(j.name);$("#activeBuffDetails .js_itemEffect").html(j.effect);$("#activeBuffDetails .js_itemAmount").html(j.amount);if(j.duration){$("#activeBuffDetails .js_itemDuration").html(formatTimeWrapper(j.duration,2,true," ",false,""))}else{if(j.duration===null){$("#activeBuffDetails .js_itemDuration").html(translation.permanent)}else{$("#activeBuffDetails .js_itemDuration").html(translation.now)}}if(j.timeLeft){$("#activeBuffDetails .js_itemTimeLeftTxt").show();$("#activeBuffDetails .js_itemTimeLeft").html(formatTimeWrapper(j.timeLeft,2,true," ",false,""))}else{$("#activeBuffDetails .js_itemTimeLeftTxt").hide()}var g=$("#activationButton");g.attr("ref",e);g.removeClass("buyAndActivate activateItem build-it_disabled build-it dm bp").addClass(j.currency);if(j.amount>0){g.addClass("activateItem").html((j.timeLeft>0)?translation.extend:translation.activate).addClass(j.canBeActivated?"build-it":"build-it_disabled")}else{var f=(j.timeLeft>0)?translation.buyAndExtend:translation.buyAndActivate;f=f.replace(/%price%/,tsdpkt(j.costs));f=f.replace(/%currency%/,translation.currencies[j.currency]);g.addClass("buyAndActivate").html(f).addClass(j.canBeBoughtAndActivated&&j.hasEnoughCurrency?"build-it":"build-it_disabled")}}function activateItem(e){var f={ajax:1,token:activateToken,referrerPage:$.deparam.querystring().page};var j=getItem(e);if(j.amount>0){f.item=e}else{f.buyAndActivate=e}function g(){$.ajax({cache:false,url:inventoryObj.inventoryUrl,data:f,type:"POST",dataType:"json",success:function(c,y,a){activateToken=c.newToken;if(c.error){fadeBox(c.message,true)}else{if(c.message.reload){location.href=getRedirectLink();return}fadeBox(c.message.message,false);if(c.message.buff!=false){e=c.message.buff;var D=getItem(e);var b=true;var F=$(".active_items");var A;F.find("li a").removeClass("active");F.find("li a.activate_item").addClass("active");F.children("li[data-uuid="+D.ref+"]").each(function(){$(this).hide().show("pulsate");$(this).find("a").addClass("active");b=false;A=$(this)});if(b==true){newItem='<li data-uuid="'+D.ref+'"><div class="js_duration" style="display: none;"></div><a href="javascript:void(0);" ref="'+D.ref+'" class="detail_button slideIn active_item active border3px"><div class="pusher" style="height: 0%; "></div><img src="/cdn/img/item-images/'+D.image+'-small.png" alt=""/></a></li>';$(newItem).hide().appendTo(".active_items").filter(":last").show("pulsate");A=$(newItem);if(typeof(c.message.upgraded)!="undefined"){for(var B in c.message.upgraded){var d=c.message.upgraded[B];F.children("li[data-uuid="+d+"]").each(function(){$(this).slideFadeToggle(1000)})}}}}var C=A.find(".pusher");var E=A.find(".js_duration");E.attr("data-total-duration",c.message.totalDuration).text(c.message.item.timeLeft);startCooldown(E,C,32);getAjaxResourcebox();$.ajax({type:"POST",url:detailUrl,data:{type:e},beforeSend:function(){$("#detailWrapper .detail_screen").html('<p id="ajaxLoad">'+LocalizationStrings.loading+"</p>")},success:function(k){$("#detailWrapper .detail_screen").html(k)}})}},error:function(a){fadeBox("Error!",true)}})}if(j.isAnUpgrade){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,g);return}g()}function initEmpireEquipment(){$(".overview_equipment .item_img_box .level").each(function(){startCooldown($(this))})}function startCooldown(e,f,g){if(!f||!g){if($.trim(e.text()).match(/^\d+$/)){new countdownWithTickFunction(e[0],parseInt($.trim(e.text())),parseInt(e.attr("data-total-duration")),function(){location.href=getRedirectLink()},function(b,a){var d=1-(b/a);var c=e.parents(".item_img");var q=c.find(".item_img_box").height();var p=Math.floor(q*d);c.find(".pusher").css("height",p+"px")})}}if($.trim(e.text()).match(/^\d+$/)){var j=new countdownWithTickFunction(e[0],parseInt($.trim(e.text())),parseInt(e.attr("data-total-duration")),function(){location.href=getRedirectLink()},function(b,a){var d=1-(b/a);var c=Math.floor(g*d);f.css("height",c+"px")})}}function errorBoxAsArray(b){if(b.type=="notify"){notifyBoxAsArray(b)}else{if(b.type=="decision"){errorBoxDecision(b)}else{if(b.type=="fadeBox"){fadeBox(b.text,b.failed)}}}}function notifyBoxAsArray(b){errorBoxNotify(b.title,b.text,b.buttonOk,String(b.okFunction),b.removeOpen,b.modal)}function fadeBox(d,e,f){if(e){$("#fadeBoxStyle").attr("class","failed")}else{$("#fadeBoxStyle").attr("class","success")}$("#fadeBoxContent").html(d);$("#fadeBox").stop(false,true).show().fadeOut(10000,f)}function decisionBoxAsArray(b){errorBoxDecision(b.title,b.text,b.buttonOk,b.buttonNOk,String(b.okFunction),String(b.nokFunction),b.removeOpen)}function errorBoxDecision(u,w,B,l,y,A){var q=$("#errorBoxDecision");q.find("#errorBoxDecisionHead").html(u);q.find("#errorBoxDecisionContent").html(w);var p=function(a){a.stopPropagation();q.dialog("destroy");if(typeof(y)=="function"){y()}};var x=function(a){a.stopPropagation();q.dialog("destroy");if(typeof(A)=="function"){A()}};q.find(".yes").unbind("click").bind("click",p).find("#errorBoxDecisionYes").html(B);q.find(".no").unbind("click").bind("click",x).find("#errorBoxDecisionNo").html(l);Tipped.hideAll();q.dialog({resizable:false,modal:true,title:u,close:x,width:400,dialogClass:"errorBox"})}function errorBoxNotify(q,p,g,l){var j=$("#errorBoxNotify");j.find("#errorBoxNotifyHead").html(q);j.find("#errorBoxNotifyContent").html(p);var k=function(a){a.stopPropagation();j.dialog("destroy");if(typeof(l)=="function"){l()}else{if(typeof(window[l])=="function"){window[l]()}}};j.find(".ok").unbind("click").bind("click",k).find("#errorBoxNotifyOk").html(g);Tipped.hideAll();j.dialog({resizable:false,modal:true,title:q,close:k,width:400,dialogClass:"errorBox"})}function eventBDayInitGalaxy(){if(isMobile){$(".js_bday_details").hide();$(".bdaySlotBox .name").click(function(b){$(".row").children().each(function(){if($(this).html().trim()){$(this).removeClass("active")}});$(".bdaySlotBox .name").removeClass("active");$(".js_detailRow").hide();$(this).toggleClass("active");if($(b.target).attr("class").indexOf("planet")!==-1){$(".js_detailRowPlanet17").toggle()}else{if($(b.target).attr("class").indexOf("debris")!==-1){$(".js_detailRowDebris17").toggle()}}})}}function eventBDayInit(){var b=$(".event_box");$("#eventBDayWrapper").click(function(a){if($(a.target).attr("id")==="BDayContent"||$(a.target).attr("id")==="BDayEventClose"||$(a.target).closest("#BDayHeader").length>0){b.hide();$(".bday_box").removeClass("active")}a.stopPropagation()});$(".bday_box").click(function(d){$(".bday_box").removeClass("active");var a=$(d.target).closest(".bday_box").attr("id").replace("box","");b.removeClass().addClass("event_box "+eventBoxData[a].eventTypeClass);if(eventBoxData[a]!==undefined){b.attr("id","eventBox"+a).show();$("#box"+a).addClass("active");if(eventBoxData[a].eventTypeClass!=="future"){$("#eventBox"+a+" #BDayEventDate").html(eventBoxData[a].date+": ")}else{$("#eventBox"+a+" #BDayEventDate").html("")}$("#eventBox"+a+" #BDayEventTitle").html(eventBoxData[a].title);$("#eventBox"+a+" #BDayofficerImg").attr("src",eventBoxData[a].eventOfficerImgSrc);if(eventBoxData[a].eventTypeClass!=="future"||eventBoxData[a].txtChronic!==undefined){$("#eventBox"+a+" #BDayEventTxtChronic").html(eventBoxData[a].txtChronic);$("#eventBox"+a+" #BDayChronic").show()}else{$("#eventBox"+a+" #BDayChronic").hide()}if(eventBoxData[a].eventImgSrc===undefined&&eventBoxData[a].eventTypeClass==="future"){$("#eventBox"+a+" #BDayEventImg").attr("src","/cdn/img/event-birthday/gift.png")}else{$("#eventBox"+a+" #BDayEventImg").attr("src",eventBoxData[a].eventImgSrc)}if(eventBoxData[a].eventTxtDesc===undefined){$("#eventBox"+a+" #BDayEventTxtDesc").html("")}else{$("#eventBox"+a+" #BDayEventTxtDesc").html(eventBoxData[a].eventTxtDesc)}$("#eventBox"+a+" #BDayEventPastTxt").hide();if(eventBoxData[a].eventTypeClass==="past"){$("#eventBox"+a+" #BDayEventPastTxt").html(eventPastTxt).show()}$("#eventBox"+a+" #BDayEventBtnCTA").hide();if((eventBoxData[a].eventTypeClass!==("past"||"future"))&&eventBoxData[a].btnCTA!==undefined){$("#eventBox"+a+" #BDayEventBtnCTA").html(eventBoxData[a].btnCTA).attr("href",eventBoxData[a].btnCTALink).show()}}})}function initBDayEventHints(){$(document).undelegate(".event_build_faster, .event_active_hint","click").delegate(".event_build_faster, .event_active_hint","click",function(b){b.stopPropagation();$(this).siblings(".detail_button").click()})}function hideRows(f){var e=$.parseJSON(f);for(var d in e.rows){$("#eventRow-"+e.rows[d]).hide();$(".union"+e.rows[d]).hide()}}function initEventTable(){$(".eventFleet:odd").addClass("odd");$(".partnerInfo:even").addClass("part-even");$(".partnerInfo").hide();$(document).undelegate(".toggleDetails","click").delegate(".toggleDetails","click",function(){var b=$("."+$(this).attr("rel"));if($(b).is(":hidden")){$(b).show();$(this).parents("tr").addClass("detailsOpened").removeClass("detailsClosed")}else{$(b).hide();$(this).parents("tr").addClass("detailsClosed").removeClass("detailsOpened")}})}function initExodus(){if($("#exodus-indicator").length&&exodus.ready==false){exodus.ready=true;exodus.createIndicator();var d=function(a){if($("#exodus-timer").hasClass("end-soon")){return}if(a<86400){$("#exodus-timer").addClass("end-soon")}};var c=parseInt($("#exodus-timer").text());d(c);new simpleCountdown(getElementByIdWithCache("exodus-timer"),c,function(){$("#exodus-timer").remove()},function(a){d(a)})}}var exodus={ready:false,noServers:true,secondaryShown:false,createIndicator:function(){exodus.indicator=$("#exodus-indicator");if(exodus.indicator.length>0){exodus.indicator.bind("click",exodus.showDialog)}},appendServerRow:function(j,l,p,u){var w=(exodus.data["migration-host"]==l.host);var k=$('<li class="'+(exodus.odd++%2?"odd":"even")+'" id="server-'+l.id+'"/>').bind("click",function(){if($(this).hasClass("disabled")){return}else{if($(this).hasClass("row-selected")){exodus.confirmButton.removeClass("confirm");$(this).removeClass("row-selected");exodus.markedServer=null}else{exodus.markedServer=l;if(exodus.markedServer!=exodus.selectedServer){exodus.confirmButton.addClass("confirm")}else{if(exodus.confirmButton.hasClass("confirm")){exodus.confirmButton.removeClass("confirm")}}j.find("li").removeClass("row-selected");$(this).addClass("row-selected")}}}).hide().append($('<span class="exodus-universe-treeview-column-checkbox"/>').append($("<span/>"))).append($('<span class="exodus-universe-treeview-column-name"/>').text(l.name)).append($('<span class="exodus-universe-treeview-column-startdate"/>').text(l.since)).append($('<span class="exodus-universe-treeview-column-free-spaces"/>')).append($('<span class="exodus-universe-treeview-column-features"/>').text(l.features));j.append(k);var q=$('<li id="wait-server-'+l.id+'"/>').append($('<img alt="'+exodus.data.translations.loading+'" src="'+exodus.data["load-image"]+'"/>'));j.append(q);if(w){exodus.markedServer=l;exodus.selectedServer=l;k.addClass("server-selected");k.addClass("row-selected")}$.jsonp({url:"http://"+l.host+"/service/exodus.php?action=getServerInfo&data="+l.data+"&callback=?",error:function(){exodus.handleError(l.id,exodus.data.translations["error-no-server"]);$("#server-"+l.id).show();$("#wait-server-"+l.id).remove();if(exodus.noServers&&p){exodus.showSecondaryServers(j)}},success:function(a){if(!a.currentPlayerCount){exodus.handleError(l.id,exodus.data.translations["error-no-server"]);$("#server-"+l.id).show();$("#wait-server-"+l.id).remove();return}$("#server-"+l.id+" .exodus-universe-treeview-column-free-spaces").text(a.freeSlots);if(a.alreadyMigrating){exodus.handleSuccess(l.id,exodus.data.translations["success-server-selected"]);if(!u){exodus.noServers=false}}else{if(a.alreadyRegistered){exodus.handleError(l.id,exodus.data.translations["error-account"])}else{if(a.usernameInUse){exodus.handleError(l.id,exodus.data.translations["error-name-in-use"])}else{if(a.freeSlots<=0){exodus.handleError(l.id,exodus.data.translations["error-no-free-slots"])}else{if(!u){exodus.noServers=false}}}}}if(exodus.noServers&&p){exodus.showSecondaryServers(j)}$("#server-"+l.id).show();$("#wait-server-"+l.id).remove()}})},handleError:function(d,c){$("#server-"+d).find("span.exodus-success").remove();$("#server-"+d).find("span.exodus-error").remove();$("#server-"+d).append('<span class="exodus-error"><b>'+exodus.data.translations["error-impossible"]+"</b><br/>"+c+"</span>");$("#server-"+d).addClass("disabled")},handleSuccess:function(d,c){$("#server-"+d).find("span.exodus-success").remove();$("#server-"+d).find("span.exodus-error").remove();$("#server-"+d).append('<span class="exodus-success"><b>'+c+"</b></span>")},showSelectionTab:function(){exodus.universeTreeviewHeader=$('<div id="exodus-universe-treeview-header"/>').append($('<span class="exodus-universe-treeview-column-checkbox"/>').text("\u2714").css("visibility","hidden")).append($('<span class="exodus-universe-treeview-column-name"/>').text(exodus.data.translations["uni-selection-name"])).append($('<span class="exodus-universe-treeview-column-startdate"/>').text(exodus.data.translations["uni-selection-start"])).append($('<span class="exodus-universe-treeview-column-free-spaces"/>').text(exodus.data.translations["uni-selection-free-spaces"])).append($('<span class="exodus-universe-treeview-column-features"/>').text(exodus.data.translations["uni-selection-specifics"]));var e=$('<ul id="exodus-universe-treeview"/>');exodus.confirmButton=exodus.createButton(exodus.data.translations["uni-selection-confirm"]);exodus.revertButton=exodus.createButton(exodus.data.translations["uni-selection-revert"]);exodus.confirmButton.bind("click",function(){if(!$(this).hasClass("confirm")||exodus.markedServer==null){return}var a=exodus.markedServer;$.jsonp({url:"http://"+a.host+"/service/exodus.php?action=requestMigration&data="+a.data+"&callback=?",error:function(){exodus.handleError(a.id,exodus.data.translations["error-no-server"])},success:function(b){if(b.errorMessage){exodus.handleError(a.id,exodus.data.translations["error-no-server"])}else{if(exodus.selectedServer!=null){e.find("li").removeClass("row-selected");e.find("li").removeClass("server-selected");$("#server-"+exodus.selectedServer.id).find("span.exodus-success").remove();$("#server-"+exodus.selectedServer.id).find("span.exodus-error").remove()}exodus.indicator.attr("data-migration-host",a.host);exodus.data["migration-host"]=a.host;$("#exodus-indicator-waiting").attr("id","exodus-indicator-acknowledged");exodus.handleSuccess(a.id,exodus.data.translations["success-server-selected"]);exodus.revertButton.addClass("cancel");$("#server-"+a.id).addClass("server-selected");exodus.selectedServer=a;var c=$("#server-"+a.id).find("span.exodus-universe-treeview-column-free-players");c.text(parseInt(c.text())-1);exodus.confirmButton.removeClass("confirm")}}})});exodus.revertButton.bind("click",function(){if(!$(this).hasClass("cancel")||exodus.selectedServer==null){return}var a=exodus.selectedServer;$.jsonp({url:"http://"+a.host+"/service/exodus.php?action=cancelMigration&data="+a.data+"&callback=?",error:function(){exodus.closeDialog()},success:function(b){if(b.errorMessage){exodus.closeDialog()}else{exodus.indicator.attr("data-migration-host","");$("#exodus-indicator-acknowledged").attr("id","exodus-indicator-waiting");e.find("li").removeClass("row-selected");e.find("li").removeClass("server-selected");$("#server-"+a.id).find("span.exodus-success").remove();$("#server-"+a.id).find("span.exodus-error").remove();exodus.confirmButton.removeClass("confirm");exodus.revertButton.removeClass("cancel");var c=$("#server-"+a.id).find("span.exodus-universe-treeview-column-free-players");c.text(parseInt(c.text())+1);exodus.markedServer=null;exodus.selectedServer=null}}})});if(exodus.data["migration-host"]!=""){exodus.revertButton.addClass("cancel")}exodus.tabContent.append(exodus.universeTreeviewHeader).append(e).append(exodus.confirmButton).append(exodus.revertButton);exodus.odd=0;for(var d=0;d<exodus.data["primary-servers"].length;d++){var f=(exodus.data["primary-servers"].length==d+1);exodus.appendServerRow(e,exodus.data["primary-servers"][d],f,false)}if(!exodus.secondaryShown){for(var d=0;d<exodus.data["secondary-servers"].length;d++){if(exodus.data["migration-host"]==exodus.data["secondary-servers"][d]["host"]){exodus.appendServerRow(e,exodus.data["secondary-servers"][d],false,true)}}exodus.secondaryShown=true}},showSecondaryServers:function(d){for(var c=0;c<exodus.data["secondary-servers"].length;c++){exodus.appendServerRow(d,exodus.data["secondary-servers"][c],false,true)}exodus.secondaryShown=true},showDialog:function(){if(exodus.isOpen!=null){return}exodus.data={"load-image":exodus.indicator.attr("data-load-image"),"exodus-start":exodus.indicator.attr("data-exodus-start"),"exodus-end":exodus.indicator.attr("data-exodus-end"),"next-migration":exodus.indicator.attr("data-next-migration"),translations:$.parseJSON(exodus.indicator.attr("data-translations")),"migration-host":exodus.indicator.attr("data-migration-host"),"primary-servers":$.parseJSON(exodus.indicator.attr("data-primary-servers")),"secondary-servers":$.parseJSON(exodus.indicator.attr("data-secondary-servers")),"user-data":exodus.indicator.attr("data-user-data"),"user-validation":exodus.indicator.attr("data-user-validation"),"see-dialog":exodus.indicator.attr("data-user-see-dialog"),"ally-id":exodus.indicator.attr("data-user-ally-id"),"buddy-amount":exodus.indicator.attr("data-user-buddy-amount")};if(exodus.data["user-validation"]==0){alert(exodus.data.translations["error-user-not-validated"]);return}exodus.isOpen=true;exodus.selectedServer=null;exodus.markedServer=null;exodus.dialog=$('<div id="exodus-dialog"/>');exodus.overlay=$('<div id="exodus-overlay"/>');var j=$('<div id="exodus-header"/>');var f=$('<div id="exodus-close" class="ui-icon ui-icon-closethick"/>');var k=$('<div id="exodus-content"/>');var l=$('<div id="exodus-top-content"/>');var g=$('<ul id="exodus-tab-bar"/>');exodus.overlay.bind("click",exodus.closeDialog);f.bind("click",exodus.closeDialog);j.append($('<div id="exodus-header-content"/>').text(exodus.data.translations["exodus-dialog-title"]));l.text(exodus.data.translations["exodus-period"]+" "+exodus.data["exodus-start"]+" â€“ "+exodus.data["exodus-end"]);if(exodus.data["next-migration"]!=""){l.append($('<span id="exodus-next-migration"/>').text(exodus.data["next-migration"]));l.append($("<span/>").text(": "+exodus.data.translations["next-migration-processing"]))}allyView=$('<li id="ally-show"/>').text(exodus.data.translations["tab-ally-mebers"]);allyView.bind("click",function(){exodus.showAllyMemberTab()});buddyView=$('<li id="buddy-show"/>').text(exodus.data.translations["tab-buddies"]);buddyView.bind("click",function(){exodus.showBuddyTab()});serverView=$('<li id="uni-select"/>').text(exodus.data.translations["tab-uni-selection"]);serverView.bind("click",function(){exodus.showServerSelection()});rulesView=$('<li id="rules-show"/>').text(exodus.data.translations["tab-rules"]);rulesView.bind("click",function(){exodus.showRulesTab()});g.append(serverView);if(exodus.data["ally-id"]>0){g.append(allyView)}if(exodus.data["buddy-amount"]>0){g.append(buddyView)}g.append(rulesView);k.append(l).append(g);exodus.dialog.append(j).append(k).append(f);$("body").append(exodus.overlay).append(exodus.dialog);if(exodus.data["see-dialog"]=="0"){exodus.showRulesTab();exodus.data["see-dialog"]="1";exodus.indicator.attr("data-user-see-dialog",1);$.jsonp({url:"/service/exodus.php?action=seeDialog&data="+exodus.data["user-data"]+"&callback=?",error:function(a){alert("TEST: "+exodus.data["user-data"])},success:""})}else{exodus.showServerSelection()}},closeDialog:function(){exodus.dialog.remove();exodus.overlay.remove();exodus.isOpen=null},createButton:function(b){return $('<div class="exodus-button"/>').append($('<div class="exodus-button-left"/>')).append($('<div class="exodus-button-label"/>').text(b)).append($('<div class="exodus-button-right"/>'))},showServerSelection:function(){this.resetView("#uni-select");exodus.tabContent=$('<div id="exodus-tab-content"/>');exodus.showSelectionTab();exodus.tabContent.appendTo("#exodus-content")},showAllyMemberTab:function(){this.resetView("#ally-show");if(exodus.allyMemberContent!=null){exodus.allyMemberContent.appendTo("#exodus-content")}else{exodus.allyMemberContent=$('<div id="exodus-ally-content"/>');$.jsonp({url:"/service/exodus.php?action=getAllyMemberSelection&data="+exodus.data["user-data"]+"&callback=?",error:function(){},success:function(e){if(e.errorMessage){exodus.closeDialog()}else{var f=$('<div id="exodus-universe-treeview-header"/>').append($('<span class="exodus-universe-treeview-column-name"/>').text(exodus.data.translations["ally-members-name"])).append($('<span class="exodus-universe-treeview-column-startdate"/>').text(exodus.data.translations["ally-members-server"]));var d=$('<div id="exodus-universe-treeview"/>');for(i=0;i<e.length;i++){row=$('<li id="server-'+i+'" class="'+(i%2?"odd":"even")+'"/>').append($('<span class="exodus-universe-treeview-column-name"/>').text(e[i].db_character));if(e[i].server_name!=null){row.append($('<span class="exodus-universe-treeview-column-name"/>').text(e[i].server_name))}else{row.append($('<span class="exodus-universe-treeview-column-name"/>').text(exodus.data.translations["ally-member-no-selction"]))}d.append(row)}exodus.allyMemberContent.append(f);exodus.allyMemberContent.append(d);$("#exodus-content").append(exodus.allyMemberContent)}}})}},showBuddyTab:function(){this.resetView("#buddy-show");if(exodus.buddyContent!=null){exodus.buddyContent.appendTo("#exodus-content")}else{exodus.buddyContent=$('<div id="exodus-ally-content"/>');$.jsonp({url:"/service/exodus.php?action=getBuddySelection&data="+exodus.data["user-data"]+"&callback=?",error:function(){},success:function(d){if(d.errorMessage){exodus.closeDialog()}else{header=$('<div id="exodus-universe-treeview-header"/>').append($('<span class="exodus-universe-treeview-column-name"/>').text(exodus.data.translations["ally-members-name"])).append($('<span class="exodus-universe-treeview-column-startdate"/>').text(exodus.data.translations["ally-members-server"]));var c=$('<div id="exodus-universe-treeview"/>');for(i=0;i<d.length;i++){row=$('<li id="server-'+i+'" class="'+(i%2?"odd":"even")+'"/>').append($('<span class="exodus-universe-treeview-column-name"/>').text(d[i].db_character));if(d[i].server_name!=null){row.append($('<span class="exodus-universe-treeview-column-name"/>').text(d[i].server_name))}else{row.append($('<span class="exodus-universe-treeview-column-name"/>').text(exodus.data.translations["ally-member-no-selction"]))}c.append(row)}exodus.buddyContent.append(header);exodus.buddyContent.append(c);$("#exodus-content").append(exodus.buddyContent)}}})}},showRulesTab:function(){this.resetView("#rules-show");rules=new Array("uni-fusion","pre-exodus","exodus-phase","post-exodus","exodus-uni","target-uni");if(exodus.rulesContent!=null){exodus.rulesContent.appendTo("#exodus-content")}else{exodus.rulesContent=$('<div id="exodus-rules-content"/>');rule=$('<div class="exodus_rule"/>');for(var b=0;b<rules.length;b++){rule.append($('<h2 class="exodus-rule-title" />').text(exodus.data.translations["title-"+rules[b]]));rule.append($('<p class="exodus-rule-description" />').text(exodus.data.translations["description-"+rules[b]]));exodus.rulesContent.append(rule)}$("#exodus-content").append(exodus.rulesContent)}},resetView:function(b){if($(b).hasClass("selected")){return}if($("#uni-select").hasClass("selected")){exodus.tabContent.detach()}else{if($("#buddy-show").hasClass("selected")){exodus.buddyContent.detach()}else{if($("#ally-show").hasClass("selected")){exodus.allyMemberContent.detach()}else{if($("#rules-show").hasClass("selected")){exodus.rulesContent.detach()}}}}$("#uni-select").removeClass("selected");$("#ally-show").removeClass("selected");$("#buddy-show").removeClass("selected");$("#rules-show").removeClass("selected");$(b).addClass("selected")}};function initFleet1(){checkShips("shipsChosen");initToggleHeader();$(".combatunits").unbind("change").bind("change",function(){setTemplate(shipTemplates[$(this).val()],maxShips);checkShips("shipsChosen")});if(!isIE){$(window).unbind("blur").bind("blur",function(){$("#buttonz input").blur()})}}function setTemplate(d,e){for(var f in d){if(!$("#ship_"+f).attr("disabled")){$("#ship_"+f).val(d[f])}if(typeof e[f]=="undefined"){e[f]=0}checkIntInput("#ship_"+f,0,e[f])}}function resetForm(){$(".fleetValues").val("")}function checkShips(l){if(document.forms[l]!=undefined){var p=0;var j=document.forms[l].length;for(var q=0;q<j;q++){var g=document.forms[l].elements[q].id;if(typeof g!="undefined"){expl=g.split("_");if(expl[0]=="ship"){value=document.forms[l].elements[q].value;if(!$("#"+g).attr("disabled")&&value!=""){p=p+value}}}}var k="";if(p==0||!sendingEnabled){validated=false;$("#continue").attr("class","off");k=loca.fleetNoSelection;if(!sendingEnabled){k=loca.fleetNoFreeSlots}}else{validated=true;$("#continue").attr("class","on")}$("#allornone .info").html(k)}}function initStandardFleet(){$(".list tr:even").addClass("alt");$(".standardFleetSubmit").unbind("click").bind("click",function(){$(this).parents("form").submit()});$(".standardFleetReset").unbind("click").bind("click",function(){$(this).parents("form")[0].reset()});$(".changeFleet").unbind("click").bind("click",function(){$(".combatunits").val($(this).attr("rel")).trigger("change");$(this).parents(".ui-dialog").find(".ui-dialog-titlebar-close").click()})}function setShipsFleet(e,j,f){$("#template_id").val(f);$("#template_name").val(j);for(var g in e){$("#ship"+g).val(e[g])}}function toggleMaxShips(c,d){if(parseInt($("#ship_"+c).val())!==d){$("#ship_"+c).val(d)}else{$("#ship_"+c).val("")}}function initFleet2(){updateVariables();timerHandler.appendCallback(updateTimes);$("#galaxy").focus();initToggleHeader();initBackButton();if(!isIE){$(window).unbind("blur").bind("blur",function(){$("#mission input").blur()})}}function initBackButton(){$("#back").unbind("click").bind("click",function(){$(this).parents("form").attr("action",returnLink).submit()})}function prepareVariables(){checkCoords();speed=$("#speed").val()}function setTType(b){b=b==null?$("#type").val():b;if(b==1){$("#pbutton").attr("class","planet_selected")}else{$("#pbutton").attr("class","planet")}if(b==2){$("#dbutton").attr("class","debris_selected")}else{$("#dbutton").attr("class","debris")}if(b==3){$("#mbutton").attr("class","moon_selected")}else{$("#mbutton").attr("class","moon")}if(b==1){$("#targetPlanetName").html(locaAllPlanet)}else{if(b==2){$("#targetPlanetName").html(locaAllMoon)}else{if(b==3){$("#targetPlanetName").html(locaAllDebris)}}}$("#type").val(b)}function shortLinkChange(b){if(b!=null){value=$("#aksbox").val()}else{value=$("#slbox").val()}if(value=="-"){return}else{parts=value.split("#");$("#galaxy").val(parts[0]);$("#system").val(parts[1]);$("#position").val(parts[2]);setTType(parts[3]);$("#targetPlanetName").html(parts[4]);targetGalaxy=parts[0];targetSystem=parts[1];targetPosition=parts[2]}}function handleUnion(){value=$("#aksbox").val();if(value=="-"){document.details.union.value=0;document.details.mission.value=missionNone}else{parts=value.split("#");document.details.union.value=parts[5];document.details.mission.value=missionUnionattack}}function hideStatusBar(){if($(".fleetStatus")&&(targetGalaxy!=defaultTargetGalaxy||targetSystem!=defaultTargetSystem||targetPosition!=defaultTargetPosition)){$(".fleetStatus").hide();$("input[name='mission']").value=""}}function checkCoords(){checkIntInput("#galaxy",1,maxGalaxy);checkIntInput("#system",1,maxSystem);checkIntInput("#position",1,maxPosition);targetGalaxy=$("#galaxy").val();targetSystem=$("#system").val();targetPosition=$("#position").val();if(targetPosition==16){setTType(1);modifyPlanetName();checkOk()}}function checkTarget(){var d=checkUrl;var c=$("#details").serialize();c=new Object();c.galaxy=$("#galaxy").val();c.system=$("#system").val();c.planet=$("#position").val();c.type=$("#type").val();if($("form[name='details'] input[name='am"+colonizationID+"']").length>0&&$("form[name='details'] input[name='am"+colonizationID+"']").val()>0){c.cs=1}if($("form[name='details'] input[name='am"+recyclerID+"']").length>0&&$("form[name='details'] input[name='am"+recyclerID+"']").val()>0){c.recycler=1}$.post(d,c,displayError)}function updateTimes(){var e=serverTime.getSeconds();var g=duration;serverTime.setSeconds(e+0.5);var f=getFormatedDate(serverTime.getTime()+1000*g,"[d].[m].[y] [G]:[i]:[s]");var j=getFormatedDate(serverTime.getTime()+1000*2*g,"[d].[m].[y] [G]:[i]:[s]");if(document.getElementById){$("#arrivalTime").html(f);$("#returnTime").html(j)}}function initFleet3(){setInterval(updateTimes,1000);$("#metal").focus();initToggleHeader();initBackButton();if($("#missions .on .selected").length){$("#missions .on .selected")[0].onclick()}}function updateHoldingOrExpTime(){if($('form input[name="mission"]').val()==missionHold){$('form input[name="holdingOrExpTime"]').val($('form input[name="holdingtime"]').val());holdingTime=$('form [name="holdingtime"]').val()}else{if($('form input[name="mission"]').val()==missionExpedition){$('form input[name="holdingOrExpTime"]').val($('form input[name="expeditiontime"]').val());holdingTime=$('form [name="expeditiontime"]').val()}else{$('form input[name="holdingOrExpTime"]').val(0);holdingTime=0}}}function checkRessourceByType(g){var f=getValue($("#"+g).val());var e=0;var j=0;if(g=="metal"){e=metalOnPlanet;j=cargoSpace-crystal-deuterium}else{if(g=="crystal"){e=crystalOnPlanet;j=cargoSpace-metal-deuterium}else{if(g=="deuterium"){e=deuteriumOnPlanet;j=cargoSpace-metal-crystal}else{e=metalOnPlanet;j=cargoSpace-crystal-deuterium}}}if(f!=""){intVal=parseInt(f);intVal=isNaN(intVal)?0:intVal;intVal=Math.abs(intVal);intVal=Math.min(intVal,e);if(intVal>j){intVal=j}updateRessVarByType(g,intVal);formatNumber($("#"+g),intVal)}else{updateRessVarByType(g,0)}}function updateRessVarByType(d,c){c=c;if(d=="metal"){metal=c}else{if(d=="crystal"){crystal=c}else{if(d=="deuterium"){deuterium=c}else{metal=c}}}}function resetByRessourceType(b){if(b=="metal"){metal=0}if(b=="crystal"){crystal=0}if(b=="deuterium"){deuterium=0}$("#"+b).val(0);updateVariables()}function maxMetal(){var b;b=cargoSpace-crystal-deuterium;b=Math.max(b,0);b=Math.min(b,metalOnPlanet);metal=Math.max(metal,b);formatNumber($("#metal"),metal)}function maxCrystal(){var b;b=cargoSpace-metal-deuterium;b=Math.max(b,0);b=Math.min(b,crystalOnPlanet);crystal=Math.max(crystal,b);formatNumber($("#crystal"),crystal)}function maxDeuterium(){var b;b=cargoSpace-metal-crystal;b=Math.max(b,0);b=Math.min(b,deuteriumOnPlanet-consumption);b=Math.max(b,0);deuterium=Math.max(deuterium,b);formatNumber($("#deuterium"),deuterium)}function maxAll(){metal=0;crystal=0;deuterium=0;maxMetal();maxCrystal();maxDeuterium()}function updateTimes(){var f=serverTime.getSeconds();var j=duration;var k=holdingTime*3600;durationAKS=durationAKS-1;serverTime.setSeconds(f+0.5);var g=getFormatedDate(serverTime.getTime()+1000*j,"[d].[m].[y] [G]:[i]:[s]");var l=getFormatedDate(serverTime.getTime()+1000*((2*j)+k),"[d].[m].[y] [G]:[i]:[s]");$("#arrivalTime").text(g);$("#returnTime").text(l);if(durationAKS>duration){$("#durationAKS").html(getFormatedTime(durationAKS))}}function setSelected(b){if(oldElem){oldElem.removeClass("selected")}elem=$("#missionButton"+b);oldElem=elem;elem.addClass("selected");if((b==1)||(b==2)||(b==6)||(b==9)){isAggressiveMission=true}else{isAggressiveMission=false}$("#fightAfterRetreat,#aks,#holdtimeline,#expeditiontimeline").hide();switch(b){case 1:$("#fightAfterRetreat").show();break;case 2:$("#aks").show();break;case 5:$("#holdtimeline").show();break;case 15:$("#expeditiontimeline").show();break}}function updateMission(g,e,f,j){$(".missionName").text(g);$(".mission_description").text(e);$("#missionNameWrapper").removeClass("off");$(".briefing_overlay").hide();if(f=="off"){$("#missionNameWrapper").addClass("off");$(".briefing_overlay").show()}$('form input[name="mission"]').val(j);updateHoldingOrExpTime();updateVariables()}var validated=false;var sendingEnabled=true;var shipIDs=new Array();var speeds=new Array();var completeConsumptions=new Array();var storageCapacity=null;var probeStorageCapacity=null;var probeCompleteConsumption=null;var maxSpeed=0;var speedFactor=1;var maxGalaxy=null;var maxSystem=null;var maxPosition=null;var currentGalaxy=1;var currentSystem=1;var currentPosition=1;var currentPlanetType=1;var targetGalaxy=1;var targetSystem=1;var targetPosition=1;var defaultTargetGalaxy=1;var defaultTargetSystem=1;var defaultTargetPosition=1;var speed=0;var holdingTime=0;var metal=0;var crystal=0;var deuterium=0;var currentDeuterium=0;var returnLink="";var checkUrl="";var colonizationID=0;var missionNone=null;var missionUnionattack=null;var distance=5;var duration=0;var consumption=0;var cargoSpace=0;var cargoLeft=0;var locaAllPlanet="";var locaAllMoon="";var locaAllDebris="";var storageCapacity=0;var probeStorageCapacity=0;var probeCompleteConsumption=0;var metal=0;var crystal=0;var deuterium=0;var distance=5;var duration=0;var consumption=0;var cargoSpace=0;var metalOnPlanet=0;var crystalOnPlanet=0;var deuteriumOnPlanet=0;var returnLink="";var missionHold=null;var missionExpedition=null;var durationAKS=0;var isAggressiveMission=false;function getDistance(){var d;var e;var f;d=Math.abs(currentGalaxy-targetGalaxy);e=Math.abs(currentSystem-targetSystem);f=Math.abs(currentPosition-targetPosition);if(d!=0){return d*20000}else{if(e!=0){return e*5*19+2700}else{if(f!=0){return f*5+1000}else{return 5}}}}function getDuration(){return Math.round(((35000/speed*Math.sqrt(distance*10/maxSpeed)+10)/speedFactor))}function getConsumption(g){var j=0;var e=0;var f=0;for(i=0,maxI=shipIDs.length;i<maxI;i++){if(g==0||g==null||shipIDs[i]==g){f++;shipSpeedValue=35000/(duration*speedFactor-10)*Math.sqrt(distance*10/speeds[i]);e+=completeConsumptions[i]*holdingTime;j+=completeConsumptions[i]*distance/35000*((shipSpeedValue/10)+1)*((shipSpeedValue/10)+1)}}if(f>0){j=Math.round(j)+1;if(holdingTime>0){j+=Math.max(Math.floor(e/10),1)}return j}else{return 0}}function getFreeStorage(){var b=storageCapacity;b-=consumption;b-=(probeStorageCapacity-getConsumption(210));return b}function updateVariables(){if(currentPage=="fleet2"){prepareVariables()}distance=getDistance();duration=getDuration();consumption=getConsumption();cargoSpace=getFreeStorage();cargoLeft=cargoSpace-metal-crystal-deuterium;refreshFormData()}function refreshFormData(){$("#duration").html(formatTime(duration)+" h");$("#distanceValue").html(tsdpkt(distance));styleClass=cargoSpace<0?"overmark":"undermark";$("#storage").html('<span class="'+styleClass+'">'+tsdpkt(cargoSpace)+"</span>");styleClass=consumption>currentDeuterium?"overmark":"undermark";$("#consumption").html('<span class="'+styleClass+'">'+tsdpkt(consumption)+"</span>");styleClass=cargoLeft<0?"overmark":"undermark";$("#remainingresources").html('<span class="'+styleClass+'">'+tsdpkt(cargoLeft)+"</style>");refreshBar();setTType();if(currentPage=="fleet2"){modifyPlanetName()}checkOk()}function refreshBar(){var j=112;var e=300;var g=cargoLeft;var f=cargoSpace;g=Math.max(g,0);g=Math.min(g,f);offset=(e-j)-((f-g)/f)*(e-j);if(isNaN(offset)){offset=0}$("#thebar").css("backgroundPosition","-"+offset+"px 0px")}function modifyPlanetName(){newName=getOwnName();if(newName!=""){$("#targetPlanetName").html(newName);$("#statusTarget").html(newName)}hideStatusBar()}function checkOk(){switch(currentPage){case"fleet2":if((currentGalaxy==$("#galaxy").val()&&currentSystem==$("#system").val()&&currentPosition==$("#position").val()&&currentPlanetType==$("#type").val())||$("#galaxy").val()==""||$("#system").val()==""||$("#position").val()==""||consumption>currentDeuterium||cargoSpace<0){validated=false;$("#continue").attr("class","off")}else{validated=true;$("#continue").attr("class","on")}break;case"fleet3":if(isMissionValid()&&cargoLeft>=0){validated=true;$("#start").attr("class","on")}else{validated=false;$("#start").attr("class","off")}break}}function submitOnKey(b){if(b==37){if(system>1){system=parseInt(system)-1}else{system=maxSystems}canLoadContent(galaxy,system)}if(b==39){if(system<maxSystems){system=parseInt(system)+1}else{system=1}canLoadContent(galaxy,system)}if(b==40){if(galaxy>1){galaxy=parseInt(galaxy)-1}else{galaxy=maxGalaxies}canLoadContent(galaxy,system)}if(b==38){if(galaxy<maxGalaxies){galaxy=parseInt(galaxy)+1}else{galaxy=1}canLoadContent(galaxy,system)}}function keyevent(d){var c;if($(":focus").closest(".ui-dialog").length){return true}if(window.event){c=window.event.keyCode}else{if(d){c=d.which}else{return true}}submitOnKey(c)}function getPositionFromCoords(b){tmp=b.substr(1,b.length-2);tmp_array=tmp.split(":");return tmp_array[2]}function launchMissiles(b){var b=$.parseJSON(b);if(b.status){$("#missileValue").html(b.rockets)}errorBoxAsArray(b.errorbox);$("#rocketattack").parent().dialog("close")}function errorBoxSubmitYes(){location.href=officersLink}function movePlanet(d,e){function f(){$.post(d,function(a){if((a=="")||(a==null)){fadeBox(galaxyLoca.reservationSuccess,false);setTimeout('reload_page("'+e+'")',3000)}else{fadeBox(a,true)}})}errorBoxDecision(galaxyLoca.questionTitle,galaxyLoca.question,LocalizationStrings.yes,LocalizationStrings.no,f)}function addToTable(q,x,p){var l=sendString;if(p!=null){l+=" ("+tsdpkt(p)+")"}l=l+" "+q;if(isMobile){fadeBox(l,x!="success");return}var y=new Date();var A="fleetstatus"+y.getTime();var u='id="'+A+'"';var w='class="'+x+'"';var B="<div "+u+" "+w+">"+l+"</div>";$(B).prependTo("#fleetstatusrow");fadingDivs.push(A);if(fadingDivs.length>1){oldId=fadingDivs.shift();$("#"+oldId).fadeOut(2000)}}function setShips(d,e){var f=document.getElementById(d);f.innerHTML=e}function doLoad(b){var b=$.parseJSON(b);if(b.status){$("#galaxy_input").val(b.galaxy);$("#system_input").val(b.system);removeTooltip($("#galaxytable tbody *"));$.each(buildListCountdowns,function(){timerHandler.removeCallback(this.timer)});loadContent(b.galaxy,b.system)}else{errorBoxDeuterium()}}function displayContentGalaxy(c){var d=getTooltipSelector("#inhalt");removeTooltip(d);$("#galaxyContent").html(c);tabletInitGalaxyDetails();eventBDayInitGalaxy();$("#galaxyLoading").attr("style","display: none;");if(!isIE){$(window).unbind("blur").bind("blur",function(){$("#galaxytableHead input").blur()})}}function submitForm(){galaxy=$("#galaxy_input").val();system=$("#system_input").val();canLoadContent(galaxy,system)}function canLoadContent(c,d){params=new Object();params.galaxy=c;params.system=d;$.post(canLoadContentLink,params,doLoad)}function loadContent(c,d){$("#galaxyLoading").attr("style","display: block;");params=new Object();params.galaxy=c;params.system=d;$.post(contentLink,params,displayContentGalaxy);getAjaxResourcebox()}function errorBoxDeuterium(){fadeBox(galaxyLoca.deuteriumNeeded,true)}function doScan(d,c){sendShips(constants.espionage,galaxy,system,d,c,spionageAmount)}function initPhalanx(){getAjaxResourcebox();initEventlist();$(".eventFleet:odd").addClass("odd");$(".partnerInfo:even").addClass("part-even");$(".toggleInfos").click(function(){id=$(this).attr("rel");if($(this).attr("class")=="toggleInfos infosOpen"){$(this).removeClass("infosOpen");$(this).addClass("infosClosed");$(this).children().attr("src","/cdn/img/layout/fleetOpenDetails.gif");$("."+id).attr("style","display: none;")}else{$(this).addClass("infosOpen");$(this).removeClass("infosClosed");$(this).children().attr("src","/cdn/img/layout/fleetCloseDetails.gif");$("."+id).attr("style","display: block;")}});var d=$(".overlayDiv.phalanx");var c=d.siblings(".ui-dialog-titlebar");if(c.find(".refreshPhalanxLink").length){$("#phalanxWrap .refreshPhalanxLink").remove()}else{c.find(".ui-dialog-title").append($("#phalanxWrap .refreshPhalanxLink"))}}function hideRowsPhalanx(f){var e=$.parseJSON(f);for(var d in e.rows){$("#eventRow-"+e.rows[d]).hide()}}function initMissleAttackLayer(){$("#rocketattack").parent().dialog("option","title",$("#rocketattack").attr("data-title")).css("padding",0);$("#rocketattack input#anz").keyup(function(){checkIntInput($(this),1,$(this).attr("max"))}).focus(function(){checkIntInput($(this),1,$(this).attr("max"))}).focus();$("#rocketattack .attack_button").click(function(){$("form#rocketForm").submit();return false});$("form#rocketForm").submit(function(){ajaxFormSubmit("rocketForm",$(this).attr("action"),launchMissiles);return false})}var happyEdit={init:function(){$(".contentzs").tabs({select:hideTipsOnTabChange});$("a.ajax").click(function(){var b=$(this);$.ajax({url:b.attr("href"),success:function(){fadeBox("Ok!",false)},error:function(){fadeBox("Error!",true)}});return false})}};var DOM_GET_ELEMENT_BY_ID_CACHE=new Array();function getElementByIdWithCache(b){if(!DOM_GET_ELEMENT_BY_ID_CACHE[b]){DOM_GET_ELEMENT_BY_ID_CACHE[b]=document.getElementById(b)}return DOM_GET_ELEMENT_BY_ID_CACHE[b]}function addListener(f,d,e){if(f.addEventListener){if(d=="mousewheel"){d="DOMMouseScroll"}f.addEventListener(d,e,false)}else{if(f.attachEvent){f["e"+d+e]=e;f[d+e]=function(){f["e"+d+e](window.event)};f.attachEvent("on"+d,f[d+e])}}}function removeListener(f,d,e){if(f.removeEventListener){f.removeEventListener(d,e,false)}else{if(f.detachEvent){f.detachEvent("on"+d,f[d+e]);f[d+e]=null;f["e"+d+e]=null}}}function addClass(c,d){if(c&&d&&d!="undefined"){removeClass(c,d);c.className+=" "+d}}function removeClass(c,d){if(c&&c.className){c.className=c.className.replace(d,"")}}function getAllChildNodesWithClassName(d,f){if(!f){var f=new Array()}var e=0;if(d.childNodes){for(e in d.childNodes){if(d.childNodes[e].className){f.push(d.childNodes[e])}if(d.childNodes[e].firstChild){f.concat(getAllChildNodesWithClassName(d.childNodes[e],f))}}}return f}function hasClassName(f,d){if(f.className&&d){var e=f.className;return(e==d||e.indexOf(" "+d+" ")>=0||e.indexOf(d+" ")==0||(e.indexOf(" "+d)>0&&e.indexOf(" "+d)==e.length-((" "+d).length)))}else{return false}}function getChildNodesWithClassName(j,e,g){if(j.getElementsByClassName){return j.getElementsByClassName(e)}if(!g){var g=new Array()}var f=0;if(j.childNodes){for(f in j.childNodes){if(j.childNodes[f]&&j.childNodes[f].className&&hasClassName(j.childNodes[f],e)){g.push(j.childNodes[f])}if(j.childNodes[f]&&j.childNodes[f].firstChild){g.concat(getChildNodesWithClassName(j.childNodes[f],e,g))}}}return g}function getChildNodeWithClassName(f,e){if(f.childNodes){for(i in f.childNodes){if(hasClassName(f.childNodes[i],e)){return f.childNodes[i]}else{if(f.childNodes[i].firstChild){var d=getChildNodeWithClassName(f.childNodes[i],e);if(d){return d}}}}}return false}function getChildNodesWithTagName(g,j,f){if(!f){var f=new Array()}var e=0;if(g.childNodes){for(e in g.childNodes){if(g.childNodes[e].tagName&&g.childNodes[e].tagName==j.toUpperCase()){f.push(g.childNodes[e])}if(g.childNodes[e].firstChild){f.concat(getChildNodesWithTagName(g.childNodes[e],j,f))}}}return f}function splitParameterStringToArray(j){var g=new Object();var l=j.split(" ");for(var f in l){var k=l[f].split("=");if(k[0]){g[k[0]]=k[1]}}return g}function number_format(C,E,u,D){u=u||LocalizationStrings.decimalPoint;D=D||LocalizationStrings.thousandSeperator;var x="";var w=C.toString();var y=w.indexOf("e");if(y>-1){x=w.substring(y);C=parseFloat(w.substring(0,y))}if(E!=null){var q=Math.pow(10,E);C=Math.round(C*q)/q}var F=C<0?"-":"";var A=(C>0?Math.floor(C):Math.abs(Math.ceil(C))).toString();var B=C.toString().substring(A.length+F.length);u=u!=null?u:".";B=E!=null&&E>0||B.length>1?(u+B.substring(1)):"";if(E!=null&&E>0){for(i=B.length-1,z=E;i<z;++i){B+="0"}}D=(D!=u||B.length==0)?D:null;if(D!=null&&D!=""){for(i=A.length-3;i>0;i-=3){A=A.substring(0,i)+D+A.substring(i)}}return F+A+B+x}function gfNumberGetHumanReadable(g,e,f){g=Math.floor(g);e=e||false;var j="";var f=f||3;if(e){if(g>=1000000000){j=LocalizationStrings.unitMilliard;g=g/1000000000}else{if(g>=1000000){j=LocalizationStrings.unitMega;g=g/1000000}}}floorWithPrecision=function(a,b){return Math.floor(a*Math.pow(10,b))/Math.pow(10,b)};g=floorWithPrecision(g,f);while(f>=0){if(floorWithPrecision(g,f-1)!=g){break}f=f-1}return number_format(g,f,LocalizationStrings.decimalPoint,LocalizationStrings.thousandSeperator)+j}function getNumberFormatShort(f,e){if(typeof(e)=="undefined"){e=0}f=Math.floor(f);var d="";if(f>=1000000000){d=LocalizationStrings.unitMilliard;f=f/1000000000}if(f>=1000000){d=LocalizationStrings.unitMega;f=f/1000000}if(f>=1000){d=LocalizationStrings.unitKilo;f=f/1000}return number_format(f,e,LocalizationStrings.decimalPoint,LocalizationStrings.thousandSeperator)+d}function dezInt(g,p,k){k=(k)?k:"0";var l=(g<0)?"-":"",j=(k=="0")?l:"";g=Math.abs(parseInt(g,10));p-=(""+g).length;for(var q=1;q<=p;q++){j+=""+k}j+=((k!="0")?l:"")+g;return j}function ajaxSendUrl(d){var e=null;if(typeof XMLHttpRequest!="undefined"){e=new XMLHttpRequest()}if(!e){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(f){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(f){e=null}}}if(e){e.open("POST",d,true);e.onreadystatechange=function(){if(e.readyState==4){}};e.send(null)}}function ajaxRequest(j,e){var f=null;if(typeof XMLHttpRequest!="undefined"){f=new XMLHttpRequest()}if(!f){try{f=new ActiveXObject("Msxml2.XMLHTTP")}catch(g){try{f=new ActiveXObject("Microsoft.XMLHTTP")}catch(g){f=null}}}if(f){f.open("POST",j,true);f.onreadystatechange=function(){if(f.readyState==4){var a=new e(f.responseText)}};f.send(null)}}function initHighscore(){$("a.navButton, a.subnavButton").click(function(){var l=$(this).attr("rel");var j=$(this).parent();var g="";if(j.attr("id")=="typeButtons"){$("#typeButtons > a.active").removeClass("active")}else{if(j.attr("id")=="categoryButtons"){$("#categoryButtons > a.active").removeClass("active");$("#typeButtons a.active").each(function(){l=$(this).attr("rel")})}}if(searchRelId!=null&&j.attr("id")=="typeButtons"||j.attr("id")=="subnav_fleet"){g="&searchRelId="+searchRelId}$(".subnavButton[rel!="+l+"]").removeClass("active");$("#stat_list_content").html(LocalizationStrings.loading);$(this).addClass("active");var k=$("#categoryButtons > a.active").attr("rel");var f=highscoreContentUrl+"&category="+k+"&type="+l+g;if((j.attr("id")=="typeButtons"||$(this).hasClass("subnavButton"))&&searchSite!=site){f=f+"&site="+site}removeTooltip(getTooltipSelector("#highscoreContent #ranks"));ajaxSumbit(f,"send","stat_list_content");if($(".navButton.active").attr("rel")==1){$("#highscoreContent .header h2").text(highscoreLoca.playerHighscore)}else{$("#highscoreContent .header h2").text(highscoreLoca.allianceHighscore)}});$(".stat_filter").click(function(){var b=$(this).attr("id");$(".subnav").hide();$("#subnav_"+b).fadeIn("slow")})}function initHighscoreContent(){if(userWantsFocus){if($("#position"+searchPosition).length>0){$("html, body").animate({scrollTop:Math.max(0,$("#position"+searchPosition).offset().top-200)},1000)}}$(".changeSite").change(function(){ajaxCall(highscoreContentUrl+"&category="+currentCategory+"&type="+currentType+"&site="+$(this).val(),"stat_list_content")})}function saveImperiumOrder(e,d){var f="impSortOrder";if(d){f="impSortOrderMoon"}$.ajax({url:saveUrl,method:"post",dataType:"json",data:{ajax:1,type:f,planets:$(e).sortable("toArray")}})}function clearImperiumOrder(){$.ajax({url:saveUrl,method:"post",dataType:"json",data:{ajax:1,type:"reset"},success:function(b){if(!b.error){location.reload()}}})}function createSummaryHtml(q){var x="";var l=null;var u=0;var y=0;var k="";x=x+'<div class="planetHead"><div class="planetname">'+q.translations.summary+'</div><div class="planetImg"><img src="/cdn/img/layout/sum-bg-empire.jpg"/></div><div class="planetData"><ul><li class="coords textLeft"></li><li class="fields textRight"></li></ul></div><div class="clearfloat"/></div>';for(group in q.groups){x=x+'<div class="row" /><div class="values '+group+" group"+group+'">';for(y=0;k=q.groups[group][y];y++){if(q.translations.planets[k]==null){continue}var p={hourly:0,daily:0,weekly:0};if(k=="name"){u=q.translations.summary}else{u=0;if(group=="research"){if(!isNaN(q.planets[0][k])){u=q.planets[0][k]}}else{$.each(q.planets,function(){l=this;if(!isNaN(l[k])){u=u+parseInt(l[k]);if(group=="supply"&&!isNaN(l.production.hourly[k-1])){p.hourly+=l.production.hourly[k-1];p.daily+=l.production.daily[k-1];p.weekly+=l.production.weekly[k-1]}}})}}if(group=="supply"||group=="station"){u="&#x00F8; "+tsdpkt(round(u/q.planets.length,1))}else{if(group=="items"){u="&nbsp;"}else{u=tsdpkt(u)}}if(group=="supply"&&k!="name"&&p.hourly>0){var w="<table><tr><td>"+q.translations.production.hourly+":</td><td style=&quot;text-align: right;&quot;>"+tsdpkt(p.hourly)+"</td></tr><tr><td>"+q.translations.production.daily+":</td><td style=&quot;text-align: right;&quot;>"+tsdpkt(p.daily)+"</td></tr><tr><td>"+q.translations.production.weekly+":</td><td style=&quot;text-align: right;&quot;>"+tsdpkt(p.weekly)+"</td></tr></table>";w=w.replace(/</,"&lt;").replace(/>/,"&gt;");x=x+'<div class="tooltipRight '+k+'" title="'+w+'">'+u+"</div>"}else{x=x+'<div class="'+k+'">'+u+"</div>"}}x=x+"</div>"}x='<div id="total" class="planet summary">'+x+'</div><br class="clearfloat"/>';return x}function createHeaderHtml(g){var j="";var e=0;var f="";j=j+'<div id="wrapTL"><div id="tab-left"><a id="planetsTab" href="javascript:void(0);" class="active" title=""><span>'+g.translations.planetsTab+'</span></a><a id="moonsTab" href="javascript:void(0);" title="" class=""><span>'+g.translations.moonsTab+"</span></a></div></div>";for(group in g.groups){j=j+'<div id="'+group+'" class="firstCat headers '+group+" headers"+group+'" group="'+group+'"><h3 class="open"><span>'+g.translations.groups[group]+'</span></h3><ul class="secondCat '+group+" group"+group+'">';for(e=0;f=g.groups[group][e];e++){if(g.translations.planets[f]==null){continue}j+='<li class="'+f+'">';if(g.translations.planets[f+"_full"]!=g.translations.planets[f]){j+='<span class="tooltipLeft" title="'+g.translations.planets[f+"_full"]+'">'+g.translations.planets[f]+"</span>"}else{j+="<span>"+g.translations.planets[f]+"</span>"}j+="</li>"}j=j+"</ul></div>"}j='<div id="empireTab"><div class="wrapTab"><div class="tab-part01"></div><h2>'+g.translations.header+'</h2><span class="reset"><img src="/cdn/img/icons/against.gif" width="16" height="16"><a href="javascript:void(0);" onClick="clearImperiumOrder(); return false;">'+g.translations.reset+'</a></span><div class="wrapCorner"></div><br class="clearfloat"/></div></div><div class="header">'+j+"</div>";return j}function createPlanetsHtml(p){var y="";var x="";var q="";var l="";var k="";var u=0;var w="";$.each(p.planets,function(){y=this;q="";l="";x=(y.name.length>13)?y.name.substr(0,11)+"...":y.name;q+='<div class="planetHead">';if(y.name!=x){q+='<div class="planetname tooltip" title="'+y.name+'">'+x+"</div>"}else{q+='<div class="planetname">'+x+"</div>"}if(isMobile){q+='<div class="planetImg"><img class="'+y.border+'" src="'+y.image+'"/></div><div class="planetData"><div class="planetDataTop odd"><ul><li class="coords textLeft"><a class="dark_highlight_tablet" href="'+y.coordinatesLink+'" >'+y.coordinates+'</a></li><li class="coords"><span class="dark_highlight_tablet energy tooltipRight" title="'+y.energyTooltip+'">'+y.energyDescr+y.energy+'</span></li></ul></div><div class="planetDataTop"><ul class="planet_data_2"><li class="fields textLeft">'+y.fieldUsed+"/"+y.fieldMax+'</li><li class="fields textLeft">'+y.temperature+'</li></ul></div></div><div class="clearfloat"/></div>'}else{q+='<div class="planetImg"><img class="'+y.border+'" src="'+y.image+'"/></div><div class="planetData"><div class="planetDataTop odd"><ul><li class="coords textLeft"><a href="'+y.coordinatesLink+'" >'+y.coordinates+'</a></li><li class="fields textRight">'+y.fieldUsed+"/"+y.fieldMax+'</li></ul></div><div class="planetDataTop"><ul><li class="coords textLeft">'+y.energyDescr+'</li><li class="coords textRight">'+y.energy+'</li></ul></div><div class="planetDataBottom odd"><ul><li class="fields textCenter">'+y.temperature+'</li></ul></div></div><div class="clearfloat"/></div>'}for(group in p.groups){q=q+'<div class="row" /><div class="values '+group+" group"+group+'">';for(u=0;w=p.groups[group][u];u++){w=String(w);if(y[w+"_html"]!=null){w=w+"_html"}l=w;if(w.substring(w.length-5)=="_html"){l=w.substring(0,w.length-5)}q=q+'<div class="'+l+'">'+y[w]+"</div>"}q=q+"</div>"}k=k+'<div id="planet'+this.id+'" class="planet">'+q+"</div>"});return k}function createImperiumHtml(l,p,u,y){var q=0;if(typeof u.planets!="undefined"){q=u.planets.length}var x=345+q*165;$("#mainWrapper").attr("style","width: "+x+"px");$(p).show();var k=createHeaderHtml(u)+'<div class="planetWrapper">'+createPlanetsHtml(u)+"</div>"+createSummaryHtml(u);$(l).append(k);$(l+" .planetWrapper").sortable({start:function(){removeTooltip("*")},update:function(){saveImperiumOrder(l+" .planetWrapper",y)}}).disableSelection();for(group in u.groups){$(l+" .headers"+group).click(function(){var b=l+" .group"+$(this).attr("group");var a="#"+$(this).attr("group")+" h3";$(b).toggle();$(a).removeClass("openhover").removeClass("closehover").removeClass("close").removeClass("open");if($(b).attr("style").toLowerCase().substr(9,4)=="none"){$(a).addClass("close");$.cookie("impToggleState"+$(this).attr("group"),"1",{expires:365})}else{$(a).addClass("open");$.cookie("impToggleState"+$(this).attr("group"),"0",{expires:365})}});var w=$.cookie("impToggleState"+group);if(w!=null&&w=="1"){$("#"+group+" > h3").removeClass("open");$("#"+group+" > h3").addClass("close");$(l+" .group"+group).toggle()}}$(p).hide();initTooltips()}function displayMessage(b){if(b){location.reload()}}function doUpgrade(j,f,l,g){var k=new Object();k.modus=l;k.techid=j;k.listid=g;k.planet=f;$.post(upgradeUrl,k,displayMessage)}function initEmpire(){initConnectionErrorFunction();$(".secondCat").each(function(){$(this).find("li:last").addClass("catbox-end")});$(".values").each(function(){if(!$(this).hasClass("groupitems")){$(this).find("div:even").addClass("even");$(this).find("div:odd").addClass("odd");$(this).find("div:last").addClass("box-end")}if($(this).children().hasClass("equipment")){$(this).children(".equipment").addClass("box-end")}});$("#settings li:last").addClass("set-end");$(".header h3").hover(function(){$(this).addClass($(this).attr("class")+"hover")},function(){$(this).removeClass("openhover").removeClass("closehover")});$(".header h3").click(function(){$(this).removeClass("openhover").removeClass("closehover");var b=$(this).attr("class");if(b=="open"){$(this).addClass("close")}else{$(this).addClass("open")}$(this).removeClass(b)});$(".planet:not(#total)").hover(function(){$(this).addClass("move")},function(){$(this).removeClass("move")});$(".values div img").hover(function(){$(this).addClass("imghover")},function(){$(this).removeClass("imghover")});$("#planetsTab").click(function(){window.location.href=empireUrl+"&planetType=0"});if(moonCount>0){$("#moonsTab").click(function(){window.location.href=empireUrl+"&planetType=1"})}else{$("#moonsTab").addClass("nomoons")}if(planetType==1){$("#planetsTab").removeClass("active");$("#moonsTab").addClass("active")}}function toggleEvents(){if($("#eventboxContent").is(":hidden")){$("#eventboxContent").slideDown("fast");$("#eventboxFilled a").addClass("open");changeTooltip($(".toggleDetailButton"),LocalizationStrings.lessDetails);if(typeof toggleEvents.loaded=="undefined"||!toggleEvents.loaded){$("#eventboxContent").html('<img height="16" width="16" src="/cdn/img/ajax-loader.gif" />');$.get(eventlistLink,function(b){$("#eventboxContent").html(b);toggleEvents.loaded=true})}}else{$("#eventboxContent").slideUp("fast");$("#eventboxFilled a").removeClass("open");changeTooltip($(".toggleDetailButton"),LocalizationStrings.moreDetails)}}function showGoogleAnalytics(){var f=(("https:"==document.location.protocol)?"https://ssl.":"http://www.");document.write(decodeURI("%3Cscript src='"+f+"google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));try{var e=_gat._getTracker("UA-11968132-1");e._setDomainName(".ogame.de");e._trackPageview()}catch(d){}}function changeSetting(l,k,j,f,g){$.ajax({type:"POST",url:changeSettingsLink,dataType:"json",data:{token:changeSettingsToken,key:l,value:k},success:function(a){changeSettingsToken=a.newToken;if(a.message.length>0){fadeBox(a.message,a.error)}if(!a.error&&typeof(j)=="function"){j()}else{if(a.error&&typeof(f)=="function"){f()}}},error:function(a){if(typeof(g)=="undefined"||g){fadeBox(LocalizationStrings.error,true)}if(a.error&&typeof(f)=="function"){f()}}})}function getOverlayText(b){if(b.hasClass("building")&&b.children().hasClass("build-faster-img")){return locaPremium.buildingHalfOverlay}else{if(b.hasClass("building")&&b.children().hasClass("build-finish-img")){return locaPremium.buildingFullOverlay}else{if(b.hasClass("ships")&&b.children().hasClass("build-faster-img")){return locaPremium.shipsHalfOverlay}else{if(b.hasClass("ships")&&b.children().hasClass("build-finish-img")){return locaPremium.shipsFullOverlay}else{if(b.hasClass("research")&&b.children().hasClass("build-faster-img")){return locaPremium.researchHalfOverlay}else{if(b.hasClass("research")&&b.children().hasClass("build-finish-img")){return locaPremium.researchFullOverlay}}}}}}}function getFastBuildPrice(b){if(b.hasClass("building")){return priceBuilding}else{if(b.hasClass("research")){return priceResearch}else{if(b.hasClass("ships")){return priceShips}}}}function getRedirectLink(){return $.param.fragment($.param.querystring(window.location.href,{_rnd:Math.random()}),{})}function sendShips(j,k,l,g,q,p){if(shipsendingDone==1){shipsendingDone=0;sendString="";params=new Object();params.mission=j;params.galaxy=k;params.system=l;params.position=g;params.type=q;params.shipCount=p;$.post(miniFleetLink,params,function(a){if(typeof(displayMessage)=="function"){displayMessage(a)}else{window.location=getRedirectLink()}})}}function outlawWarning(x,B,A,w,q,l,p){if(typeof(p)!="function"){if(x==constants.espionage){p=y}else{if(x==constants.missleattack){p=u}}}if(showOutlawWarning){errorBoxDecision(LocalizationStrings.attention,LocalizationStrings.outlawWarning,LocalizationStrings.yes,LocalizationStrings.no,p)}else{p()}function y(){sendShips(x,B,A,w,q,l)}function u(){openOverlay(missleAttackLink+"&galaxy="+B+"&system="+A+"&position="+w+"&planetType="+q,{modal:true})}}function mmoDetectDeviceOS(){return(function(b){if(/iPhone/i.test(b)||/iPad/.test(b)||/iPod/.test(b)){return"ios"}else{if(/Android/.test(b)){return"android"}else{if(/Windows Phone OS 7\.0/.test(b)){return"winphone7"}else{if(/BlackBerry/.test(b)){return"rim"}else{return"desktop"}}}}})(navigator.userAgent)}function mmoSetBannerDeviceOS(g,j,f){var e=new RegExp(/src=(["'])([^\"']*)(["'])/);if(j&&e.test(g)){document.getElementById(f).innerHTML=g.replace(e,"src="+RegExp.$1+RegExp.$2+"&os="+j+RegExp.$3)}}function initThousandSeparator(){$(".checkThousandSeparator").unbind("keyup.checkThousandSeparator").bind("keyup.checkThousandSeparator",function(e){if(e.which==8||e.which==46){var f=$(this).getSelection();var g=$(this).val();if(g.substr(f.start-1,1)==LocalizationStrings.thousandSeperator){var j;if(e.which==8){j=g.substr(0,f.start-2)+g.substr(f.start-1)}else{j=g.substr(0,f.start)+g.substr(f.start+1)}formatNumber($(this),j)}}})}function initIndex(){initConnectionErrorFunction();$("#planet .slot").hover(function(){$(this).addClass("slot-hover")},function(){$(this).removeClass("slot-hover")});$(".construction img.queuePic").hover(function(){$(this).addClass("queuePic-hover")},function(){$(this).removeClass("queuePic-hover")});$("#eventboxFilled").hover(function(){$(this).addClass("eventboxHover")},function(){$(this).removeClass("qeventboxHover")});$(document).undelegate("html","touchstart.hideElem click.hideElem").delegate("html","touchstart.hideElem click.hideElem",function(c){c.stopPropagation();if($(this).data("noclick")){return}if(isMobile){var d=c.target.tagName.toUpperCase();if(!(d==="TEXTAREA"||d==="INPUT"||d==="SELECT")){document.activeElement.blur()}}if(!$(c.target).parents(".t_Tooltip").length){Tipped.hideAll()}if(!isMobile){if($(c.target).parents(".ui-dialog").length||$(c.target).parents(".t_Tooltip").length){return}$(".overlayDiv").dialog("close")}}).undelegate(".eventToggle","click").delegate(".eventToggle","click",function(){toggleEvents();return false}).undelegate("a.build-faster","click").delegate("a.build-faster","click",function(){var c=$(this);if(darkMatter<getFastBuildPrice(c)){errorBoxDecision(LocalizationStrings.error,loca.errorNotEnoughDM,LocalizationStrings.yes,LocalizationStrings.no,redirectPremium);return}var d=$.deparam.querystring().page;errorBoxDecision(loca.notice,getOverlayText(c),LocalizationStrings.yes,LocalizationStrings.no,function(){$.ajax({url:c.attr("rel"),data:{ajax:1,token:activateToken,referrerPage:d},type:"POST",dataType:"json",error:function(){fadeBox(LocalizationStrings.error,true);c.addClass("disabled")},success:function(a){activateToken=a.newToken;if(a.error){fadeBox(a.message,true);c.addClass("disabled")}else{location.href=getRedirectLink()}}});return false})}).undelegate(".slideIn","click").delegate(".slideIn","click",function(){$(".slideIn").removeClass("active");$(this).addClass("active");var b=$(this).attr("ref");Tipped.hideAll();$("html, body").animate({scrollTop:0},500);gfSlider.slideIn(getElementByIdWithCache("detail"),b)}).undelegate('img.mouseSwitch[rel!=""]',"mouseover").delegate('img.mouseSwitch[rel!=""]',"mouseover",function(){var b=$(this).attr("src");$(this).attr("src",$(this).attr("rel"));$(this).attr("rel",b)}).undelegate('img.mouseSwitch[rel!=""]',"mouseout").delegate('img.mouseSwitch[rel!=""]',"mouseout",function(){var b=$(this).attr("src");$(this).attr("src",$(this).attr("rel"));$(this).attr("rel",b)});if($("#eventboxContent").is(":visible")){toggleEvents.loaded=true;$("#eventboxFilled a").addClass("open")}$("#banner_skyscraper a.close_details").click(function(){changeSetting("hideBanner",$(this).attr("ref"),function(){$("#banner_skyscraper").remove()})});initOverlays();initLinks();initThousandSeparator();initExodus();initTooltips();initAjaxResourcebox();initPlanetSorting();initRetinaImages();initBDayEventHints();timerHandler.appendCallback(function(){localTime=new Date();serverTime=new Date(localTime.valueOf()+timeDiff);$(".OGameClock").html(getFormatedDate(serverTime.getTime(),"[d].[m].[Y] <span>[H]:[i]:[s]</span>"))})}function initPlanetSorting(){$("#planetList.sortable").sortable({stop:function(){changeSetting("customPlanetOrder",$(this).sortable("toArray"))}});if($(".lockPlanets").hasClass("closed")){$("#planetList.sortable").sortable("disable")}$(".lockPlanets").unbind("click").bind("click",function(){var b=$(this);changeSetting("planetOrderLocked",b.hasClass("open")?1:0,function(){var a;if(b.hasClass("open")){b.removeClass("open").addClass("closed");$("#planetList.sortable").sortable("disable");a=LocalizationStrings.planetOrder.unlock}else{b.removeClass("closed").addClass("open");$("#planetList.sortable").sortable("enable");a=LocalizationStrings.planetOrder.lock}changeTooltip(b,a)})})}function initShowMessage(){var b=$(".overlayDiv:last");$(".answerHeadline",b).click(function(){$(this).toggleClass("open");if($(this).hasClass("open")){$(".answerForm",b).show();$(".textWrapper",b).addClass("textWrapperSmall");$(".textWrapper",b).removeClass("textWrapper")}else{$(".answerForm",b).hide();$(".textWrapperSmall",b).addClass("textWrapper");$(".textWrapperSmall",b).removeClass("textWrapperSmall")}});$(".note > div:first-child",b).addClass("newMessage");$(".info:odd",b).css("margin-left","40px");$("div.note p:first").after('<span class="seperator">');$(".answerHeadline",b).hover(function(){$(this).addClass("pushable")},function(){$(this).removeClass("pushable")});$(".melden",b).click(function(){manageErrorbox($(this).attr("rel"),1)})}function initMessages(){$(document).undelegate("a.espionageReport","click.shareReport").delegate("a.espionageReport","click.shareReport",function(){shareEspionageReport(this)})}function markAsRead(g){if($("#TR"+g).hasClass("new")){$("#TR"+g).removeClass("new");var f=$(".reiter.active span.msgSum");if(f.length){var e=parseInt(/^\((\d+)\)$/.exec(f.text())[1]);var j=e-1;if(j>0){f.text("("+j+")")}else{f.remove()}}$msgSpan=$("#message_alert_box span");e=parseInt($msgSpan.text());j=e-1;if(j>0){$msgSpan.text(j)}else{$msgSpan.text("");$("#message_alert_box").attr("id","message_alert_box_default").addClass("emptyMessage")}}}function switchMessageView(b){if($("#"+b+":hidden").length>0){$("#"+b).show()}else{$("#"+b).hide()}}function initAdressbook(){$(".addressBook").tabs({select:hideTipsOnTabChange});$(".zebra tr").mouseover(function(){$(this).addClass("over")}).mouseout(function(){$(this).removeClass("over")});$(".zebra tr:odd").addClass("alt")}function MessageSlider(d){var f=this;f.htmlobject=d;var e=document.documentElement.clientHeight-160;this.open=function(){if(!this.inAction){f.startTime=new Date().getTime();f.inAction=true;f.slideInStep()}},this.slideInStep=function(){time=new Date().getTime();height=parseInt(f.currHeight*((time-f.startTime)/500));if(height<f.currHeight){f.htmlobject.style.height=height+"px";window.setTimeout(f.slideInStep,10)}else{f.htmlobject.style.height=f.currHeight+"px";f.inAction=false}},this.close=function(){if(!f.inAction){f.startTime=new Date().getTime();f.inAction=true;f.htmlobject.style.height="0px";f.inAction=false}},f.inAction=false;if(document.getElementById("messages")){f.currHeight=Math.min(document.getElementById("messages").offsetHeight,e)}else{f.currHeight=e}}function closeDetails(f,d){var e=createExpireTime(d);$("#fleet"+f).children(".openDetails").children().children().attr("src","/cdn/img/layout/fleetOpenDetails.gif");$("#fleet"+f).children(".quantity").show();$("#fleet"+f).removeClass("detailsOpened");$("#fleet"+f).addClass("detailsClosed");$.cookie("tabBox_"+f,"0",{expires:e})}function openDetails(f,d){var e=createExpireTime(d);$("#fleet"+f).children(".openDetails").children().children().attr("src","/cdn/img/layout/fleetCloseDetails.gif");$("#fleet"+f).children(".quantity").hide();$("#fleet"+f).removeClass("detailsClosed");$("#fleet"+f).addClass("detailsOpened");$.cookie("tabBox_"+f,"1",{expires:e})}function openCloseDetails(c,d){if($("#fleet"+c).attr("class")=="fleetDetails detailsOpened"){closeDetails(c,d)}else{openDetails(c,d)}}function initMovement(){$("a.toggleHeader").click(function(){$("#planet").toggleClass("shortHeader");$(".c-left").toggleClass("shortCorner");$(".c-right").toggleClass("shortCorner");changeCookie(cookieName)});$("a.openCloseDetails").click(function(){openCloseDetails($(this).attr("data-mission-id"),$(this).attr("data-end-time"))});$(".closeAll").click(function(){if(showInfos==0){showInfos=1;$(".closeAll").children().removeClass("all_open").addClass("all_closed")}else{showInfos=0;$(".closeAll").children().removeClass("all_closed").addClass("all_open")}$("a.openCloseDetails").each(function(){if(showInfos===1){closeDetails($(this).attr("data-mission-id"),$(this).attr("data-end-time"))}else{if(showInfos===0){openDetails($(this).attr("data-mission-id"),$(this).attr("data-end-time"))}}})});timerHandler.appendCallback(function(){})}function addUserToUnion(){$("#participantselect").append($("#buddyselect li.ui-selected"))}function removeUserFromUnion(){$("#buddyselect").append($("#participantselect li.ui-selected"))}function addUserToUnionByForm(){var b=$('#unionUserSearch [name="addtogroup"]').val();if($('#participantselect li[ref="'+b+'"]').length==0){$("#participantselect").append($(document.createElement("li")).attr("ref",b).text(b))}$('#unionUserSearch [name="addtogroup"]').val("")}function setUnionUsers(){var b="";$("#participantselect li").each(function(){b+=$(this).attr("ref")+";"});b=b.substring(0,b.length-1);$("#unionUsers").val(b)}function unionUser(d){var c=$.parseJSON(d);if(c.status){addUserToUnionByForm()}else{errorBoxAsArray(c.errorbox)}}function initFederationLayer(){$("#switch").click(function(){$("#searchFed > .wrap").toggle();$("#searchFed > #honorWarning").toggle()});$("#buddyselect, #participantselect").selectable({filter:"li:not(.undermark)"});$(document).undelegate("ul#buddyselect li","dblclick").delegate("ul#buddyselect li","dblclick",function(){addUserToUnion()}).undelegate("ul#participantselect li","dblclick").delegate("ul#participantselect li","dblclick",function(){removeUserFromUnion()}).undelegate("form#unionform","submit").delegate("form#unionform","submit",function(b){b.preventDefault();submit_unionform()})}function submit_unionform(){setUnionUsers();ajaxFormSubmit("unionform",$("form#unionform").attr("action"),unionEdit)}function recallShipCountdown(f,j){var g=this;var e=$(".reversal_time[ref='"+f+"']");if(isMobile&&e.length){this.updateCountdown=function(){var b=g.countdown.getLeftoverTime();var a=getFormatedDate(new Date(b*1000),"[d].[m].[Y] [H]:[i]:[s]");if(isMobile){e.html(a)}else{var c=movementLoca.callBack+":|"+a}};g.countdown=new countdown(j,3,2);g.timer=timerHandler.appendCallback(g.updateCountdown);g.updateCountdown()}}function initNotesForm(){$("#createNote .text").trigger("keyup")}function initNotes(){function f(a){var b=false;$(a).find(":input").each(function(){if(typeof($(this).attr("data-value"))!="undefined"){if($(this).attr("data-value")!=$(this).val()){b=true}}});return b}var d=$(".overlayDiv.notes");d.find(".openOverlay").unbind("click").bind("click",function(){var a=$(this).data("overlay-class");var b={title:$(this).attr("data-title"),close:function(){var c=$("."+a);if(f(c.find("form"))){errorBoxDecision(LocalizationStrings.question,locaNotes.changesNotSaved+"<br/><br/>"+locaNotes.questionSaveChanges,LocalizationStrings.yes,LocalizationStrings.no,function(){c.find("form").submit();c.remove()},function(){c.remove()})}else{c.remove()}},"class":a};openOverlay($(this).attr("href"),b);return false});$(document).undelegate("#noteList form","submit").delegate("#noteList form","submit",function(){$.post($("#noteList").attr("rel"),$(this).serialize(),function(a){d.html(a)})}).undelegate("#createNote form","submit").delegate("#createNote form","submit",function(){var a=$(this);a.find(":input").each(function(){if(typeof($(this).attr("data-value"))!="undefined"){$(this).attr("data-value",$(this).val())}});$.ajax({url:$(this).attr("rel"),type:"post",data:a.serialize(),dataType:"json",error:function(){fadeBox(LocalizationStrings.error,true)},success:function(b){if(b.error!=null){fadeBox(b.error,true)}else{a.parents(".overlayDiv").dialog("close");if(b.success!=null){fadeBox(b.success,false)}}d.load(d.find("#noteList").attr("rel"))}});return false}).undelegate("#createNote .textBox","keyup touchstart change").delegate("#createNote .textBox","keyup touchstart change",function(){var a=$(this).val().length;var c=$(this).attr("data-max-length");if(a>c){var b=$(this).getSelection();$(this).val($(this).val().substr(0,c));a=c;$(this).setSelection(b)}$(this).parents("form").find(".cntChars").text(a)});function e(){}$(window).unbind("beforeunload").bind("beforeunload",function(){var a=false;$("#createNote form").each(function(){if(f(this)){a=true}});if(a){return locaNotes.changesNotSaved}})}function scrollToTopOfDialog(b){$("html, body").animate({scrollTop:Math.max(0,b.offset().top-300)},500)}function openOverlay(H,E){if(typeof(openOverlay.index)=="undefined"){openOverlay.index=0}else{openOverlay.index++}E=E||{};if(typeof(E.height)=="undefined"){E.height="auto"}if(typeof(E.width)=="undefined"){E.width="auto"}if(typeof(E.position)=="undefined"){E.position="center"}if($(".overlayDiv").length&&!isMobile){var B=$(".overlayDiv:last");var D=B.offset();E.position=[D.left+10,D.top+10];E.zIndex=parseInt(B.parents(".ui-dialog").css("zIndex"))+1}function J(b){var a=b.parent(".ui-dialog");if(a.length){a.css("top",Math.max(0,parseInt(a.css("top").replace(/px$/,"")))).css("left",Math.max(0,parseInt(a.css("left").replace(/px$/,""))))}}var x=E.type;delete E.type;if(x!="inline"){var F=$(document.createElement("img")).attr("src","/cdn/img/layout/ajaxloading2.gif").attr("alt",LocalizationStrings.loading);var C=$(document.createElement("div")).css("text-align","center").css("margin-top","20px").append(F);var y=$(document.createElement("div")).addClass("overlayDiv").css("display","none").append(C).appendTo("body");if(typeof(E.close)=="undefined"){E.close=function(){y.remove();Tipped.hideAll()}}}if(typeof(E["class"])!="undefined"){if($(".overlayDiv."+E["class"]).length){$.get(H,{},function(a){$(".overlayDiv."+E["class"]).empty().append(a).dialog("moveToTop")});y.remove();y=$(".overlayDiv."+E["class"]);scrollToTopOfDialog(y);return true}else{y.addClass(E["class"])}}if(x=="inline"){y=$(H)}if(isNaN(E.dragStart)&&isNaN(E.dragStop)){var I;E.dragStart=function(){$("html").data("noclick",true);y.dialog("option","width",y.width()).dialog("option","height",y.height());I={bg:y.css("background"),image:y.css("background-image"),x:y.css("background-position-x"),y:y.css("background-position-y"),position:y.css("background-position")};y.children().hide();y.css("background","#000000")};E.dragStop=function(){setTimeout(function(){$("html").data("noclick",false)},100);if(typeof(y.bg)=="undefined"||y.bg.length==0){y.css("background-image",I.image);if(typeof(I.position)=="undefined"||I.position.length==0){y.css("background-position-x",I.x).css("background-position-y",I.y)}else{y.css("background-position",I.position)}}else{y.css("background",I.bg)}y.children().show();y.dialog("option","width",E.width).dialog("option","height",E.height);J(y)}}if(isNaN(E.resizable)){E.resizable=false}if(isMobile){E.draggable=false}if(E.modal){E.open=function(){$(".ui-widget-overlay").css("height","").css("width","")}}switch(x){case"iframe":var G=overlayWidth;var w=overlayHeight;if(typeof(E.iframeWidth)!="undefined"){G=E.iframeWidth;delete E.iframeWidth}if(typeof(E.iframeHeight)!="undefined"){w=E.iframeHeight;delete E.iframeHeight}y.html("<iframe allowTransparency='true'frameborder='0' hspace='0' src='"+H+"' id='TB_iframeContent' name='TB_iframeContent"+Math.round(Math.random()*1000)+"' style='width:"+(G+25)+"px;height:"+(w+1)+"px;' ></iframe>").dialog(E).dialog("moveToTop");J(y);break;case"inline":var A=$(H);A.addClass("overlayDiv").dialog(E).dialog("moveToTop");J(y);break;default:y.dialog(E).dialog("moveToTop");$.get(H,{},function(a){y.empty().append(a).dialog("option","position",y.dialog("option","position"));setTimeout(function(){y.dialog("option","position",y.dialog("option","position"));J(y)},100)})}Tipped.hideAll();$(window).bind("resize",function(){y.dialog("option","position",y.dialog("option","position"));J(y)})}function isOverlayOpen(){return $(".overlayDiv").length>0}function initOverlays(){$(document).undelegate("a.overlay","click").delegate("a.overlay","click",function(g){g.preventDefault();var e=$(this).attr("href");if($(this).data("overlay-same")){var j=$(this).parents(".ui-dialog").find(".overlayDiv");if($(this).data("overlay-same")&&j.length>0){$.get(e,{},function(a){removeTooltip(j.find(getTooltipSelector()));j.empty().append(a).dialog("moveToTop");scrollToTopOfDialog(j)});return false}}var f={height:"auto",width:"auto",position:"center",zIndex:4000};if($(this).data("overlay-title")){f.title=$(this).data("overlay-title")}else{if(typeof($(this).attr("title"))!="undefined"&&$(this).attr("title").length){f.title=$(this).attr("title")}else{if($(this).data("tipped_restore_title")){f.title=$(this).data("tipped_restore_title").replace(/^.+\|/,"")}}}if($(this).data("overlay-class")){f["class"]=$(this).data("overlay-class")}if($(this).data("overlay-width")){f.width=$(this).data("overlay-width")}if($(this).data("overlay-height")){f.height=$(this).data("overlay-height")}if($(this).data("overlay-position")){f.position=$(this).data("overlay-position")}if($(this).data("overlay-modal")){f.modal=$(this).data("overlay-modal");f.resizable=false;f.draggable=false}if($(this).data("overlay-iframe")){f.type="iframe";if($(this).data("iframe-width")){f.iframeWidth=$(this).data("iframe-width")}if($(this).data("iframe-height")){f.iframeHeight=$(this).data("iframe-height")}}else{if($(this).data("overlay-inline")){f.type="inline";e=$(this).data("overlay-inline")}}openOverlay(e,f);return false})}function initOverview(){$(".cancelMove").click(function(){var c=$(this);var d=window.location;errorBoxDecision(planetMoveLoca.askTitle,planetMoveLoca.askCancel,planetMoveLoca.yes,planetMoveLoca.no,function(){$.ajax({method:"get",url:c.attr("rel"),dataType:"json",cache:false,success:function(a){if(a.error.length>0){fadeBox(a.error,true)}else{location.href=getRedirectLink()}},error:function(){fadeBox(planetMoveLoca.error,true)}})})});$(document).undelegate("#planetMaintenanceDelete","submit").delegate("#planetMaintenanceDelete","submit",function(b){b.preventDefault();ajaxFormSubmit("planetMaintenanceDelete",$(this).attr("action"),planetGivenup)}).undelegate("#abandonplanet #block","click").delegate("#abandonplanet #block","click",function(c){c.preventDefault();if(isMobileOnly){var d=$("#giveupHeadline").attr("rel")==3?loca.moonGiveupQuestion:loca.planetGiveupQuestion;d=d.replace("%planetName%",$("#giveupName").text()).replace("%planetCoordinates%",$("#giveupCoordinates").text());errorBoxDecision($("#giveupHeadline").text(),d,LocalizationStrings.yes,LocalizationStrings.no,function(){$("#planetMaintenanceDelete").submit()})}else{show_hide_menus("#validate");show_hide_menus("#giveUpNotification")}}).undelegate(".openPlanetRenameGiveupBox","click").delegate(".openPlanetRenameGiveupBox","click",function(b){b.stopPropagation();openPlanetRenameGiveupBox()})}function clearField(){currentValue=$("#planetName").val();if(defaultName==currentValue){clearInput("#planetName")}}function fillField(){currentValue=$("#planetName").val();if(currentValue==""){$("#planetName").val(defaultName)}}function openBuddyOverlay(d,c){openOverlay(d,{"class":"buddies",title:c})}function initPreferences(){$("div.wrap > div.group").hide();$("div.wrap > div.group:first,div.wrap:eq(1) > div.group:eq(0),div.wrap:eq(2) > div.group:eq(0),div.wrap:eq(3) > div.group:eq(0)").show();$("div.wrap > div.bar").click(function(){$(this).next("div.group:hidden").slideDown("fast",function(){Tipped.show($(":input:visible"))}).siblings("div.group:visible").slideUp("fast",function(){Tipped.hide($(":input:not(:visible)"))});$.validationEngine.closePrompt(".formError")});$(".content .bar").hover(function(){$(this).addClass("bar-hover")},function(){$(this).removeClass("bar-hover")});$("#newpass1").bind("keyup",function(){var y=$(this).val();var I=y.length;var B=y.match(/[^A-Za-z\d]/);var C=y.match(/\d/);var x=y.match(/[a-z]/)&&y.match(/[A-Z]/);var H=0;var K=4;var A={length:false,"mixed-case":false,"special-chars":false,numbers:false};if(I>=passwordMinLength&&I<=passwordMaxLength){A.length=true;H++}if(x){A["mixed-case"]=true;H++}if(C){A.numbers=true;H++}if(B){A["special-chars"]=true;H++}for(var J in A){var D=A[J];var E=$("#password-meter-status-"+J);E.find("img.status-checked").css("visibility",D?"visible":"hidden")}var G=Math.floor(H/K*2);var L=new Array("low","medium","high");for(var F in L){if(F!=G){$("#password-meter-rating-"+L[F]).removeClass("arrow")}else{$("#password-meter-rating-"+L[F]).addClass("arrow")}}});$(".contentzs").tabs({select:function(d,c){$("input#selectedTab").val($(c.tab).parent().prevAll().length)},show:function(){Tipped.hide($("input:not(:visible)"));Tipped.show($("input:visible"))}});$("#sortSetting").unbind("change").bind("change",function(){var d="settings_order";if($(this).val()==customSorting){var e=$("#sortOrder");e.attr("disabled","disabled").attr("name","");$("#sortOrderHidden").attr("name",d).val(e.val())}else{var f=$("#sortOrderHidden");f.attr("name","");$("#sortOrder").attr("name",d).removeAttr("disabled").val(f.val())}}).trigger("change");initFormValidation();if(isMobileOnly){$("#prefs").bind("submit",function(){var b=$(this);if(!b.data("asking")&&$("#db_character",b).val().length){b.data("asking",true);errorBoxDecision(preferenceLoca.changeNameTitle,preferenceLoca.changeNameQuestion.replace("%newName%",$("#db_character",b).val()),LocalizationStrings.yes,LocalizationStrings.no,function(){b.submit();b.data("asking",false)},function(){b.data("asking",false)});return false}})}initPreferencesTabs()}function display_info(b){if(document.getElementById("infoInput").innerHTML==""||document.getElementById("infoInput").innerHTML!=get_displayText(b)){document.getElementById("infoInput").innerHTML=get_displayText(b)}}function display_error(b){if(document.getElementById("errorInput").innerHTML==""||document.getElementById("errorInput").innerHTML!=get_errorText(b)){document.getElementById("errorInput").innerHTML=get_errorText(b);document.getElementById("error").style.display="block"}}function hide_error(b){document.getElementById("errorInput").innerHTML="";document.getElementById("error").style.display="none"}function checkUsername(){var b=document.forms["new"].elements.username.value;if(b.length<3||b.length>=20){display_error("username")}else{hide_error()}}function checkEmail(){var b=document.forms["new"].elements.email.value;validate=b.match(/[a-zA-Z0-9]+@+[a-zA-Z0-9]+[.]+[a-zA-Z0-9]{2,4}/);if(b.length<3||b.length>=64||!validate){display_error("email")}else{hide_error()}}function resourceTicker(e){var f=this;f.config=e;f.htmlObj=document.getElementById(f.config.valueElem);var d=new Date();f.startTime=d.getTime();f.updateResource=function(){var a=new Date().getTime();nrResource=f.config.available+f.config.production*(a-f.startTime)/1000;nrResource=Math.max(0,Math.floor(nrResource));if(nrResource<f.config.available||nrResource>=f.config.available&&nrResource<f.config.limit){f.htmlObj.innerHTML=gfNumberGetHumanReadable(nrResource,isMobile);if(nrResource>=f.config.limit[1]){f.htmlObj.className="overmark"}else{if(nrResource>=f.config.limit*0.9&&nrResource<f.config.limit){f.htmlObj.className="middlemark"}else{if(nrResource<=f.config.limit*0.9){f.htmlObj.className=""}}}if(f.config.production<0&&nrResource==0||f.config.production==0){timerHandler.removeCallback(f.intervalObj)}}else{if(f.config.production>0&&nrResource>=f.config.available&&nrResource>=f.config.limit){nrResource=gfNumberGetHumanReadable(f.config.limit,isMobile);f.htmlObj.innerHTML=nrResource;f.htmlObj.className="overmark";timerHandler.removeCallback(f.intervalObj)}}};if(f.config.production>0&&f.config.available>=f.config.limit){return}if(f.config.production<=0&&f.config.available==0){return}f.intervalObj=timerHandler.appendCallback(f.updateResource)}function initSearch(){$(document).ready(function(){$("#searchText").focus();$(".searchTabs .tab").unbind("click").bind("click",function(){$(this).parents(".subsection_tabs").find("li").removeClass("ui-tabs-selected");$(this).parent().addClass("ui-tabs-selected");ajaxSearch(1,this)});$(".searchall .buttonSave").unbind("click").bind("click",function(){ajaxSearch(1,this)})}).undelegate(".searchTabs .ajaxSearch","click").delegate(".searchTabs .ajaxSearch","click",function(b){b.stopPropagation();ajaxSearch($(this).attr("ref"),this)})}var inventoryObj={currentPage:null,currentItems:null,currentItem:null,currentCategory:null,initalizeSlider:function(T,ab,af,V,P,ap,ai,am,S){if(inventoryObj.currentItems==T&&typeof(ap)=="undefined"||ap==false){return}inventoryObj.currentItems=T;P=P||"slideIn";ai=ai||"tooltipHTML js_hideTipOnMobile";if(typeof(am)=="undefined"){am=true}if(typeof(S)=="undefined"){S=true}$("#"+ab+"Box").remove(".anythingSlider");var Q=0,R=0,Y=0,N=$('<ul id="'+ab+'" />');for(var O in T){var U=T[O];if(typeof(U.hide)!="undefined"&&U.hide){continue}R++;if(Y%inventoryObj.itemsPerSlide==0){var aa=$('<li class="slide_'+Q+'" />').appendTo(N);Q++}var an,X,ae;if(inventoryObj.currentPage=="shop"){an=getNumberFormatShort(U.costs,null)+" "+loca.currency[U.currency];X="price"}else{an=getNumberFormatShort(U.amount);X="amount"}var W;if(am){W=U.imageLarge+"-75x.png"}else{W=U.imageLarge+"-100x.png"}var ad;if(U.canBeActivated||U.canBeBoughtAndActivated){ad="enabled"}else{ad="disabled"}if(U.isReduced){ae='<div class="sale_badge '+ad+'"></div>'}else{ae=""}var aj=(U.timeLeft!=null)?" js_is_active ":"";var ak="";var ag=U.title;if(ab.indexOf("js_activeItemSlider")!=-1){ag="";ak=(U.timeLeft!=null)?'<span class="js_duration undermark" data-total-duration="'+U.totalTime+'">'+U.timeLeft+"</span>":""}var ah="";if(U.timeLeft!=null&&ab.indexOf("js_activeItemSlider")!=-1){ah='<div class="pusher"></div>'}var al="";if($.inArray(birthdayCategory,U.category)!=-1){al='<div class="event_active_hint"></div>'}aa.append('<div class="item_img r_'+U.rarity+'" style="background-image: url(/cdn/img/item-images/'+W+');"><div class="item_img_box">'+al+'<div class="activation '+ad+aj+'"></div><a href="javascript:void(0);" tabindex="1" title="'+ag+'" class="detail_button '+ai+" "+P+'" ref="'+U.ref+'">'+ae+'<span class="ecke"><span class="level '+X+'">'+an+"</span></span></a></div>"+ak+ah+"</div>");Y++}$("#"+ab+"Box").prepend(N);if($("#"+ab+" li").length==0){var ac=$("<li></li>");$("#"+ab).append(ac)}$("#"+ab+" li").each(function(a){for(var b=R%inventoryObj.itemsPerSlide;b<inventoryObj.itemsPerSlide;b++){$(this).append('<div class="item_img"><div class="empty border5px"></div></div>')}});var ao=false;if(typeof(isRTLEnabled)!="undefined"&&isRTLEnabled){ao=true}else{ao=false}var Z=$("#"+ab).anythingSlider({startStopped:true,buildStartStop:false,expand:true,resizeContents:false,theme:"default",infiniteSlides:false,autoPlay:false,easing:"swing",resizeContents:true,stopAtEnd:true,playRtl:isRTLEnabled,hashTags:true,buildNavigation:S,onInitialized:function(e,k){if(isMobile){var j=1000,f=50,d=0,b=0,g="ontouchend" in document,a=(g)?"touchstart":"mousedown",c=(g)?"touchmove":"mousemove",l=(g)?"touchend":"mouseup";k.$window.bind(a,function(p){b=(new Date()).getTime();d=p.originalEvent.touches?p.originalEvent.touches[0].pageX:p.pageX}).bind(l,function(p){b=0;d=0}).bind(c,function(q){var p=q.originalEvent.touches?q.originalEvent.touches[0].pageX:q.pageX,u=(d===0)?0:Math.abs(p-d),w=(new Date()).getTime();if(b!==0&&w-b<j&&u>f){if(p<d){k.goForward()}if(p>d){k.goBack()}b=0;d=0}})}}});return Z},initShop:function(){var b=this;$(window).unbind(".shop");$(document).undelegate(".slideIn","click.shop").delegate(".slideIn","click.shop",function(){if(b.currentItem==$(this).attr("ref")){b.currentItem=null;$.bbq.pushState({item:""})}else{b.currentItem=$(this).attr("ref");$.bbq.pushState({item:$(this).attr("ref")})}});$("button.to_shop").bind("click.shop",function(){$.bbq.pushState({page:"shop"})});$("button.to_inventory").bind("click.shop",function(){$.bbq.pushState({page:"inventory"})});$(".to_shop, .to_inventory").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});$(".categoryFilter li a").bind("click.shop",function(){$.bbq.pushState({category:$(this).attr("rel")})});$(window).unbind("hashchange.shop").bind("hashchange.shop",function(a){b.onHashChange($.deparam.fragment(a.fragment))});b.onHashChange($.deparam.fragment());inventoryObj.refreshResources()},onHashChange:function(l){if(typeof(l.page)=="undefined"){var j={page:"shop",category:$(".categoryFilter a:first").attr("rel")};if(typeof(l.item)!="undefined"&&l.item!=""){var k=inventoryObj.items_shop[l.item];if(k.category.length>0){j.category=k.category[k.category.length-1]}}$.bbq.pushState(j);return}var f=this.currentPage!=l.page;if(f){if(l.page=="inventory"){this.openInventory();$(".planetlink, .moonlink").fragment({page:l.inventory})}else{this.openShop();$(".planetlink, .moonlink").fragment({page:l.shop})}this.updateCategoryAmount()}if(typeof(l.category)=="undefined"){$.bbq.pushState({category:$(".categoryFilter a:first").attr("rel")});return}else{if(l.category!=this.currentCategory||f){this.changeCategory(l.category)}}if(typeof(l.item)=="undefined"||l.item==""&&this.currentItem!=null){$("#itemDetails a.close_details").click();$(".planetlink, .moonlink").fragment({item:""})}else{if(this.currentItem!=l.item){var g=$(".slideIn[ref='"+l.item+"']");if(g.length){g.click()}else{gfSlider.slideIn(getElementByIdWithCache("detail"),l.item)}$(".planetlink, .moonlink").fragment({item:l.item})}}},initShopDetails:function(){var c=this;var d=$.deparam.querystring().page;$(document).undelegate("#itemDetails .close_details","click").delegate("#itemDetails .close_details","click",function(){$("a.slideIn[ref="+$(this).attr("ref")+"]:first").click()}).undelegate("#itemDetails a.item.build-it","click").delegate("#itemDetails a.item.build-it","click",function(){$.ajax({url:$(this).attr("rel"),data:{ajax:1,token:buyToken},type:"POST",dataType:"json",error:function(){fadeBox(translation.buyError,true)},success:function(a){buyToken=a.newToken;if(a.error){fadeBox(a.message,true)}else{fadeBox(a.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(a.item)}}});return false}).undelegate("#itemDetails a.item.build-it_disabled.dm","click").delegate("#itemDetails a.item.build-it_disabled.dm","click",function(){errorBoxDecision(LocalizationStrings.error,loca.buyDMDecision,LocalizationStrings.yes,LocalizationStrings.no,function(){if($("a.dm_button").length>0){$("a.dm_button").click()}else{window.location.href=$("#darkmatter_box a").attr("href")}})}).undelegate("#itemDetails a.activateItem.build-it","click").delegate("#itemDetails a.activateItem.build-it","click",function(){var a=$(this);function b(){$.ajax({url:a.attr("rel"),data:{ajax:1,token:activateToken,referrerPage:d},type:"POST",dataType:"json",error:function(){fadeBox(translation.buyError,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")},success:function(f){activateToken=f.newToken;if(f.error){fadeBox(f.message,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")}else{if(f.message.reload){location.href=getRedirectLink();return}f=f.message;fadeBox(f.message,false);inventoryObj.refreshItemData(f.item)}}})}if(a.hasClass("isUpgrade")){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,b)}else{b()}return false}).undelegate("#itemDetails a.buyAndActivate.build-it","click").delegate("#itemDetails a.buyAndActivate.build-it","click",function(){var a=$(this);function b(){$.ajax({url:a.attr("rel"),data:{ajax:1,token:activateToken,referrerPage:d},type:"POST",dataType:"json",error:function(){fadeBox(translation.buyError,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")},success:function(f){activateToken=f.newToken;if(f.error){fadeBox(f.message,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")}else{if(f.message.reload){location.href=getRedirectLink();return}f=f.message;fadeBox(f.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(f.item)}}})}if(a.hasClass("isUpgrade")){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,b)}else{b()}return false})},refreshResources:function(){getAjaxResourcebox(function(b){$(".to_dark_matter .level").text(b.darkmatter.resources["actualFormat"])})},refreshItemData:function(e){var d=e.ref;changeTooltip($(".detail_button[ref='"+d+"']"),e.title);$(".detail_button[ref='"+d+"'] span.amount, #itemDetails[data-uuid='"+d+"'] span.amount").html(tsdpkt(e.amount));if(typeof(inventoryObj.items_inventory)!="undefined"){if(inventoryObj.items_inventory.length==0){inventoryObj.items_inventory={}}else{if(e.amount<=0){delete inventoryObj.items_inventory[d]}else{inventoryObj.items_inventory[d]=e}}}if(typeof(inventoryObj.items_shop)!="undefined"){if(inventoryObj.items_shop.length==0){inventoryObj.items_shop={}}inventoryObj.items_shop[d]=e}changeTooltip($('#itemDetails[data-uuid="'+d+'"] a.activateItem, #itemDetails[data-uuid="'+d+'"] a.buyAndActivate'),e.activationTitle);if(e.hasEnoughCurrency){$('#itemDetails[data-uuid="'+d+'"] a.item').addClass("build-it").removeClass("build-it_disabled")}else{$('#itemDetails[data-uuid="'+d+'"] a.item').removeClass("build-it").addClass("build-it_disabled")}if(e.amount>0){$('#itemDetails[data-uuid="'+d+'"] a.activateItem').show();$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate').hide();if(e.canBeActivated){$('#itemDetails[data-uuid="'+d+'"] a.activateItem').removeClass("build-it_disabled").addClass("build-it")}else{$('#itemDetails[data-uuid="'+d+'"] a.activateItem').addClass("build-it_disabled").removeClass("build-it")}}else{$('#itemDetails[data-uuid="'+d+'"] a.activateItem').hide();$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate').show();if(e.canBeBoughtAndActivated&&e.hasEnoughCurrency){$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate').removeClass("build-it_disabled").addClass("build-it")}else{$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate').addClass("build-it_disabled").removeClass("build-it")}}if(isMobile){var f="";if($('#itemDetails[data-uuid="'+d+'"] a.activateItem:visible,#itemDetails[data-uuid="'+d+'"] a.buyAndActivate:visible').hasClass("build-it_disabled")){f+=e.activationTitle}if(e.buyTitle.length&&e.buyTitle!=e.activationTitle){f+=e.buyTitle}$('#itemDetails[data-uuid="'+d+'"] .info_txt').text(f)}if(e.timeLeft>0){$('#itemDetails[data-uuid="'+d+'"] a.activateItem span').html(loca.extend);$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate span').html(loca.buyAndExtend)}else{$('#itemDetails[data-uuid="'+d+'"] a.activateItem span').html(loca.activate);$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate span').html(loca.buyAndActivate)}if(e.isAnUpgrade){$('#itemDetails[data-uuid="'+d+'"] a.activateItem, #itemDetails[data-uuid="'+d+'"] a.buyAndActivate').addClass("isUpgrade")}else{$('#itemDetails[data-uuid="'+d+'"] a.activateItem, #itemDetails[data-uuid="'+d+'"] a.buyAndActivate').removeClass("isUpgrade")}if(this.inShop===true){this.changeCategory($(".categoryFilter a.active").attr("rel"))}this.updateCategoryAmount()},boughtItemHint:function(){$(".to_inventory .bought_item_notice").show().fadeOut(1000)},openShop:function(){this.currentPage="shop";$("#js_inventorySliderBox").hide();$("#js_shopSliderBox").show();$(".to_inventory").removeClass("active");$(".to_shop").addClass("active");$("#buttonz h2").text(loca.LOCA_PREMIUM_SHOP);if(isMobile){$(".js_shopCurrentPage").html(loca.shopText)}},openInventory:function(){this.currentPage="inventory";$("#js_shopSliderBox").hide();$("#js_inventorySliderBox").show();$(".to_shop").removeClass("active");$(".to_inventory").addClass("active");$("#buttonz h2").text(loca.LOCA_PREMIUM_INVENTORY);if(isMobile){$(".js_shopCurrentPage").html(loca.inventoryText)}},changeCategory:function(c){inventoryObj.currentCategory=c;$(".planetlink, .moonlink").fragment({category:c});$(".categoryFilter li, .categoryFilter li a").removeClass("active");$('.categoryFilter li a[rel="'+c+'"]').addClass("active").parent().addClass("active");$(".anythingSlider").remove();var d=function(f,a){var b=new Array();$.each(f,function(j){if(this.category!=null){var e="$"+this.category.join("$")+"$";if(e.toLowerCase().indexOf("$"+c+"$")!=-1){b[inventoryObj.item_orders[c][this.ref]]=this}}});inventoryObj.initalizeSlider(b,a,340,340,null,null,null,false)};if(inventoryObj.currentPage=="shop"){d(inventoryObj.items_shop,"js_shopSlider")}else{if(inventoryObj.currentPage=="inventory"){d(inventoryObj.items_inventory,"js_inventorySlider")}}},updateCategoryAmount:function(){var d;if(inventoryObj.currentPage=="shop"){d=inventoryObj.items_shop}else{if(inventoryObj.currentPage=="inventory"){d=inventoryObj.items_inventory}else{return}}var c=$(".categoryFilter");c.find(".amount").text(0);$.each(d,function(l){if(this.category!=null){for(var a in this.category){var b=this.category[a];var j=c.find('a[rel="'+b+'"] .amount');var k;if(inventoryObj.currentPage=="shop"){k=1}else{if(inventoryObj.currentPage=="inventory"){k=this.amount}}j.text(tsdpkt(getValue(j.text())+k))}}});$.each(c.find("li"),function(b){var a=inventoryObj.currentPage.slice(0,1).toUpperCase()+inventoryObj.currentPage.slice(1);if($(this).hasClass("in"+a)){$(this).show()}else{$(this).hide();if(!c.find("li:visible .active").length){c.find("li:visible:first a").click()}}})}};function GFSlider(d){var c=this;if(OGConfig.sliderOn==1){c.duration=500}else{c.duration=1}c.zIndex=10;c.intervalTime=30;c.lastTid=0;c.inAction=false;c.isOpen=false;c.lastObj=false;c.currHeight=d.offsetHeight;c.opacity=1;c.header=document.getElementById("header_text");c.ressButton=document.getElementById("resources_button");c.areaMap=document.getElementById("transImg");this.slideIn=function(b,a){if(!c.inAction){c.slideInObj=b;if(c.lastTid!=a){b.opacity=1;c.lastTid=a;$("#detail").html('<div id="techDetailLoading"></div>');if(!c.isOpen){if(c.ressButton){c.ressButton.style.display="none"}b.style.height="1px";b.style.display="block";b.style.overflow="hidden";c.inAction=true;c.startTime=new Date().getTime();c.slideInStep();c.isOpen=true}else{loadDetails(c.lastTid)}}else{c.header.style.display="block";c.opacity=0;c.lastTid=0;c.inAction=true;c.isOpen=false;c.startTime=new Date().getTime();c.slideOutObj=c.slideInObj;c.slideOutStep()}}};this.slideInStep=function(){d=c.slideInObj;var a=new Date().getTime();height=parseInt(c.currHeight*((a-c.startTime)/c.duration));if(height<c.currHeight){d.style.height=(height)+"px";d.style.marginTop=(c.currHeight-1-height)+"px";window.setTimeout(c.slideInStep,c.intervalTime);c.opacity=Math.max(c.opacity-0.1,0);c.header.style.opacity=c.opacity;c.header.style.filter="Alpha(opacity="+(0.5*100)+")"}else{d.style.height=c.currHeight+"px";d.style.marginTop="0px";c.inAction=false;c.header.style.display="none";loadDetails(c.lastTid);if(c.lastObj&&d!=c.lastObj){c.hideLast()}c.lastObj=d}};this.slideOutStep=function(){d=c.slideInObj;var a=new Date().getTime();height=parseInt(c.currHeight*((a-c.startTime)/c.duration));if(height<c.currHeight){d.style.height=(c.currHeight-1-height)+"px";d.style.marginTop=(height)+"px";window.setTimeout(c.slideOutStep,c.intervalTime);c.opacity=Math.max(c.opacity+0.1,0);c.header.style.opacity=c.opacity}else{d.style.height=c.currHeight+"px";d.style.marginTop="0px";c.opacity=1;c.header.style.opacity=c.opacity;if(c.ressButton){c.ressButton.style.display="block"}d.style.display="none";c.inAction=false;c.hideLast()}};this.hideLast=function(){if(c.lastObj){$(".slideIn").removeClass("active");c.lastObj.style.display="none";c.inAction=false}},this.hide=function(a){$(".slideIn").removeClass("active");c.slideOutObj=a;c.opacity=1;c.header.style.opacity=c.opacity;c.header.style.display="block";if(c.ressButton){c.ressButton.style.display="block"}if(c.areaMap){c.areaMap.style.display="block"}c.slideOutObj.style.display="none";c.inAction=false;c.lastTid=0;c.isOpen=false}}function rocketsDestroyed(b){var b=$.parseJSON(b);errorBoxAsArray(b.errorbox);if(!b.errorbox.failed){$(".rocketlayer").dialog("close")}}function supplyFleet(b){var b=$.parseJSON(b);if(b.status){getAjaxResourcebox()}errorBoxAsArray(b.errorbox)}function tabletInitOverviewAdvice(){if(!isMobile){return false}var f=$(".adviceWrapper");var d=f.find("#exodus-indicator, #exodus-timer");var e=f.find("#exodus-indicator-processed");f.prev().before(d);f.prev().before(e);$("#planetdata").after(f)}function tabletInitGalaxyDetails(){if(!isMobile){return false}var b=["js_planet","js_planetName","js_moon","js_debris","js_playerName","js_allyTag"];$(".js_detailRow").hide();$(".planetname, .planetname1").each(function(){$newNode=$('<div class="'+$(this).attr("class")+'"/>');$(this).prev().append($newNode);$newNode.append($(this).html());$(this).remove()});$(".js_detailRow").each(function(e){e=$(this).attr("rel");for(var f=0;f<b.length;f++){var a=$("."+b[f]+e);if(a===undefined||a.length==0){if(e==17){continue}return}if(a.attr("class").indexOf("js_no_action")>=0){continue}a.unbind();a.bind("click.planet",function(c){$(".row").children().each(function(){if($(this).html().trim()){$(this).removeClass("active")}});if($(".bdaySlotBox")){$(".bdaySlotBox .name").removeClass("active")}if($(this).html().trim()){$(this).addClass("active")}$(".js_detailRow").hide();if($(this).html().trim()){if($(this).attr("class").indexOf("js_planet")>=0){$(".js_detailRowPlanet"+e).toggle().find(".active_row_details_content")}else{if($(this).attr("class").indexOf("js_moon")>=0){$(".js_detailRowMoon"+e).toggle()}else{if($(this).attr("class").indexOf("js_debris")>=0){$(".js_detailRowDebris"+e).toggle()}else{if($(this).attr("class").indexOf("js_playerName")>=0){$(".js_detailRowPlayer"+e).toggle()}else{if($(this).attr("class").indexOf("js_allyTag")>=0){$(".js_detailRowAlliance"+e).toggle()}}}}}}})}});$("a.planetMoveIcons").bind("click",function(a){a.stopPropagation()})}function tabletToggleTechtreeInfos(){if(!isMobile){return false}var b=$(".wrapper").find(".techDiv");b.each(function(){var j=$(this);var k=j.hasClass("greenBorder")?"undermark":"overmark";var g=j.data("tech-name");var a=j.data("tech-type");var l=j.data("tech-level")?j.data("tech-level"):"";j.append('<div class="short_info" style="display: none"><span class="'+k+'">'+g+"<br/>"+l+"</span><br/>"+a+"</div>")});if(b.length){$(".techtree").append($('<a id="toggleDetails" href="javascript:void(0)" class="btn_blue">'+LocalizationStrings.moreDetails+"</a>").click(function(){var a=$(".short_info");if(a.is(":visible")){$(this).text(LocalizationStrings.moreDetails)}else{$(this).text(LocalizationStrings.lessDetails)}a.toggle()}))}}function tabletInitEmpire(){if(!isMobile){return false}var b=$("#mainWrapper").width();b=(b<1024)?"1024":b;$("#outerWrapper").width(b);$(".reset").hide()}function tabletInitPayment(){if(!isMobile){return false}$("#payment").parent(".overlayDiv").dialog("option","title",paymentLoca.title);document.addEventListener("deviceready",function(){$("#mobilePayment a.js_buyPacket").unbind("click").bind("click",function(){HostApp.StartPayment($(this).attr("ref"),userData.id,constants.name,constants.language)});HostApp.OnPaymentFinished=function(){getAjaxResourcebox(function(b){fadeBox(paymentLoca.success,false);$("#payment").parent().dialog("close");$("#planet #content .level span").attr("class","undermark").text(b.darkmatter.string)})};HostApp.OnPaymentFailed=function(){fadeBox(paymentLoca.error,true)}},false)}function initRetinaImages(){if($(".js_replace2x").css("font-size")=="1px"){$("img.js_replace2x").each(function(){$(this).attr("src",$(this).attr("rel"))})}}function initTechtree(){initOverlayName();var g=$(".techtree:last .wrapper");var e=g.find(">div");var j=Math.max.apply(Math,e.map(function(){return $(this).position().left+$(this).outerWidth()}).get());var f=Math.max.apply(Math,e.map(function(){return $(this).position().top+$(this).outerHeight()}).get());g.css("height",f).css("width",j)}function initTechinfo(){initOverlayName()}function initGlobalTechtree(){initOverlayName();var b=$(".techtree:last");b.find(".headline").unbind("click").bind("click",function(){$(this).next().slideToggle("slow",function(){$(this).toggleClass("open")})});if(openTree=="all"){b.find(".techtree_content").show(0,function(){$(this).addClass("open")})}else{if(openTree!=null){b.find(".techtree_content_"+openTree).show(0,function(){$(this).addClass("open")})}else{if(openTree!=null){b.find(".techtree_content_"+openTree).show(0,function(){$(this).toggleClass("open")})}}}}function initOverlayName(){$(".techtree").each(function(){if(typeof($(this).attr("data-title"))!="undefined"){$(this).parent(".overlayDiv").dialog("option","title",$(this).attr("data-title"))}})}var javascriptAvailable=true;var days=new Array("Mon","Tus","Wed","Thu","Fri","Sat","Sun");var months=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");function getFormatedDate(d,f){var e=new Date();e.setTime(d);str=f;str=str.replace("[d]",dezInt(e.getDate(),2));str=str.replace("[D]",days[e.getDay()]);str=str.replace("[m]",dezInt(e.getMonth()+1,2));str=str.replace("[M]",months[e.getMonth()]);str=str.replace("[j]",parseInt(e.getDate()));str=str.replace("[Y]",e.getFullYear());str=str.replace("[y]",e.getFullYear().toString().substr(2,4));str=str.replace("[G]",e.getHours());str=str.replace("[H]",dezInt(e.getHours(),2));str=str.replace("[i]",dezInt(e.getMinutes(),2));str=str.replace("[s]",dezInt(e.getSeconds(),2));return str}function dezInt(g,p,k){k=(k)?k:"0";var l=(g<0)?"-":"",j=(k=="0")?l:"";g=Math.abs(parseInt(g,10));p-=(""+g).length;for(var q=1;q<=p;q++){j+=""+k}j+=((k!="0")?l:"")+g;return j}function getFormatedTime(b){hours=Math.floor(b/3600);timeleft=b%3600;minutes=Math.floor(timeleft/60);timeleft=timeleft%60;seconds=timeleft;return dezInt(hours,2)+":"+dezInt(minutes,2)+":"+dezInt(seconds,2)}function tsdpkt(b){r="";vz="";if(b<0){vz="-"}b=Math.abs(b);r=b%1000;while(b>=1000){k1="";if((b%1000)<100){k1="0"}if((b%1000)<10){k1="00"}if((b%1000)==0){k1="00"}b=Math.abs((b-(b%1000))/1000);r=b%1000+LocalizationStrings.thousandSeperator+k1+r}r=vz+r;return r}function formatTime(f){var e=Math.floor(f/3600);f-=e*3600;var d=Math.floor(f/60);f-=d*60;if(d<10){d="0"+d}if(f<10){f="0"+f}return e+":"+d+":"+f}function trimInteger(b){b=b.replace(/^\s+|\s+$/g,"");withoutZero=b.replace(/^0+/g,"");if(withoutZero==""&&b!=""){return 0}else{return withoutZero}}function round(f,g){if(g<1||g>14){return false}var j=Math.pow(10,g);var e=(Math.round(f*j)/j).toString();if(e.indexOf(".")==-1){e+="."}e+=j.toString().substring(1);return e.substring(0,e.indexOf(".")+g+1)}function show_hide_menus(b){if($(b).is(":visible")){$(b).hide()}else{$(b).show()}}function change_class(b){if(document.getElementById(b).className=="closed"){document.getElementById(b).className="opened"}else{document.getElementById(b).className="closed"}}function show_hide_tbl(f){var e=document.getElementById(f);try{if(e){e.style.display=(e.style.display=="none"?"table-row":"none")}}catch(d){e.style.display="block"}}function t(){v=new Date();n=new Date();o=new Date();for(cn=1;cn<=anz;cn++){bxx=document.getElementById("bxx"+cn);ss=bxx.title;s=ss-Math.round((n.getTime()-v.getTime())/1000);m=0;h=0;if(s<0){bxx.innerHTML="-"}else{if(s>59){m=Math.floor(s/60);s=s-m*60}if(m>59){h=Math.floor(m/60);m=m-h*60}if(s<10){s="0"+s}if(m<10){m="0"+m}bxx.innerHTML=h+":"+m+":"+s+""}bxx.title=bxx.title-1}window.setTimeout("t();",999)}function cntchar(f,d){var e=$(f);if(e.val().length>d){e.val(e.val().substr(0,d))}e.parents("form").find(".cntChars").text(e.val().length)}function getSession(){return $('meta[name="ogame-session"]').attr("content")}function showGalaxy(f,d,e){openParentLocation("index.php?page=galaxy&no_header=1&galaxy="+f+"&system="+d+"&planet="+e)}function openParentLocation(c){try{window.opener.document.location.href=c}catch(d){try{window.parent.document.location.href=c}catch(d){document.location.href=c}}}function submitOnEnter(d){var c;if(window.event){c=window.event.keyCode}else{if(d){c=d.which}else{return true}}if(c==13){trySubmit();return false}else{return true}}function formSubmitOnEnter(d,e){var f;if(window.event){f=window.event.keyCode}else{if(e){f=e.which}else{return true}}if(f==13){document.forms[d].submit();return false}else{return true}}function setMaxIntInput(e,d){for(var f in d){if(!$(e).find("#ship_"+f).attr("disabled")){$(e).find("#ship_"+f).val(d[f]);checkIntInput($(e).find("ship_"+f),0,d[f])}}}function clearInput(b){$(b).val("")}function checkIntInput(f,e,d){value=$(f).val();if(typeof value!="undefined"&&value!=""){intVal=trimInteger(value);intVal=parseInt(value);intVal=(isNaN(intVal)||intVal==0)?e:intVal;intVal=Math.abs(intVal);if(d!=null){intVal=Math.min(intVal,d)}$(f).val(intVal)}}function handlerToSubmitAjaxForm(c){var d="submit_"+String(c);if($.isFunction(window[d])){window[d]()}return false}function ajaxCall(d,c){$("#"+c).html('<p id="ajaxLoad"></p>');$.post(d,function(a){$("#"+c).html(a)})}function ajaxSumbit(e,d,f){$("#"+f).html('<p id="ajaxLoad"><?=LOCA_ALL_AJAXLOAD ?></p>');$.post(e,$("#"+d).serialize(),function(a){$("#"+f).html(a)})}Number.prototype.isBetween=function(c,d){return this>=c&&this<=d};function initLinks(){$(document).undelegate("a.bbcodeLink","click").delegate("a.bbcodeLink","click",function(){if(!isMobile){var b=$(this).attr("href");if($(this).hasClass("internal")){openParentLocation(b);return false}window.open("redir.php?url="+encodeURI(b),"_newtab");return false}}).undelegate("a.galaxylink","click").delegate("a.galaxylink","click",function(){var b=$(this).attr("href");openParentLocation(b);return false})}function getValue(b){result=parseInt(b.toString().replace(/^0+/,"").replace(/[^0-9]/g,""));return isNaN(result)?0:result}function loadScript(d,f){var e=document.createElement("script");e.type="text/javascript";if(e.readyState){e.onreadystatechange=function(){if(e.readyState=="loaded"||e.readyState=="complete"){e.onreadystatechange=null;f()}}}else{e.onload=function(){f()}}e.src=d;document.getElementsByTagName("head")[0].appendChild(e)}function formatNumber(f,j){var l=number_format(getValue(j),0,LocalizationStrings.decimalPoint,LocalizationStrings.thousandsSeparator);var k=$(f);var g=k.getSelection();if(k.val()!=l){if(k.val().length!=l.length){g.start=g.start+(l.length-k.val().length);g.end=g.end+(l.length-k.val().length)}}k.val(l);if(k.is(":focus")){k.setSelection(g)}}function initToggleHeader(){$("a.toggleHeader").click(function(){$("#planet").toggleClass("shortHeader");$(".c-left").toggleClass("shortCorner");$(".c-right").toggleClass("shortCorner");changeCookie(cookieName)})}function initFormValidation(){$.validationEngineLanguage.newLang();$("form.formValidation").validationEngine({validationEventTriggers:"keyup blur",promptPosition:"centerRight",inlineValidation:true})}jQuery.fn.extend({selectText:function(){var f=$(this)[0];if($.browser.msie){var e=document.body.createTextRange();e.moveToElementText(f);e.select()}else{if($.browser.mozilla||$.browser.opera){var d=window.getSelection();var e=document.createRange();e.selectNodeContents(f);d.removeAllRanges();d.addRange(e)}else{if($.browser.safari){var d=window.getSelection();d.setBaseAndExtent(f,0,f,1)}}}return $(this)}});Function.prototype.clone=function(){var d=this;var c=function(){return d.apply(this,arguments)};c.prototype=d.prototype;for(property in d){if(d.hasOwnProperty(property)&&property!=="prototype"){c[property]=d[property]}}return c};function hideTipsOnTabChange(){Tipped.hideAll()}jQuery.fn.slideFadeToggle=function(e,f,d){return this.animate({opacity:"toggle",width:"toggle"},e,f,d)};function changeTooltip(e,f){var d=$(e);if(d.length==0){return}removeTooltip(d);d.attr("title",f);initTooltips(d)}function removeTooltip(d){var c=$(d);c.data("tooltipLoaded",false);Tipped.remove(c)}function getTooltipOptions(d){var f=$(d);var e={skin:"cloud",maxWidth:300,closeButton:false,hideOn:[{element:"self",event:"mouseleave"},{element:"tooltip",event:"mouseenter"}]};if(window.location.href.indexOf("galaxy")!==-1){e.maxWidth=400}if(f.hasClass("tooltipLeft")){e.hook={target:"leftmiddle",tooltip:"righttop"}}else{if(f.hasClass("tooltipRight")){e.hook={target:"rightmiddle",tooltip:"lefttop"}}else{if(f.hasClass("tooltipBottom")){e.hook={target:"bottommiddle",tooltip:"topmiddle"}}}}if(f.data("tooltip-width")){e.maxWidth=f.data("tooltip-width")}if(isMobile||f.hasClass("tooltipClose")){e.hideOthers=true;e.hideOn=false}e.afterUpdate=function(a,c){if(isMobile&&f.data("tooltip-button")){var j=$(document.createElement("div")).addClass("tooltipButton");$(document.createElement("a")).addClass("btn_blue").attr("href","javascript:void(0);").html(f.data("tooltip-button")).bind("click",function(g){var l=document.createEvent("MouseEvents");l.initMouseEvent("click",true,true);c.dispatchEvent(l)}).appendTo(j);$(a).append(j)}if(isMobile||f.hasClass("tooltipClose")){var b=$(document.createElement("div")).addClass("close-tooltip");$(a).prepend(b)}Tipped.refresh(c)};return e}function getTooltipSelector(e){var f=".tooltip, .tooltipRight, .tooltipLeft, .tooltipBottom, .tooltipClose, .tooltipHTML, .tooltipRel, .tooltipAJAX, .tooltipCustom";if(typeof(e)=="undefined"){e=f}else{if(typeof(e)=="string"&&!e.match(/\.tooltip/)){var g=f.split(", ");var j=e;for(i in g){e+=", "+j+" "+g[i]}}}return e}function initTooltips(d){initTooltipSkins();d=getTooltipSelector(d);function f(b){var a=b.split("|");var c=$(document.createElement("h1")).html(a[0]);var k=$(document.createElement("div")).addClass("splitLine");var l=$(document.createElement("div")).css("display","none").addClass("htmlTooltip").append(c).append(k).append(a[1]);return l[0]}removeTooltip(d);function e(b){var a=$(b);if(a.data("tooltipLoaded")){return}a.data("tooltipLoaded",true);if(isMobile&&a.hasClass("js_hideTipOnMobile")){a.attr("title","");return}var c=getTooltipOptions(a);if(a.hasClass("tooltipCustom")){if(c.hideOn!=false){c.hideOn=[{element:"self",event:"mouseleave"},{element:"tooltip",event:"mouseleave"}]}c.afterUpdate=function(j){$(j).find(".tooltipCustom").each(function(g,p){var q=getTooltipOptions(a);if($(this).hasClass("tooltipHTML")){q.inline=true;q.hideOthers=false;Tipped.create(this,f($(this).attr("title")),q)}else{q.hideOthers=false;Tipped.create(this,$(this).attr("title"),q)}})}}if(a.hasClass("tooltipHTML")){if(typeof(a.attr("title"))=="undefined"){return}Tipped.create(a[0],f(a.attr("title")),c);return}if(a.hasClass("tooltipRel")){c.inline=true;Tipped.create(a[0],a.attr("rel"),c);return}if(a.hasClass("tooltipAJAX")){$.get(a.attr("rel"),{},function(j){Tipped.create(a[0],j,c)});return}if(typeof(a.attr("title"))=="undefined"||a.attr("title").length==0){return}Tipped.create(a[0],a.attr("title"),c)}$(document).undelegate(d,"touchstart.tooltipClick").delegate(d,"touchstart.tooltipClick",function(a){if(Tipped.visible(this)){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",true,true);this.dispatchEvent(b);a.preventDefault();a.stopPropagation()}});if(typeof(d)=="string"){$(document).undelegate(d,"mouseenter.tooltipLoad touchstart.tooltipLoad").delegate(d,"mouseenter.tooltipLoad touchstart.tooltipLoad",function(a){e(this)})}else{$(d).each(function(){e(this)})}}function initTooltipSkins(){jQuery.extend(Tipped.Skins,{cloud:{border:{size:1,color:[{position:0,color:"#44576b"},{position:1,color:"#2f3b47"}]},background:{color:[{position:0,color:"#303a46"},{position:0.49,color:"#242d38"},{position:0.81,color:"#10181f"},{position:1,color:"#0d1014"}]},offset:{x:0,y:-1,mouse:{x:-12,y:-12}},stem:{height:6,width:11,offset:{x:5,y:5},spacing:0}}})}function initTrader(){var d=false;var e=$.deparam.fragment();if(typeof(e.animation)!="undefined"){if(e.animation=="false"){d=true}}var f={$link:null,$panel:null,close:function(){this.$panel.hide()},setPanel:function(){this.$panel=$("#js_togglePanel"+traderObj.traderId.replace(/#div_trader/,""))},init:function(k){var c=$(k+" .selectWrapper");k=k.replace(/#div_trader/,"");if(!c){return}this.$link=$("#js_toggleLink"+k);this.$panel=$("#js_togglePanel"+k);var a=this.$panel;a.hide();this.$link.unbind("click.selectLink").bind("click.selectLink",function(g){k=traderObj.traderId.replace(/#div_trader/,"");if($(this).hasClass("honor")){return false}if(a.find("ul.active").has("li").length){a.toggle()}return false});$(".selectWrapper .source").unbind("click.selectPlanetOrMoon").bind("click.selectPlanetOrMoon",function(g){f.selectPlanetOrMoon(this)});$("#"+a.attr("id")).find("li").unbind("click.selectSource").bind("click.selectSource",function(g){traderObj.selectSource(this);return false});f.outerClick(c,a);var b=null,l=8000;c.unbind("mouseout.closeSelect").bind("mouseout.closeSelect",function(g){g=g||window.event;var j=(g.relatedTarget)?g.relatedTarget:g.toElement;if(j==c||f.isChildOf(j,c)){return}b=setTimeout(function(){a.hide()},l)}).unbind("mouseover.clearTimeout").bind("mouseover.clearTimeout",function(){if(b){clearTimeout(b)}})},isChildOf:function(a,b){b=b[0];while(a&&a!=b){a=a.parentNode}if(a==b){return true}else{return false}},outerClick:function(b,a){$("body").bind("click.outerClick",function(c){if(!c){c=window.event}if(!($(c.target).closest(".selectWrapper")==b)&&a.is(":visible")!=false){a.toggle()}})},selectPlanetOrMoon:function(a){var q;if($(a).hasClass("selected")){return false}var u="",x=null;if($(a).hasClass("js_honor")){$(traderObj.traderId+" .selectWrapper .source").removeClass("selected");$(traderObj.traderId+" .js_honor").addClass("selected");$(traderObj.traderId+" .toggleLink").addClass("honor");var u='<img height="18" src="/cdn/img/trader/honorPoints.png" alt="'+loca.honorPoints+'"/><span class="option_source">'+loca.honorPoints+"</span>";$(traderObj.traderId+" .js_valSourcePlanet").html(u);$(traderObj.traderId+" .normalResource").hide();$(traderObj.traderId+" .honorResource").show();return false}var w=$(traderObj.traderId+" .togglePanel");var b="planet";if($(a).hasClass("js_moon")){var c=0;b="moon";for(q in traderObj.planets){if(traderObj.planets[q].isMoon){c++}}if(c==0){return false}}var y=traderObj.planets[traderObj.current.planet];w.find("ul").hide().removeClass("active");w.find("ul."+b).show().addClass("active");$(traderObj.traderId+" .toggleLink").removeClass("honor");$(traderObj.traderId+" .selectWrapper .source").removeClass("selected");$(traderObj.traderId+" .js_"+b).addClass("selected");if($(a).hasClass("js_moon")?y.isMoon:!y.isMoon){x=traderObj.current.planet}else{if(y.otherPlanet!=null&&typeof(traderObj.planets[y.otherPlanet])!="undefined"){x=y.otherPlanet}else{x=w.find("ul."+b+" li:first").attr("id")}}$(traderObj.traderId+" .normalResource").show();$(traderObj.traderId+" .honorResource").hide();w.find("ul li#"+x).click();return false},setToggleLink:function(b){var c=traderObj.traderId.replace(/#div_trader/,""),j=$(b).find("span"),a=traderObj.planets[$(b).attr("id")].name;if(a!=j.text()){j.attr("title",a.replace(/\|/g,"&#124;"))}this.$link=$("#js_toggleLink"+c);this.$link.html($(b).html())}};traderObj={traderBGPos:{"#div_traderResources":"0px 0px","#div_traderAuctioneer":"-546px 0px","#div_traderScrap":"0px -220px","#div_traderImportExport":"-546px -220px"},timer:500,planets:{},honorOutput:0,price:0,deficit:0,priceImportExport:0,sumResources:0,traderId:null,resources:["Metal","Crystal","Deuterium"],current:{planet:currentPlanetId,resource:"",sliderValue:""},barXPos:-180,barYPos:0,percentPaid:0,switchingTrader:false,checkOverbidden:function(){if(playerBid==false||playerBid>=parseInt($(".detail_value.currentSum").text().replace(/[.,]/,""))){$(".overbid_text").hide()}else{$(".overbid_text").show()}},refresh:function(){var c=traderObj.traderId;if("#"+$(this).closest(".div_trader").attr("id")!==c){return}var b=$(this).attr("class");var a=new RegExp(/\b(js_slider\w*)\b/);b=(a.test(b))?RegExp.$1:false;if(!b){return}traderObj.current.sliderValue=$(this).slider("value");traderObj.current.resource=b.replace("js_slider","").toLowerCase();if(traderObj.current.resource=="honor"){traderObj.honorOutput=traderObj.current.sliderValue}else{traderObj.planets[traderObj.current.planet].output[traderObj.current.resource]=traderObj.current.sliderValue}formatNumber($(c+" .js_amount.js_"+traderObj.current.resource),traderObj.current.sliderValue);if(c=="#div_traderAuctioneer"){traderObj.price=getValue($(c+" .js_price").html());traderObj.sumAuctioneer();traderObj.checkOverbidden()}else{if(c=="#div_traderImportExport"){traderObj.sumImportExport()}}},resetValues:function(b,c){b=b||traderObj.traderId;c=c||false;for(var j in traderObj.planets){for(var a in traderObj.planets[j].output){traderObj.planets[j].output[a]=0}}traderObj.honorOutput=0;$(".js_amount").val(0);if(traderObj.traderId=="#div_traderAuctioneer"){traderObj.sumAuctioneer()}else{if(traderObj.traderId=="#div_traderImportExport"){traderObj.sumImportExport()}}if(c){b=b.replace(/#div_trader/,"");$("#js_togglePanel"+b).find("li#"+currentPlanetId).click()}f.close()},resetMaxAmount:function(b,x){var a=traderObj.traderId;var y=traderObj.resources;for(var c in traderObj.planets){for(var j=0;j<y.length;j++){var B=y[j].toLowerCase();traderObj.planets[c].input[B]=b[c][B]}}for(var w=0;w<y.length;w++){B=y[w].toLowerCase();var A=traderObj.planets[traderObj.current.planet].input[B];$(a+" .max_planet_"+B).html(number_format(A,0))}honorScore=x;$(a+" .max_planet_honor").html(number_format(Math.max(0,x),0));f.close()},selectSource:function(a){traderObj.current.planet=$(a).attr("id");f.close();f.setToggleLink($(a));var u=traderObj.traderId;var y=traderObj.current.planet;var A=traderObj.resources;for(var x=0;x<A.length;x++){var b=A[x].toLowerCase();var B=traderObj.planets[y].input[b];if(u=="#div_traderImportExport"){var c=(traderObj.priceImportExport/multiplier[b])-traderObj.sumResources+traderObj.planets[y].output[b];var w=Math.min(B,c)}$(u+" .max_planet_"+b).html(number_format(B,0));$(u+" .js_amount.js_"+b).val(number_format(traderObj.planets[y].output[b],0))}},selectTrader:function(p,a){a=a||traderObj.timer;$.bbq.pushState({page:p,animation:"false"});$(".planetlink, .moonlink").fragment({page:p,animation:"false"});traderObj.traderId="#div_"+p;var l=traderObj.traderId,q=$(".back_to_overview");var c=function(){if(l=="#div_traderAuctioneer"||l=="#div_traderImportExport"){traderObj.resetValues(null,true)}var g=function(){$("#traderOverview").find(".c-left, .c-right").addClass("c-small");q.show();if(l=="#div_traderAuctioneer"||l=="#div_traderImportExport"){q.addClass("left");q.removeClass("right")}else{if(l=="#div_traderResources"||l=="#div_traderScrap"){q.addClass("right");q.removeClass("left")}}$("#planet #header_text h2").html(loca[p]).parent().show();traderObj.showTradeNowButton()};if(animation&&!d){$("#traderOverview").find(".c-left, .c-right").hide();$("#planet").animate({backgroundPosition:traderObj.traderBGPos[l],height:"250px"},a,function(){$("#planet").addClass("detail");$("#traderOverview").find(".c-left, .c-right").show();g()})}else{d=false;$("#planet").css("background-position",traderObj.traderBGPos[l]).css("height","250px");g()}f.setPanel();$("#planet").addClass("detail");$(".js_trader").hide();$(l).show()};if($(traderObj.traderId).length==0){var b=p.toLowerCase().replace(/^trader/,"");$.ajax({url:traderUrl,type:"POST",data:{show:b,ajax:1},beforeSend:function(){$("#loadingOverlay").addClass(b).show()},success:function(g){$("#inhalt").append(g);$("#loadingOverlay").hide().removeClass(b);c()},error:function(){fadeBox(loca.error,true);$("#loadingOverlay").hide().removeClass(b)}})}else{c()}traderObj.switchingTrader=false},showTradeNowButton:function(){if(traderObj.traderId=="#div_traderResources"&&$("#callTrader").hasClass("traderActive")){$("#callTrader").show()}else{$("#callTrader").hide()}},submitAuction:function(){var b=traderObj.traderId;var a=getValue($(b+" .js_auctioneerSum").html());if(!$(b+" .right_box .pay").hasClass("disabled")&&traderObj.price>0&&traderObj.deficit<=0){$(b+" .right_box .pay").addClass("disabled");var c={planets:{},honor:traderObj.honorOutput};for(planetId in traderObj.planets){c.planets[planetId]=traderObj.planets[planetId].output}$.ajax({url:auctionUrl,type:"POST",data:{bid:c,token:auctioneerToken,ajax:1},dataType:"json",success:function(j){auctioneerToken=j.newToken;fadeBox(j.message,j.error);if(!j.error){traderObj.resetValues(b,false);traderObj.resetMaxAmount(j.planetResources,j.honor);traderObj.reloadResources()}},error:function(){fadeBox(loca.error,true)}})}return false},submitImportExport:function(){if(!$(traderObj.traderId+" .right_box .pay").hasClass("disabled")){$(traderObj.traderId+" .right_box .pay").addClass("disabled");var a={planets:{},honor:traderObj.honorOutput};for(planetId in traderObj.planets){a.planets[planetId]=traderObj.planets[planetId].output}$.ajax({url:importUrl,type:"POST",data:{action:"trade",bid:a,token:importToken,ajax:1},dataType:"json",success:function(b){importToken=b.newToken;fadeBox(b.message,b.error);if(!b.error){for(planetId in traderObj.planets){traderObj.planets[planetId].output={metal:0,crystal:0,deuterium:0}}$(traderObj.traderId+" .bargain_overlay").show();$(traderObj.traderId+" .payment").hide();$(traderObj.traderId+" .image_140px a").addClass("slideIn");traderObj.reloadResources();traderObj.updateImportItem(b.item);traderObj.refresh()}},error:function(){fadeBox(loca.error,true)}})}return false},reloadResources:function(a){getAjaxResourcebox(a)},changeImportItem:function(){if(!$(traderObj.traderId+" .import_bargain.change").hasClass("disabled")){$(traderObj.traderId+" .import_bargain.change").addClass("disabled");$.ajax({url:importUrl,type:"POST",data:{action:"bargain",token:importToken,ajax:1},dataType:"json",success:function(a){importToken=a.newToken;fadeBox(a.message,a.error);if(!a.error){traderObj.updateImportItem(a.item);traderObj.reloadResources(function(){if(a.item.offersLeft>0&&darkMatter>=importChangeCost){$(traderObj.traderId+" .import_bargain.change").removeClass("disabled")}else{$(traderObj.traderId+" .import_bargain.change").addClass("disabled")}});traderObj.refresh()}},error:function(){fadeBox(loca.error,true)}})}return false},updateImportItem:function(a){$(traderObj.traderId+" .got_item_text").html(a.itemText);$(traderObj.traderId+" .bargain_text").html(a.bargainText);$(traderObj.traderId+" .bargain_cost").html(a.bargainCostText);importChangeCost=a.bargainCost;$(traderObj.traderId+" .image_140px img").attr("src","/cdn/img/item-images/"+a.image+"-140x.png");removeTooltip($(traderObj.traderId+" .image_140px a"));$(traderObj.traderId+" .image_140px a").attr("ref",a.uuid).removeClass("tooltip").addClass("tooltipHTML").attr("title",a.tooltip);initTooltips($(traderObj.traderId+" .image_140px a"));$(traderObj.traderId+" .detail_button .amount").text(a.amount)},takeImportItem:function(){if(!$(traderObj.traderId+" .import_bargain.take").hasClass("disabled")){$(traderObj.traderId+" .import_bargain.change").addClass("disabled");$(traderObj.traderId+" .import_bargain.take").addClass("disabled");$(traderObj.traderId+" .import_bargain.change").addClass("hidden");$(traderObj.traderId+" .import_bargain.take").addClass("hidden");$(traderObj.traderId+" .bargain_cost").addClass("hidden");$.ajax({url:importUrl,type:"POST",data:{action:"takeItem",token:importToken,ajax:1},dataType:"json",success:function(a){importToken=a.newToken;fadeBox(a.message,a.error);if(!a.error){var b=a.item.ref;changeTooltip($(".detail_button[ref='"+b+"']"),a.item.title);$(".detail_button[ref='"+b+"'] span.amount, #itemDetails[data-uuid='"+b+"'] span.amount").html(tsdpkt(a.item.amount));if(a.item.canBeActivated){$('#itemDetails[data-uuid="'+b+'"] a.activateItem').removeClass("build-it_disabled").addClass("build-it")}else{$('#itemDetails[data-uuid="'+b+'"] a.activateItem').addClass("build-it_disabled").removeClass("build-it")}if(a.item.newOffer==false){$(traderObj.traderId+" .bargain_text").html(a.item.noOfferMessage)}else{traderObj.resetImport(a.item.newOffer)}}},error:function(){fadeBox(loca.error,true)}})}return false},resetImport:function(a){importChangeCost=a.bargainCost;if(darkMatter>=importChangeCost){$(traderObj.traderId+" .import_bargain.change").removeClass("disabled")}else{$(traderObj.traderId+" .import_bargain.change").addClass("disabled")}$(traderObj.traderId+" .import_bargain.take").removeClass("disabled");$(traderObj.traderId+" .import_bargain.change").removeClass("hidden");$(traderObj.traderId+" .import_bargain.take").removeClass("hidden");$(traderObj.traderId+" .bargain_cost").removeClass("hidden");$(traderObj.traderId+" .bargain_overlay").hide();$(traderObj.traderId+" .payment").show();$(traderObj.traderId+" .image_140px img").attr("src","/cdn/img/trader/container_"+a.rarity+".png");$(traderObj.traderId+" .image_140px a").removeClass("slideIn").attr("ref","").removeClass("tooltipHTML").addClass("tooltip").removeClass("r_common_140px").removeClass("r_uncommon_140px").removeClass("r_rare_140px").removeClass("r_epic_140px").removeClass("r_buddy_140px").addClass("r_"+a.rarity+"_140px");changeTooltip($(traderObj.traderId+" .image_140px a"),a.tooltip);$(traderObj.traderId+" .js_import_price").removeClass("green_text").text(number_format(a.price,0));$(traderObj.traderId+" .image_140px .amount").text("?");traderObj.priceImportExport=getValue($(".js_import_price").html());traderObj.resetValues(null,true);traderObj.init()},sumAuctioneer:function(){var k=traderObj.traderId;var a=traderObj.price;if(a==0){$("#div_traderAuctioneer .js_amount").attr("disabled","disabled")}else{$("#div_traderAuctioneer .js_amount").removeAttr("disabled")}var c=0;for(var b in traderObj.planets){var l=traderObj.planets[b].output;c+=parseInt(l.metal)*multiplier.metal+parseInt(l.crystal)*multiplier.crystal+parseInt(l.deuterium)*multiplier.deuterium}c+=parseInt(traderObj.honorOutput)*multiplier.honor;c=Math.floor(c);traderObj.deficit=(Number(auctioneer.calculateDeficit())-Number(c));if(traderObj.deficit>0){$(" .js_deficit").html(number_format(traderObj.deficit,0))}else{$(" .js_deficit").html(number_format(0,0))}if(c>0){$("#div_traderAuctioneer .js_auctioneerSum").html("+ "+number_format(c,0))}else{$("#div_traderAuctioneer .js_auctioneerSum").html("")}$("#div_traderAuctioneer .js_alreadyBidden").html(number_format(Math.floor(playerBid+c),0));if(a>0&&traderObj.deficit<=0){$("#div_traderAuctioneer .right_box .pay").removeClass("disabled")}else{$("#div_traderAuctioneer .right_box .pay").addClass("disabled")}},sumImportExport:function(){var q=traderObj.traderId;var p=0;var a=0;var b=0;traderObj.sumResources=0;for(var c in traderObj.planets){var u=traderObj.planets[c].output;p+=parseInt(u.metal)*multiplier.metal;a+=parseInt(u.crystal)*multiplier.crystal;b+=parseInt(u.deuterium)*multiplier.deuterium}var w=traderObj.honorOutput*multiplier.honor;traderObj.sumResources+=p+a+b+w;if(traderObj.sumResources>=traderObj.priceImportExport){traderObj.sumResources=traderObj.priceImportExport}$(q+" .js_sum_price").html(number_format(Math.floor(traderObj.sumResources),0));if(traderObj.sumResources>=traderObj.priceImportExport){$(q+" .js_import_price").addClass("green_text");$(q+" .right_box .pay").removeClass("disabled")}else{$(q+" .js_import_price").removeClass("green_text");$(q+" .right_box .pay").addClass("disabled")}},updateValues:function(C){var b=traderObj.traderId;if(b!=="#"+C.closest(".div_trader").attr("id")){return}var x=C.attr("class");var D=new RegExp(/\b(js_slider\w*)\b/);x=(D.test(x))?RegExp.$1:false;if(!x){return}var y=traderObj.current.planet;var c,a,B;if(x.indexOf("More")!=-1){B=x.replace("More","");c="More"}else{if(x.indexOf("Max")!=-1){B=x.replace("Max","");c="Max"}}traderObj.current.resource=B.replace("js_slider","").toLowerCase()||null;var A=traderObj.current.resource;var w=0;if(A=="honor"){w=Math.max(0,honorScore)}else{w=traderObj.planets[y].input[A]}a=getValue($(b+" ."+B+"Input").val());if(c=="More"){if(b=="#div_traderImportExport"){if(traderObj.sumResources<=traderObj.priceImportExport-1000*multiplier[A]){a+=1000}else{if(traderObj.sumResources<traderObj.priceImportExport){a+=(traderObj.priceImportExport-traderObj.sumResources)/multiplier[A]}}}else{if(b=="#div_traderAuctioneer"&&traderObj.price>0){a+=1000}}if(a>=w){a=Math.max(0,w)}}else{if(c=="Max"){if(b=="#div_traderImportExport"){if(traderObj.sumResources==0){a=Math.min(w,Math.ceil(traderObj.priceImportExport/multiplier[A]))}else{if(traderObj.sumResources.isBetween(0,traderObj.priceImportExport-1)){a=Math.min(w,a+Math.ceil((traderObj.priceImportExport-traderObj.sumResources)/multiplier[A]));a=Math.max(0,a)}}}else{if(b=="#div_traderAuctioneer"&&traderObj.price>0){a=Math.min(w,Math.ceil(getValue($(b+" .js_deficit").html())/multiplier[A]+a))}}if(A=="honor"&&a<0){a=0}}}$(b+" .js_amount."+B+"Input").val(number_format(a,0));if(A=="honor"){traderObj.honorOutput=a}else{traderObj.planets[y].output[A]=a}if(b=="#div_traderImportExport"){traderObj.sumImportExport()}else{if(b=="#div_traderAuctioneer"&&traderObj.price>0){traderObj.sumAuctioneer();traderObj.checkOverbidden()}}},updateValuesInputCanged:function(E){var H=traderObj.traderId;if(H!=="#"+E.closest(".div_trader").attr("id")){return}var y=E.attr("class");var F=new RegExp(/\b(js_slider\w*)\b/);y=(F.test(y))?RegExp.$1:false;if(!y){return}var D=y.replace("Input","");var B=D.replace("js_slider","").toLowerCase();var A=traderObj.current.planet;var c=0;if(B=="honor"){c=Math.max(0,honorScore)}else{c=parseInt(traderObj.planets[A].input[B])}var G=0;if(H=="#div_traderImportExport"){var b=0;for(var a in traderObj.planets){var C=traderObj.planets[a].output;if(B!="metal"){b+=Math.floor(parseInt(C.metal)*multiplier.metal)}if(B!="crystal"){b+=Math.floor(parseInt(C.crystal)*multiplier.crystal)}if(B!="deuterium"){b+=Math.floor(parseInt(C.deuterium)*multiplier.deuterium)}}G=Math.min(getValue(E.val()),Math.ceil((traderObj.priceImportExport-b)/multiplier[B]))}else{if(H=="#div_traderAuctioneer"){G=getValue(E.val())}}G=Math.min(G,c);traderObj.planets[A].output[B]=G;if(B=="honor"){traderObj.honorOutput=G}else{traderObj.planets[A].output[B]=G}if(H=="#div_traderImportExport"){traderObj.sumImportExport()}else{if(H=="#div_traderAuctioneer"){traderObj.sumAuctioneer();traderObj.checkOverbidden()}}formatNumber(H+" .js_amount."+D+"Input",G)},init:function(){$(".honorResource").hide();$("#menuTable a.trader").unbind("click.gotoTrader").bind("click.gotoTrader",function(a){a.preventDefault();traderObj.switchTrader("traderResources")});$(window).unbind("hashchange.switchTrader").bind("hashchange.switchTrader",function(a){var b=$.deparam.fragment(a.fragment);if(typeof(b.page)=="undefined"||b.page==""&&traderObj.traderId!=null){traderObj.returnToOverview()}else{traderObj.switchTrader(b.page)}});$(".small_back_to_overview").unbind("mouseenter").unbind("mouseout").bind("mouseenter",function(){$("#header_text").css("background-position","0 -250px")}).bind("mouseout",function(){$("#header_text").css("background-position","0 0")})},initSliderTrader:function(a){$(a+" .js_valButton").unbind("click.valControl");$(a+" .js_amount").unbind("keyup.inputVal");f.init(a);$(a+" .js_valButton").bind("click.valControl",function(b){traderObj.updateValues($(this));b.stopPropagation()});$(a+" .js_amount").bind("keyup.inputVal",function(b){traderObj.updateValuesInputCanged($(this));b.stopPropagation()})},initImportExport:function(){traderObj.planets=planetResources;traderObj.priceImportExport=getValue($(".js_import_price").html());traderObj.initSliderTrader("#div_traderImportExport");$("#div_traderImportExport .right_box .pay").bind("click",function(){traderObj.submitImportExport()});$("#div_traderImportExport .import_bargain.change").bind("click",function(){traderObj.changeImportItem()});$("#div_traderImportExport .import_bargain.take").bind("click",function(){traderObj.takeImportItem()})},switchTrader:function(a){Tipped.hideAll();$("#planet .close_details:visible").click();if(traderObj.switchingTrader){return}if("#div_"+a==traderObj.traderId){return}traderObj.switchingTrader=true;if(traderObj.traderId!=null||a==""||a==null){traderObj.returnToOverview();if(animation&&!d){setTimeout(function(){traderObj.selectTrader(a)},500)}else{traderObj.selectTrader(a)}}else{traderObj.selectTrader(a)}},returnToOverview:function(){Tipped.hideAll();$("#planet #header_text h2").empty().parent().hide();$("#traderOverview").find(".c-left, .c-right").hide();var a=traderObj.traderId;if(!a){return}$(a).hide();$("#callTrader").hide();if(animation&&!d){$("#planet h2").hide();$("#planet").animate({backgroundPosition:"-273px 0px",height:"470px"},500,function(){$("#planet h2").show();$("#planet").removeClass("detail");$("#traderOverview").find(".c-left, .c-right").show();$(".js_trader").show()})}else{$("#planet").removeClass("detail").css("background-position","-273px 0px").css("height","470px");$(".js_trader").show()}$("#planet a").show();$("#planet .back_to_overview").hide();removeTooltip($("#planet .back_to_overview"));$("#traderOverview").find(".c-left, .c-right").removeClass("c-small");traderObj.traderId=null}};breakerObj={costs:null,offer:null,ships:{},locked:false,lastTechId:null,initialize:function(){this.offer=parseInt($(".scrap_offer_amount").html());this.costs=breakerCosts;var a=this;$("#js_anythingSliderShips, #js_anythingSliderDefense").anythingSlider({startStopped:true,buildStartStop:false,expand:true,resizeContents:false,theme:"default",infiniteSlides:false,autoPlay:false,easing:"swing",resizeContents:true,stopAtEnd:true,playRtl:isRTLEnabled,buildNavigation:false,onInitialized:function(c,C){if(isMobile){var B=1000,x=50,b=0,F=0,A="ontouchend" in document,E=(A)?"touchstart":"mousedown",G=(A)?"touchmove":"mousemove",D=(A)?"touchend":"mouseup";C.$window.bind(E,function(g){F=(new Date()).getTime();b=g.originalEvent.touches?g.originalEvent.touches[0].pageX:g.pageX}).bind(D,function(g){F=0;b=0}).bind(G,function(l){l.preventDefault();var k=l.originalEvent.touches?l.originalEvent.touches[0].pageX:l.pageX,j=(b===0)?0:Math.abs(k-b),g=(new Date()).getTime();if(F!==0&&g-F<B&&j>x){if(k<b){C.goForward()}if(k>b){C.goBack()}F=0;b=0}})}}});$("#js_anythingSliderDefense").parent().parent().hide();$(".scrap_defense").bind("click.tabDefense",function(){$(".scrap_ships").removeClass("selected");$(this).addClass("selected");$("#js_anythingSliderShips").parent().parent().hide();$("#js_anythingSliderDefense").parent().parent().show()});$(".scrap_ships").bind("click.tabShips",function(){$(".scrap_defense").removeClass("selected");$(this).addClass("selected");$("#js_anythingSliderDefense").parent().parent().hide();$("#js_anythingSliderShips").parent().parent().show()});$(".buildingimg a").each(function(){var j=$(this).attr("ref").substr(6,3);var b=$(this).find(".level");var c=b.contents().filter(function(){return this.nodeType==3});a.ships[j]=c.text().replace(/^\s+|\s+$/g,"");c.remove();b.append(tsdpkt(a.ships[j]))});$("#js_scrapBargain").unbind("click").bind("click",function(){if(!$(this).hasClass("disabled")){a.bargain(a)}return false});$("#js_scrapScrapIT").unbind("click").bind("click",function(){if(!$(this).hasClass("disabled")){a.trade(a)}return false});$("input.ship_amount").unbind("focus").bind("focus",function(){a.lastTechId=$(this).attr("name").substr(2,3);$(this).val("")});$("input.ship_amount").unbind("keyup change").bind("keyup change",function(c){a.lastTechId=$(this).attr("name").substr(2,3);formatNumber(this,$(this).val());var b=$(this);clearTimeout(b.data("timer"));b.data("timer",setTimeout(function(){b.removeData("timer");a.updateResources(a)},300))});$(".buildingimg a").unbind("click").bind("click",function(){return false});$(".js_maxShips").unbind("click").bind("click",function(){if(!isMobile){$($(this).attr("ref")).focus()}var b=a.ships[$(this).attr("ref").substr(6,3)];$($(this).attr("ref")).val(tsdpkt(b)).trigger("change");a.updateResources(a);return false});$(".sendAll").unbind("click").bind("click",function(){$(".anythingSlider ul:visible input").each(function(){a.lastTechId=$(this).attr("name").substr(2,3);var b=a.ships[a.lastTechId];$(this).val(tsdpkt(b))});a.updateResources(a,function(b){if(b.error){$(".anythingSlider ul:visible input").val("");$("#div_traderScrap .resource_amount").text(0);a.checkShips(a)}})});$(".sendNone").unbind("click").bind("click",function(){$(".anythingSlider ul:visible input").each(function(){a.lastTechId=$(this).attr("name").substr(2,3);$(this).val("")});a.updateResources(a)});$("#js_bargainCost").text(tsdpkt(this.costs));this.checkMoney(this);this.checkShips(this);this.updateBargain(this)},bargain:function(a){$("#js_scrapBargain").addClass("disabled");$.ajax({url:breakerCallLink,type:"POST",dataType:"json",data:{bargain:1,token:breakerToken},beforeSend:function(){a.lock(a)},success:function(b){a.unlock(a);breakerToken=b.newToken;fadeBox(b.message,b.error);if(!b.error){a.costs=b.bargainPrice;a.offer=b.percentage;darkMatter=b.resources.dm;a.updateBargain(a);a.updateResources(a);traderObj.reloadResources(function(){a.checkMoney(a);Tipped.show($("#js_scrapBargain")[0])})}$(".scrap_trader_quote").text(b.quote)},error:function(){a.unlock(a)}})},trade:function(a){a.lock(a);var b=a.getTradeArray();var c=function c(){var k=loca.breakerQuestion+'<br/><br/><div style="text-align: left; margin-left: 30px">';var l=0;$.each(b,function(g){k+=this+"x "+loca.shipNames[g]+", ";l++;if(l%2==0){k+="<br/>"}});k=k.replace(/, (<br\/>)?$/,"");k+="</div>";return k};errorBoxDecision(loca.breaker,c(),LocalizationStrings.yes,LocalizationStrings.no,function(){$.ajax({url:breakerCallLink,type:"POST",dataType:"json",data:{lastTechId:a.lastTechId,finishTrade:1,trade:b,token:breakerToken},success:function(j){a.unlock(a);breakerToken=j.newToken;if(j.error){fadeBox(j.message,true)}else{fadeBox(j.message,false);a.offer=j.percentage;a.costs=j.bargainPrice;a.resetForm();a.updateBargain(a);$("#js_scrapAmountMetal").html(0);$("#js_scrapAmountCrystal").html(0);$("#js_scrapAmountDeuterium").html(0);traderObj.reloadResources(function(){a.updateShips(a)})}$(".scrap_trader_quote").text(j.quote)},error:function(){a.unlock(a);fadeBox(loca.error,true)}})},function(){a.unlock(a)},true,310)},updateResources:function(b,a){if(b.locked){return}$.ajax({url:breakerCallLink,type:"POST",dataType:"json",data:{lastTechId:b.lastTechId,trade:b.getTradeArray(),token:breakerToken},beforeSend:function(){b.lock(b)},success:function(c){breakerToken=c.newToken;if(c.error){fadeBox(c.message,true)}b.locked=false;var k=false;for(var l in c.techAmount){$("#ship_"+l).val(tsdpkt(c.techAmount[l]));if(!k&&$("#ship_"+l).val()!=b.ships[l]){k=true}}$("#js_scrapAmountMetal").html(tsdpkt(c.resources.metal));$("#js_scrapAmountCrystal").html(tsdpkt(c.resources.crystal));$("#js_scrapAmountDeuterium").html(tsdpkt(c.resources.deuterium));if(!b.notFirstOffer){$(".scrap_trader_quote").text(loca.breakerFirstOffer);b.notFirstOffer=true}if(k){b.updateShips(b)}else{b.unlock(b)}if(typeof(a)=="function"){a(c)}},error:function(){b.unlock(b)}})},updateShips:function(a){$.ajax({url:techUrl,type:"POST",dataType:"json",beforeSend:function(){a.lock(a)},success:function(b){$("#div_traderScrap .item").each(function(){var q=$(this).attr("id").substr(6,3);if(typeof(b[q])!="undefined"){var p=getValue(b[q]);a.ships[q]=p;var c=$(this).find(".level");c.contents().filter(function(){return this.nodeType==3}).remove();c.append(tsdpkt(p));var l=$("#button"+q);l.removeClass("on").removeClass("off");if(p>0){l.addClass("on")}else{l.addClass("off")}}});a.unlock(a)},error:function(){a.unlock(a)}})},getTradeArray:function(){var a={};$("input.ship_amount").each(function(){var b=$(this).attr("name").substr(2,3);if(getValue($(this).val())!=0){a[b]=getValue($(this).val())}});return a},resetForm:function(){$("input.ship_amount").each(function(){$(this).val("0")});removeTooltip($("#js_scrapBargain"));$("#js_scrapBargain").removeClass("tooltip").removeAttr("title")},checkMoney:function(a){if(darkMatter<a.costs){$("#js_scrapBargain").addClass("disabled")}else{if(breakerMaximumPercent<=a.offer){$("#js_scrapBargain").addClass("disabled").addClass("tooltip").attr("title",loca.infoMaxBargain);initTooltips($("#js_scrapBargain"))}else{$("#js_scrapBargain").removeClass("disabled")}}},checkShips:function(a){var b=false;$("input.ship_amount").each(function(){if($(this).val().length>0&&getValue($(this).val())>0){b=true}});if(!b){$("#js_scrapScrapIT").addClass("disabled")}else{$("#js_scrapScrapIT").removeClass("disabled")}},updateBargain:function(a){$(".scrap_offer_amount").css("height",a.offer/100*$(".scrap_offer_amount").parent().css("height").replace("px",""));$(".scrap_offer_amount").html(a.offer+"%");$(".js_bargainCost").text(tsdpkt(a.costs))},lock:function(a){$("#js_scrapBargain").addClass("disabled");$("#js_scrapScrapIT").addClass("disabled");a.locked=true},unlock:function(a){a.locked=false;a.checkShips(a);a.checkMoney(a)}};auctioneer={socket:null,connected:false,timeout:null,retryInterval:5000,historyShown:false,initConnection:function(){try{var a=auctioneer;this.socket=new io.connect("/auctioneer",{port:auctioneerPort});this.socket.on("connect",function(){a.connected=true;clearTimeout(this.timeout)});this.socket.on("disconnect",function(){a.connected=false;a.retryConnection()});this.socket.on("new auction",function(c){auctionId=c.auctionId;var q=$("#div_traderAuctioneer .detail_value.currentPlayer").html();if(c.oldAuction.player==null){q=loca.auctionNotSold}else{q='<a href="'+c.oldAuction.player.link+'">'+c.oldAuction.player.name+"</a>"}removeTooltip($("#div_traderAuctioneer .image_140px .detail_button"));var y=$("#div_traderAuctioneer .image_140px .detail_button").attr("title");var u=$(".auction_history li:first").hasClass("even")?"odd":"even";var w='                        <li class="'+u+'" style="display: none">                            <a href="javascript:void(0);"                               class="slideIn"                               ref="'+c.oldAuction.item.uuid+'">                                <img height="30" width="30"                                     src="/cdn/img/item-images/'+c.oldAuction.item.imageSmall+'-small.png"                                     alt="" title="'+y+'"                                     class="item_img tooltipHTML tooltipLeft r_'+c.oldAuction.item.rarity+'"/>                            </a>                            <span class="detail sum">'+number_format(c.oldAuction.sum,0)+'</span>                            <span class="detail player">'+q+'</span>                            <span class="detail date_time">'+c.oldAuction.time+"</span>                        </li>";$(".auction_history .history_content ul").prepend(w);$(".auction_history .history_content li:first").slideDown("slow");var x=$("#div_traderAuctioneer .auction_history li").length;if(x>3){$(".auction_history .history_content li:last").slideUp("slow",function(){$(".auction_history .history_content li:eq(21)").remove();var g=$(".auction_history .history_content li:eq(3)");g.addClass("more_auctions_li");if(auctioneer.historyShown){g.show()}});$("#div_traderAuctioneer .auction_history .more").show()}$("#div_traderAuctioneer .image_140px .detail_button").attr("ref",c.item.uuid).attr("title","").removeClass("r_common_140px").removeClass("r_uncommon_140px").removeClass("r_rare_140px").removeClass("r_epic_140px").addClass("r_"+c.item.rarity+"_140px");$("#div_traderAuctioneer .image_140px img").attr("src","/cdn/img/item-images/"+c.item.image+"-140x.png");$("#div_traderAuctioneer .left_header h2").html(loca.auctionRunning);a.setItemTooltip($("#div_traderAuctioneer .image_140px .detail_button"));a.setData({price:1000,sum:0,player:null,bids:0,info:c.info});$("#div_traderAuctioneer .js_alreadyBidden").html(number_format(0,0));$(".noAuctionOverlay").hide();traderObj.resetValues("#div_traderAuctioneer",false);traderObj.checkOverbidden()});this.socket.on("new bid",function(c){if(c.player.id==playerId){playerBid=c.sum;AuctionIdOflastPlayerBid=c.auctionId;$("#div_traderAuctioneer .js_alreadyBidden").html(number_format(Math.floor(playerBid),0))}a.setData({price:c.price,sum:c.sum,player:c.player,bids:c.bids});traderObj.checkOverbidden()});this.socket.on("auction finished",function(c){a.setData({price:0,player:c.player,bids:c.bids,info:c.info});traderObj.resetValues("#div_traderAuctioneer",false);$("#div_traderAuctioneer .js_alreadyBidden").html(number_format(0,0));$("#div_traderAuctioneer .js_auctioneerSum").html("");$("#div_traderAuctioneer .left_header h2").html(loca.auctionFinished);if(c.player!=null){if(c.player.id==playerId){a.setItemTooltip($("#div_traderAuctioneer .image_140px .detail_button"))}}$(".noAuctionOverlay").show();traderObj.checkOverbidden()});this.socket.on("timeLeft",function(c){a.setData({info:c})})}catch(b){}},setItemTooltip:function(a){$.ajax({url:detailUrl,data:{getDetails:1,type:$(a).attr("ref"),ajax:1},dataType:"json",success:function(b){changeTooltip(a,b.title);$("#itemDetails[data-uuid='"+$(a).attr("ref")+"'] .amount").html(tsdpkt(b.amount))},error:function(){fadeBox(loca.error,true)}})},initialize:function(){traderObj.initSliderTrader("#div_traderAuctioneer");traderObj.planets=planetResources;traderObj.price=getValue($(".js_price").html());$("#div_traderAuctioneer .right_box .pay").bind("click",function(){traderObj.submitAuction()});$("#div_traderAuctioneer .auction_history .more").bind("click",function(){if(auctioneer.historyShown){$(this).text("["+loca.auctionShowMore+"]")}else{$(this).text("["+loca.auctionShowLess+"]")}auctioneer.historyShown=!auctioneer.historyShown;$("#div_traderAuctioneer .auction_history .more_auctions_li").slideToggle("slow")});traderObj.sumAuctioneer();traderObj.checkOverbidden();this.initCountdown();loadScript(scriptUrl,this.initConnection)},retryConnection:function(){var a=this;setTimeout(function(){a.initConnection()},5000)},setData:function(a){var b=false;if(typeof(a.player)!="undefined"){if(a.player==null){$("#div_traderAuctioneer .detail_value.currentPlayer").text("");$("#div_traderAuctioneer .detail_value.currentPlayer").attr("href","")}else{$("#div_traderAuctioneer .detail_value.currentPlayer").text(a.player.name);$("#div_traderAuctioneer .detail_value.currentPlayer").attr("href",a.player.link)}b=true}if(typeof(a.price)!=="undefined"){traderObj.price=a.price;$("#div_traderAuctioneer .js_price").html(number_format(Math.floor(a.price),0));b=true}if(typeof(a.sum)!=="undefined"){$("#div_traderAuctioneer .detail_value.currentSum").html(number_format(Math.floor(a.sum),0));b=true}if(typeof(a.bids)!=="undefined"){$("#div_traderAuctioneer .detail_value.numberOfBids").html(number_format(a.bids,0));b=true}if(typeof(a.info)!=="undefined"&&$.trim($("#div_traderAuctioneer .auction_info").html())!=a.info){$("#div_traderAuctioneer .auction_info").html(a.info);this.initCountdown();b=true}if(b){this.flash();traderObj.sumAuctioneer()}},initCountdown:function(){if(typeof(this.nextAuctionTimer)=="object"){timerHandler.removeCallback(this.nextAuctionTimer.timer)}if($(".nextAuction").length>0){this.nextAuctionTimer=new simpleCountdown($(".nextAuction").get(0),$(".nextAuction").text())}},flash:function(){if(traderObj.traderId=="#div_traderAuctioneer"){$("#div_traderAuctioneer .overlay").fadeIn("normal",function(){$(this).fadeOut("normal")})}},calculateDeficit:function(){var a=0;if(Math.floor(traderObj.price)==0){a=0}else{if(auctionId!=AuctionIdOflastPlayerBid){a=Math.floor(traderObj.price)}else{a=Math.floor(traderObj.price)-Math.floor(playerBid)}}return Math.floor(a)}};$(".js_trader").hover(function(){var a=$(this).attr("id").replace("js_trader","").toLowerCase();$(this).addClass(a+"_link_hover")},function(){var a=$(this).attr("id").replace("js_trader","").toLowerCase();$(".trader_link").each(function(c,b){$(this).removeClass(a+"_link_hover")})});$(".right_box .pay, .value-control, .ui-slider-handle, .bargain, .scrap_it, .source").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});traderObj.init();$(document).undelegate(".js_trader","click").delegate(".js_trader","click",function(){var a=$(this).attr("id").replace("js_","");traderObj.switchTrader(a)}).undelegate("#planet .js_backToOverview","click").delegate("#planet .js_backToOverview","click",function(){$.bbq.pushState({page:"",animation:""});$(".planetlink, .moonlink").fragment({page:"",animation:""})});var e=$.deparam.fragment();if(typeof(e.page)!="undefined"&&e.page!=""){traderObj.selectTrader(e.page)}}function calcCosts(c,d){return Math.floor(d*factor[offer_id]/factor[c])}function calcInputFromCosts(c,d){return Math.max(Math.round(d/factor[offer_id]*factor[c]),0)}function setValue(c,d){if(offer_id==c){$("#"+c+"_value_label").html(number_format(d,0,loca.decimalPoint,loca.thousandsSeparator))}else{formatNumber("#"+c+"_value",d)}}function checkValue(b){setValue(b,Math.min(getValue($("#"+b+"_value").val()),Math.round(storage[b])));free_id=6-b-offer_id;offer_costs=calcCosts(free_id,getValue($("#"+free_id+"_value").val()));costs=calcCosts(b,getValue($("#"+b+"_value").val()));freeOfferCosts=Math.round(offer_amount-(offer_costs));if(costs>freeOfferCosts){setValue(b,calcInputFromCosts(b,freeOfferCosts));costs=calcCosts(b,getValue($("#"+b+"_value").val()))}offer_costs=offer_costs+costs;setValue(offer_id,offer_costs);document.getElementById(b+"_storage").innerHTML=number_format((storage[b]-getValue($("#"+b+"_value").val())),0,loca.decimalPoint,loca.thousandsSeparator)}function setMaxValue(b){setValue(b,storage[b]);checkValue(b)}function callTrader(c){if(darkMatter<traderCosts){errorBoxDecision(LocalizationStrings.error,loca.errorNotEnoughDM,LocalizationStrings.yes,LocalizationStrings.no,redirectPremium);return}for(var d=1;d<4;d++){$("#imageRes_"+d).removeClass("active")}$.post(traderCallLink,{offer_id:c,token:traderResourcesToken},function(a){a=$.parseJSON(a);traderResourcesToken=a.newToken;if(a.status=="1"){$("#imageRes_"+c).addClass("active");traderObj.reloadResources();$("#callTrader").addClass("traderActive").show();openOverlay(traderOverlayLink,{"class":"traderlayer"})}else{errorBoxAsArray(a.errorbox)}})}function tradeDone(c){c=$.parseJSON(c);traderResourcesToken=c.newToken;if(c.status=="1"){$(".overlayDiv.traderlayer").dialog("close");for(var d=1;d<4;d++){$("#imageRes_"+d).removeClass("active")}traderObj.reloadResources();$("#callTrader").removeClass("traderActive").hide()}errorBoxAsArray(c.errorbox)};