# Развитие идеи выстрела

```
У меня есть боевой движок для браузерной игры OGame написан на C. Там есть процедура для выстрела юнита. Я бы хотел как-то развить идею выстрелов и сделать что-то типа разных абилок для юнитов. Вот исходник:

// Shot a => b. Returns damage.
// absorbed - the accumulator of damage absorbed by shields (for the one who is attacked, i.e. for unit "b").
long UnitShoot (Unit *a, Slot* aslot, Unit *b, Slot* bslot, uint64_t *absorbed )
{
    float prc, depleted;
    long apower, adelta = 0, b_shieldmax, b_hullmax;
    apower = get_apower(a->obj_type, &aslot[a->slot_id]);

    if (b->exploded) return apower; // Already blown up.
    if (b->shield == 0) {  // No shields.
        if (apower >= b->hull) b->hull = 0;
        else b->hull -= apower;
    }
    else { // We take away from shields, and if there is enough damage, from armor as well.

        b_shieldmax = get_shieldmax(b->obj_type, &bslot[b->slot_id]);

        prc = (float)b_shieldmax * 0.01f;
        depleted = (float)floor ((float)apower / prc);
        if (b->shield < (depleted * prc)) {
            *absorbed += (uint64_t)b->shield;
            adelta = apower - b->shield;
            if (adelta >= b->hull) b->hull = 0;
            else b->hull -= adelta;
            b->shield = 0;
        }
        else {
            b->shield -= depleted * prc;
            *absorbed += (uint64_t)apower;
        }
    }

    b_hullmax = get_hullmax(b->obj_type, &bslot[b->slot_id]);

    if (b->hull <= b_hullmax * 0.7 && b->shield == 0) {    // Blow it up.
        if (MyRand (0, 99) >= ((b->hull * 100) / b_hullmax) || b->hull == 0) {
            b->exploded = 1;
        }
    }
    return apower;
}

Предложи кроме стандартного выстрела ещё 15 различных абилок, которые можно назначить каким-то кораблям участвующим в битве. Назначение абилок будет делаться табличным образом ID = абилка1 абилка2.
```

Отличная идея развить боевую систему! Вот 15 концепций специальных атак/способностей для юнитов, вдохновленные OGame и другими стратегиями. Они сгруппированы по категориям для логики внедрения. Большинство требуют передачи в функцию дополнительных параметров, таких как массив всех слотов (Slots* fleet[]) или индекс стреляющего юнита.

Категория 1: Модификации урона и щитов

Ионный выстрел (Ion Cannon): Не наносит урона корпусу, но наносит двойной/тройной урон щитам цели. Отлично против кораблей с мощными щитами.

Пробивающий снаряд (Armor Piercer): Игнорирует определенный процент щитов цели (например, 50%). Часть урона сразу попадает в корпус.

Самоуничтожение (Kamikaze): Юнит наносит огромный урон при атаке, но сразу уничтожается после выстрела (взрывается). Возвращает урон, равный, например, остатку своего корпуса + щитов.

Заградительный огонь (Barrage): Атака наносит уменьшенный урон не только основной цели, но и случайному дополнительному юниту в том же слоте противника (или в соседнем).

Оглушающий удар (EMP Blast): Шанс (например, 30%) "оглушить" цель на 1 раунд. Оглушенный юнит пропускает свою следующую атаку. Требуется добавить флаг stunned в структуру Unit.

Дробящий удар (Hull Crusher): Наносит увеличенный урон, если у цели щиты опустились ниже определенного порога (например, 20%). Мотивирует сначала "сбить щиты".

Категория 2: Влияние на себя и союзников
7. Боевое прикрытие (Guardian): Выстрел производится не по врагу, а по своему же флоту. Восстанавливает часть щитов выбранному союзному юниту. Может быть не "выстрелом", а способностью с таймером.
8. Выброс энергии (Energy Drain): При успешной атаке стреляющий восстанавливает часть своего щита (например, 10% от нанесенного урона).
9. Таран (Ramming Speed): Урон от атаки зависит не от вооружения, а от текущей скорости юнита. Чем выше скорость (можно хранить как параметр в Slot), тем выше урон. После атаки скорость сбрасывается до базовой.
10. Цепная молния (Chain Lightning): После выстрела по основной цели, часть урона (например, 50%) перескакивает на случайного другого юнита противника в том же ряду. Может перескакивать несколько раз с ослаблением.

Категория 3: Стратегические и глобальные эффекты
11. Приоритетная цель (Target Lock): Этот юнит всегда атакует определенный тип корабля первым (например, только истребители или только линкоры), игнорируя стандартный порядок боя. Требуется передавать в функцию информацию о типе цели.
12. Помехи наводки (Jamming): При атаке есть шанс (например, 25%) снизить точность следующего выстрела ВСЕХ вражеских юнитов определенного типа по этому слоту (увеличить их шанс промаха). Требуется система модификаторов для флота.
13. Точечный удар (Precision Strike): Этот юнит имеет увеличенный шанс нанести критический удар (увеличить базовый шанс взрыва с 30% от корпуса до, например, 50%). Модификация последней части вашей функции.
14. Бронебойный снаряд (Shredder): Урон от этой атаки снижает максимальную прочность корпуса (b_hullmax) цели на этот бой на небольшой процент (накопимый эффект). Нужна временная переменная в Unit или Slot.
15. Гравитационная бомба (Gravity Bomb): Не наносит прямого урона, но с вероятностью притягивает легкие вражеские корабли (тип "истребитель") на переднюю линию, меняя их slot_id, где они могут быть атакованы первыми.

Рекомендации по реализации:

Расширьте структуры: Добавьте в Unit или, лучше, в Slot поле для ID способности (ability_id) и, возможно, кулдауна (cooldown).

Модифицируйте вызов: Идеально создать функцию-диспетчер, например UnitUseAbility(), которая будет вызываться вместо UnitShoot() для юнитов со способностями. Она будет читать ability_id и вызывать соответствующую специализированную функцию (IonShot(), KamikazeAttack() и т.д.).

Передавайте контекст: Этим новым функциям потребуется больше данных: указатель на весь массив флотов, количество слотов, индекс атакующего юнита и его слота, текущий раунд боя.

Таблица назначений: Создайте внешний массив/файл конфигурации, где unit_type_id будет сопоставлен с одним или двумя ability_id. Это и будет ваша "таблица назначений".

Баланс: Почти все способности требуют тонкой настройки чисел (проценты, шансы, множители) для баланса.

Пример псевдокода для Ионного выстрела:

```c
long IonShot(Unit *a, Slot* aslot, Unit *b, Slot* bslot, uint64_t *absorbed) {
    long apower = get_apower(a->obj_type, &aslot[a->slot_id]);
    apower = apower * 3; // Утраиваем урон по щитам

    if (b->exploded) return apower;
    // Стандартная логика работы со щитами из вашей функции, но урон увеличен.
    // При этом ЛЮБОЙ избыток урона после снятия щитов НЕ переходит на корпус.
    // Можно просто обнулить `adelta` после блока со щитами.
    ...
    // После расчета урона по щитам:
    adelta = 0; // Ионный урон не бьет по корпусу
    ...
    return apower;
}
```
Эти идеи должны дать богатую почву для создания уникальных тактик и меты в вашей игре

```
предложи ещё 16 способностей
```

Отлично, вот ещё 16 уникальных способностей, расширяющих тактические возможности боя:

Категория 4: Контроль над полем боя и позиционированием
16. Телепорт (Blink): Юнит может мгновенно переместиться в другой свободный слот своего флота (вперед для атаки или назад для защиты). Способность используется вместо атаки. Требуется проверка на свободные слоты.
17. Гравитационный якорь (Gravity Anchor): Цель не может менять свой слот или использовать способности телепорта до конца боя. Добавляет дебафф в структуру Unit.
18. Рассеивание щитов (Shield Disruptor): На 1-2 раунда снижает эффективность щитов цели (например, они поглощают на 30% меньше урона). Нужен временный модификатор в Slot.
19. Тактическое отступление (Tactical Withdrawal): При атаке есть шанс (20%) отодвинуть цель на один слот назад (если есть место), нарушая строй противника.

Категория 5: Снайперские и точечные способности
20. Прицельный выстрел по системам (Targeting Override): Атака всегда наносит критический удар (проверка на взрыв), если у цели осталось меньше 40% корпуса. Игнорирует стандартный расчет вероятности.
21. Выстрел по двигателям (Engine Crippler): Успешная атака снижает скорость цели на 50% на этот бой. Каждая следующая атака может снизить скорость до минимума. Влияет на способности, зависящие от скорости.
22. Снайпер (Deadeye): Этот юнит атакует последним в раунде, но его выстрел игнорирует щиты цели на 100%. Идеально для добивания.
23. Метка смерти (Death Mark): Помечает цель. Все последующие атаки по помеченной цели от любых юнитов наносят на 15% больше урона. Действует 2 раунда.

Категория 6: Стихийные и периодические эффекты
24. Плазменное возгорание (Plasma Burn): Наносит неполный урон сразу, но накладывает на цель "горение" на 3 раунда. В начале каждого раунда цель теряет фиксированный процент от максимального корпуса. Эффекты горения складываются.
25. Криогенная заморозка (Cryo Blast): Замораживает цель. Замороженный юнит получает на 40% больше урона от следующей по нему атаки, но после этой атаки эффект снимается.
26. Радиоактивное заражение (Radiation Leak): При уничтожении цели этот юнит создает вокруг нее "радиоактивную зону". Юниты, которые займут этот слот в следующих раундах (после перестроения), получают небольшой периодический урон.
27. Вихрь энергии (Energy Vortex): Создает вихрь в слоте противника. Каждый раунд случайный юнит в этом слоте (включая возможных новых) теряет 10% своих щитов.

Категория 7: Поддержка и синергия флота
28. Боевой клич (Battle Cry): При атаке этот юнит увеличивает урон всех союзных юнитов в соседних слотах (справа и слева) на 10% на следующий раунд.
29. Поле ремонта (Nanite Repair Field): Вместо атаки восстанавливает небольшой процент корпуса всем союзным юнитам в своем ряду (кроме себя). Не работает, если юнит под огнем (был атакован в этом раунде).
30. Тактический сканер (Tactical Scanner): Раскрывает информацию о флоте противника в этом слоте: точные значения оставшихся HP/щитов, наличие способностей. Знание - сила.
31. Жертвенный щит (Sacrificial Shield): Когда юниту в соседнем слоте наносят смертельный урон, этот юнит может (с шансом 50%) взять удар на себя, полностью поглотив его своими щитами (если они есть). Срабатывает 1 раз за бой.

Категория 8: Нестандартные и рискованные тактики
32. Квантовая нестабильность (Quantum Instability): При атаке есть малый шанс (5%) нанести колоссальный урон (x10), но также есть шанс (10%) что атакующий юнит получит урон сам (30% от своего корпуса). Высокий риск, высокое вознаграждение.
33. Кража технологии (Tech Scrambler): Если этим выстрелом уничтожается вражеский юнит, атакующий временно "заимствует" его основную способность (если она есть) на 2 раунда.
34. Синхронизация огня (Fire Synchronizer): Если в этом же раунде по той же цели выстрелил еще хотя бы один союзный юнит, урон этого юнита увеличивается на 25%. Поощряет фокусный огонь.
35. Осколочные снаряды (Shrapnel Burst): При атаке легкого юнита (с малым корпусом) урон распространяется на всех врагов в этом слоте (например, при атаке истребителя в стае).

Пример идеи для реализации "Метки смерти" (№23):

```c
// Добавляем в структуру Unit или Slot:
// int death_mark_rounds; // Сколько раундов осталось действовать метке

void ApplyDeathMark(Unit* target, int current_round) {
    target->death_mark_rounds = 3; // Длительность 3 раунда
}

// В диспетчере боя, при расчете урона по цели:
long CalculateFinalDamage(Unit* attacker, Unit* target, long base_damage) {
    long final_damage = base_damage;
    
    if (target->death_mark_rounds > 0) {
        final_damage = (final_damage * 115) / 100; // +15% урона
        // printf("Урон усилен Меткой смерти!\n");
    }
    
    // Проверка других модификаторов...
    return final_damage;
}

// В конце каждого раунда уменьшаем таймеры у всех юнитов:
void DecreaseDebuffTimers(Unit* fleet, int fleet_size) {
    for (int i = 0; i < fleet_size; i++) {
        if (fleet[i].death_mark_rounds > 0) {
            fleet[i].death_mark_rounds--;
        }
    }
}
```

Эти способности добавляют глубины как микро- (управление отдельными юнитами), так и макро-уровню (синергия флота, долгосрочное планирование) сражений.

```
предложи ещё 32 способности
```

Превосходно! Вот ещё 32 уникальных способности, которые превратят битву в сложную тактическую шахматную партию.

Категория 9: Манипуляции временем и очередью ходов
36. Хроно-искажение (Chrono Shift): Цель пропускает свой следующий ход. Её атака/способность откладывается на раунд позже. Требуется система очереди действий.
37. Упреждающий удар (Preemptive Strike): Этот юнит всегда атакует первым в раунде, даже до "быстрых" юнитов. Изменяет порядок инициативы.
38. Временная петля (Time Loop): При убийстве цели этим юнитом, он получает шанс (25%) совершить ещё одну атаку в этом же раунде по другой цели (но с -50% урона).
39. Замедление (Temporal Snare): Снижает скорость атаки цели. Цель будет атаковать не каждый раунд, а через раунд.

Категория 10: Обман и иллюзии
40. Голографический двойник (Holographic Decoy): При атаке по этому юниту есть шанс (40%), что удар придётся по голограмме, и реальный урон не будет нанесён. Срабатывает 1 раз за бой.
41. Приманка (Bait Beacon): Призывает ложную цель в свободный слот. Противник в этом раунде с вероятностью 30% атакует её вместо реальных целей. Ложная цель исчезает в конце раунда.
42. Маскировка (Cloak Field): В начале боя этот юнит невидим для прицельных способностей противника. Маскировка спадает после первой произведённой им атаки.
43. Подмена цели (Target Redirect): При атаке по союзнику в соседнем слоте этот юнит может перехватить выстрел на себя с вероятностью 60%.

Категория 11: Эскалация и усиление со временем
44. Боевое безумие (Combat Frenzy): За каждый уничтоженный этим юнитом корабль, его урон увеличивается на 5% до конца боя (эффект суммируется).
45. Отчаянная защита (Last Stand): Когда у этого юнита остается менее 20% корпуса, его щиты и броня получают +50% эффективности.
46. Перегрузка реактора (Reactor Overload): Юнит может в любой раунд активировать перегрузку, увеличивая свой урон на 100%, но после атаки теряет 20% максимального корпуса (невосстановимо в этом бою).
47. Наследник (Successor Protocol): При уничтожении этого юнита, случайный союзный корабль того же типа (если есть) мгновенно получает +30% к урону до конца боя.

Категория 12: Массовые и зональные эффекты
48. Гравитационная волна (Gravity Pulse): Отталкивает все вражеские корабли в соседних слотах на одну позицию назад (если есть место), нарушая их боевой порядок.
49. ЭМИ-импульс широкого действия (Area EMP): Наносит незначительный урон, но снимает ВСЕ положительные эффекты (баффы) со всех вражеских юнитов в ряду.
50. Поле стазиса (Stasis Field): Создает поле в своём слоте. Любой вражеский юнит, который атакует этот слот, имеет 20% шанс быть "замороженным" на 1 раунд.
51. Кислотное облако (Acid Cloud): Заражение области. Все вражеские юниты, находящиеся в этом и соседних слотах, в начале каждого раунда теряют по 2% от максимального корпуса. Действует 3 раунда.

Категория 13: Специализация против классов
52. Охотник на истребители (Fighter Hunter): Наносит тройной урон юнитам класса "истребитель" или "лёгкий корабль".
53. Корабль-носитель (Carrier Drone Controller): Вместо обычной атаки призывает 1-2 дрона (очень слабые временные юниты), которые атакуют в этом раунде и погибают после атаки. Дроны могут поглощать одиночные целевые атаки.
54. Саботаж (Saboteur): Атака не наносит урона, но с шансом 25% отключает случайную способность цели на оставшийся бой.
55. Щитосниматель (Shield Breaker): Каждая атака этого юнита снижает максимальную ёмкость щитов цели на 10% на этот бой (эффект суммируется).

Категория 14: Ресурсные и экономические в бою
56. Рециклинг (Salvage Beam): При добивании цели восстанавливает 15% от её максимального корпуса в качестве щитов себе или случайному союзнику.
57. Энергетический вампир (Energy Vampire): 50% урона, нанесённого по щитам, преобразуется в щиты для атакующего юнита.
58. Захват ресурсов (Resource Plunder): Если этот юнит переживает бой, он даёт на 10% больше трофеев (обломков) с уничтоженных им целей.
59. Дорогой урон (Costly Shot): Выстрел наносит урон, равный не мощности оружия, а стоимости корабля-цели в ресурсах (берётся процент). Очень эффективно против дорогих кораблей, бесполезно против дешёвых.

Категория 15: Странные и непредсказуемые
60. Квантовое запутывание (Quantum Entanglement): При активации "связывает" себя с вражеским юнитом. Весь получаемый урон делится поровну между ними. Действует до конца боя или до смерти одного из них.
61. Генератор случайностей (Randomizer Core): Каждый раунд этот юнит получает случайную способность из общего списка (кроме уникальных). Непредсказуемо, но весело.
62. Зеркальный щит (Reflective Coating): Часть полученного урона (30%) отражается обратно в атакующего, минуя его щиты (урон по корпусу напрямую).
63. Тактическая капитуляция (Tactical Surrender): Этот юнит может "сдаться". Он мгновенно уничтожается, но все союзные корабли получают +25% к урону на следующий раунд из-за ярости.

Категория 16: Легендарные/ультимативные способности (долгий кулдаун)
64. Призыв подкрепления (Reinforcement Beacon): Один раз за бой можно призвать случайный легкий или средний корабль из своего резерва в свободный слот. Корабль сражается до конца боя, затем исчезает.
65. Звездолёт-камикадзе (Suicide Frigate): Способность активируется вручную. Корабль идёт на таран, нанося урон, равный 300% от своего ОСТАТКА корпуса + щитов, по ВСЕМ вражеским юнитам в своём ряду. Корабль гибнет.
66. Системный сброс (System Reboot): Восстанавливает все щиты и снимает все негативные эффекты со ВСЕХ союзных кораблей. Огромный кулдаун (например, раз в 5 раундов).
67. Генератор черной дыры (Singularity Projector): Один раз за бой создаёт сингулярность в выбранном вражеском слоте. Все вражеские юниты в этом и соседних слотах в начале каждого раунда получают урон, равный 10% от их ТЕКУЩЕГО корпуса. Действует 3 раунда.

Технические рекомендации по реализации таких сложных систем:

Система состояний (State System): Создайте битовые флаги или массив дебаффов/баффов для Unit/Slot. Например:

```c
typedef struct {
    int is_stunned;
    int is_marked;
    int is_burning;
    int burn_damage;
    int burn_rounds;
    int damage_bonus_percent;
    // ... и т.д.
} UnitStatus;
```

Диспетчер эффектов (Effect Manager): Отдельная функция, которая в конце/начале раунда обрабатывает все периодические эффекты (горение, яды, восстановление) и уменьшает таймеры.

Система событий (Event System): Для реактивных способностей (как "Жертвенный щит") нужен механизм, отслеживающий события типа "юнит собирается погибнуть", "юнит получил крит. урон" и дающий шанс другим юнитам среагировать.

Приоритет абилок (Ability Priority): Определите порядок применения абилок в раунде: сначала срабатывают щиты и реакции, затем телепорты и контроль, потом обычные атаки, потом периодический урон.

Логирование (Combat Log): Крайне важно для отладки и игрового интереса. Каждая сложная способность должна генерировать понятное текстовое сообщение о своём эффекте.

Эти 67 способностей покрывают огромный спектр тактик: от контроля и подавления до эскалации, поддержки и высокорисковых комбинаций. Игрокам придётся глубоко анализировать состав флота противника и строить контр-стратегии, что сделает каждую битву уникальной головоломкой. Удачи в реализации этой эпичной системы!

```
Придумай ещё 3 ультимативные способности
```

Отлично, вот 3 эпические ультимативные способности, достойные финальных боссов или титанических кораблей:

Категория 17: Титанические/Галактические угрозы

Галактическая пушка "Судный день" (Judgement Day Cannon):

Эффект: Вместо обычной атаки юнит начинает заряжать мощь в течение 2 раундов. На третий раунд он выпускает сфокусированный луч, который пробивает все слоты противника по вертикали. Луч наносит урон всем вражеским юнитам в выбранной колонке (от первого до последнего слота). Урон уменьшается на 30% с каждым поражённым юнитом в цепочке.

Тактика: Игрок должен стратегически выбирать колонку с самыми ценными целями. Противник может пытаться "подставить" слабые корабли, чтобы поглотить урон, или уничтожить заряжающий корабль до выстрела.

Баланс: Огромный кулдаун (раз в 7-10 раундов), корабль не может атаковать или использовать другие способности во время заряда, уязвим в этот период.

Матрица переписывания реальности (Reality Rewrite Matrix):

Эффект: Один раз за бой активирует глобальное поле. На один раунд все параметры (урон, щиты, корпус) всех юнитов на поле боя (и своих, и чужих) меняются местами с параметрами случайно выбранного другого юнита. После раунда параметры возвращаются, но сохранённый урон остаётся.

Пример: Ваш титан с 100к HP может внезапно оказаться с 500 HP истребителя, а вражеский истребитель получит 100к HP титана. После раунда титан вернёт свои 100к HP, но если его "тело истребителя" было уничтожено в этот раунд - он взорвётся.

Тактика: Высоко рискованная, может как переломить бой, так и уничтожить вас. Требует идеального момента (когда у вас много "пустых" почти уничтоженных кораблей, а у врага - здоровые).

Протокол "Феникс" (Phoenix Protocol):

Эффект: При полном уничтожении флота, если этот юнит был в нём, он активирует протокол в последний момент. Все уничтоженные союзные корабли восстают в виде "энергетических фантомов" на один последний раунд. Фантомы имеют 50% от своих исходных характеристик, не получают урон (они уже "мертвы"), но могут атаковать. После этого раунда они исчезают окончательно.

Тактика: Способность "из гроба". Позволяет даже в проигранном бою нанести врагу катастрофические потери в последнем отчаянном натиске, лишив его победы "пирровой ценой". Может использоваться для защиты ценной планеты - даже проиграв, вы уничтожите флот захватчика.

Баланс: Срабатывает только при полном уничтожении вашего флота. Не работает, если хотя бы один ваш корабль выжил. Огромный кулдаун на всю миссию (раз в 24 часа игрового времени).

Технические особенности реализации:

Для "Судного дня":

```c
// В структуре корабля:
int judgement_charge; // 0 - не заряжает, 1-2 - этапы заряда, 3 - выстрел
int target_column; // Выбранная для удара колонка

// В обработке раунда:
if (unit->judgement_charge > 0 && unit->judgement_charge < 3) {
    unit->judgement_charge++;
    if (unit->judgement_charge == 3) {
        FireJudgementBeam(unit->target_column);
        unit->judgement_charge = 0;
    }
    return; // Пропускаем обычную атаку в раунды заряда
}
```

Для "Матрицы реальности":

```c
// Требуется временное хранение оригинальных параметров всех юнитов
typedef struct {
    long original_hull;
    long original_shield;
    long original_damage;
    // ... другие параметры
} OriginalStats;

OriginalStats backup[MAX_FLEET_SIZE];

// При активации:
void ActivateRealityRewrite() {
    // 1. Сохраняем все текущие параметры в backup
    // 2. Случайным образом перемешиваем параметры между всеми юнитами
    // 3. Устанавливаем флаг "реальность искажена"
}
```

Для "Феникса":

```c
// Проверка в конце боя, когда флот уничтожен:
void CheckPhoenixProtocol(Fleet* fleet) {
    if (IsFleetDestroyed(fleet) && HasUnitWithPhoenixProtocol(fleet)) {
        // Восстанавливаем все уничтоженные корабли как фантомы
        for (int i = 0; i < fleet->size; i++) {
            if (fleet->units[i].exploded) {
                fleet->units[i].is_phantom = 1;
                fleet->units[i].hull = fleet->units[i].hull_max * 0.5;
                fleet->units[i].exploded = 0;
                fleet->units[i].can_be_damaged = 0; // Фантомы неуязвимы
            }
        }
        // Добавляем дополнительный раунд боя только для фантомов
        AddExtraBattleRound();
    }
}
```

Эти ультимативные способности добавляют настоящий эпический размах сражениям, создавая "вау-эффект" и запоминающиеся моменты, ради которых игроки и любят подобные игры.